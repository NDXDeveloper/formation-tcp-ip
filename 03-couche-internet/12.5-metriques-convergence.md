üîù Retour au [Sommaire](/SOMMAIRE.md)

# 3.12.5 M√©triques et convergence

## Introduction

Imaginez que vous planifiez un voyage en voiture. Comment choisissez-vous votre itin√©raire ?
- Le chemin **le plus court** en kilom√®tres ?
- Le chemin **le plus rapide** en temps ?
- Le chemin avec **le moins de p√©ages** ?
- Le chemin le plus **pittoresque** ?

Chaque crit√®re est une "**m√©trique**" diff√©rente, et selon votre priorit√©, vous choisirez un itin√©raire diff√©rent. De la m√™me mani√®re, les protocoles de routage utilisent des m√©triques pour d√©cider quel chemin est le "meilleur" pour acheminer les paquets.

La **convergence**, quant √† elle, repr√©sente le temps n√©cessaire pour que tous les routeurs du r√©seau s'accordent sur la topologie apr√®s un changement. C'est comme le temps n√©cessaire pour que tous les GPS du pays mettent √† jour leurs cartes apr√®s la construction d'une nouvelle autoroute.

## Les m√©triques de routage

### Qu'est-ce qu'une m√©trique ?

Une **m√©trique** est un **crit√®re num√©rique** utilis√© par un protocole de routage pour :
- Comparer plusieurs chemins vers une m√™me destination
- S√©lectionner le "meilleur" chemin
- Construire la table de routage

**Principe fondamental** : Plus la m√©trique est **faible**, meilleur est le chemin (sauf exceptions).

### Analogie : Choisir un restaurant

Vous voulez aller au restaurant. Vous avez trois options :

```
Restaurant A : 5 km, 3 √©toiles Michelin, 100‚Ç¨
Restaurant B : 15 km, bon rapport qualit√©-prix, 30‚Ç¨
Restaurant C : 2 km, fast-food, 10‚Ç¨
```

**Selon votre m√©trique** :
- M√©trique = distance ‚Üí Restaurant C (2 km)
- M√©trique = qualit√© ‚Üí Restaurant A (3 √©toiles)
- M√©trique = prix ‚Üí Restaurant C (10‚Ç¨)
- M√©trique = rapport qualit√©/prix ‚Üí Restaurant B

**Il n'y a pas de "bon" choix absolu**, seulement un choix optimal selon **votre crit√®re**.

Les protocoles de routage fonctionnent de la m√™me mani√®re : ils choisissent selon leur m√©trique.

## Les m√©triques par protocole

### RIP : Le nombre de sauts

**M√©trique** : Hop count (nombre de routeurs √† traverser)

**Calcul** : Compte simplement le nombre de routeurs

```
Source -- R1 -- R2 -- R3 -- Destination
           1     2     3 sauts

M√©trique RIP = 3
```

**Avantages** :
- Extr√™mement simple √† calculer
- Pas besoin de conna√Ætre les caract√©ristiques des liens
- Faible consommation de ressources

**Inconv√©nients** :
- Ne consid√®re pas la bande passante
- Ne consid√®re pas la latence
- Ne consid√®re pas la charge
- Optimisation sous-optimale

**Exemple de probl√®me** :

```
Chemin A : 3 routeurs √ó liens 1 Gbps = 3 sauts
Chemin B : 2 routeurs √ó liens 10 Mbps = 2 sauts

RIP choisit B (2 < 3) m√™me si A est 100√ó plus rapide !
```

**Plage de valeurs** : 1 √† 15 (16 = infini/inaccessible)

### OSPF : Le co√ªt bas√© sur la bande passante

**M√©trique** : Cost (co√ªt calcul√© selon la bande passante)

**Formule** :
```
Co√ªt = Bande passante de r√©f√©rence / Bande passante de l'interface
```

**Bande passante de r√©f√©rence par d√©faut** : 100 Mbps (10‚Å∏ bits/s)

**Tableau des co√ªts** :

| Type de lien | Bande passante | Co√ªt OSPF (d√©faut) |
|--------------|----------------|--------------------|
| Serial 64 kbps | 64 Kbps | 1562 |
| T1 | 1.544 Mbps | 64 |
| E1 | 2.048 Mbps | 48 |
| Ethernet | 10 Mbps | 10 |
| Fast Ethernet | 100 Mbps | 1 |
| Gigabit Ethernet | 1 Gbps | 1 * |
| 10 Gigabit | 10 Gbps | 1 * |

\* Probl√®me : Tous les liens ‚â• 100 Mbps ont le m√™me co√ªt avec la r√©f√©rence par d√©faut !

**Solution** : Augmenter la bande passante de r√©f√©rence :

```
router ospf 1
  auto-cost reference-bandwidth 100000  ! 100 Gbps en Mbps

Nouveaux co√ªts :
Fast Ethernet (100 Mbps) : 1000
Gigabit (1 Gbps) : 100
10 Gigabit (10 Gbps) : 10
100 Gigabit (100 Gbps) : 1
```

**Avantages** :
- Refl√®te la capacit√© r√©elle des liens
- Optimise l'utilisation de la bande passante
- Ajustable selon les besoins

**Inconv√©nients** :
- Ne consid√®re pas la charge actuelle
- Ne consid√®re pas la latence
- Configuration de la r√©f√©rence n√©cessaire pour les liens rapides

**Exemple de calcul** :

```
Topologie :
         FastEthernet (co√ªt 1)
    R1 ----------------------- R2
     |                          |
     | Serial T1 (co√ªt 64)      | Gigabit (co√ªt 1)
     |                          |
    R3 ----------------------- R4
         FastEthernet (co√ªt 1)

Chemin R1 ‚Üí R4 :
Option A : R1 ‚Üí R2 ‚Üí R4 = 1 + 1 = 2 ‚úÖ
Option B : R1 ‚Üí R3 ‚Üí R4 = 64 + 1 = 65

OSPF choisit A (co√ªt total plus faible)
```

### EIGRP : M√©trique composite

**EIGRP** (Enhanced Interior Gateway Routing Protocol - Cisco propri√©taire) utilise une m√©trique **composite** plus sophistiqu√©e.

**Formule** (simplifi√©e) :
```
M√©trique = [(K1 √ó Bande passante + K3 √ó D√©lai) √ó 256]

Par d√©faut :
K1 = 1 (bande passante activ√©e)
K2 = 0 (charge d√©sactiv√©e)
K3 = 1 (d√©lai activ√©)
K4 = 0 (fiabilit√© d√©sactiv√©e)
K5 = 0 (MTU d√©sactiv√©)
```

**Composants** :
- **Bande passante** : Lien le plus lent du chemin
- **D√©lai** : Somme des d√©lais de tous les liens
- **Charge** : Utilisation actuelle (optionnel)
- **Fiabilit√©** : Taux d'erreurs (optionnel)
- **MTU** : Taille maximale de paquet (optionnel)

**Avantages** :
- Prend en compte plusieurs facteurs
- Plus pr√©cis qu'OSPF
- Peut consid√©rer la charge en temps r√©el

**Inconv√©nients** :
- Plus complexe √† calculer
- Configuration plus d√©licate
- Propri√©taire Cisco (bien que standardis√© r√©cemment)

**Exemple** :

```
Lien A : 100 Mbps, d√©lai 1000 Œºs
Lien B : 10 Mbps, d√©lai 100 Œºs

RIP : Les traiterait de fa√ßon √©gale (1 saut chacun)
OSPF : Pr√©f√®re A (bande passante sup√©rieure)
EIGRP : Calcule selon bande passante ET d√©lai
```

### BGP : Attributs multiples

BGP n'a pas une "m√©trique" unique. Il utilise un **algorithme de s√©lection** bas√© sur de **nombreux attributs**.

**Attributs principaux** (ordre de pr√©f√©rence) :

1. **WEIGHT** (Cisco uniquement) : Plus √©lev√© = meilleur
2. **LOCAL_PREF** : Plus √©lev√© = meilleur
3. **AS_PATH** : Plus court = meilleur (par d√©faut)
4. **ORIGIN** : IGP > EGP > Incomplete
5. **MED** : Plus bas = meilleur
6. **Type de chemin** : eBGP > iBGP
7. **M√©trique IGP vers NEXT_HOP** : Plus bas = meilleur
8. **Router ID** : Plus bas = meilleur

**Caract√©ristique unique** : BGP ne cherche pas le chemin "techniquement optimal", mais le chemin qui **respecte les politiques** d√©finies.

**Exemple** :

```
Chemin A : AS_PATH = [100, 200] (2 AS), faible latence
Chemin B : AS_PATH = [100, 300, 400] (3 AS), haute latence
Mais Chemin B : LOCAL_PREF = 200
    Chemin A : LOCAL_PREF = 100

BGP choisit B (LOCAL_PREF prime sur tout le reste)
M√™me si A est techniquement meilleur !
```

### Tableau comparatif des m√©triques

| Protocole | M√©trique principale | Valeur pr√©f√©r√©e | Complexit√© | Consid√®re bande passante | Consid√®re latence |
|-----------|---------------------|-----------------|------------|-------------------------|-------------------|
| **RIP** | Sauts | Plus petit | Tr√®s faible | ‚ùå Non | ‚ùå Non |
| **OSPF** | Co√ªt | Plus petit | Faible | ‚úÖ Oui | ‚ùå Non |
| **EIGRP** | Composite | Plus petit | Moyenne | ‚úÖ Oui | ‚úÖ Oui |
| **BGP** | Attributs | Selon attribut | √âlev√©e | ‚ùå Non* | ‚ùå Non* |

\* BGP peut indirectement consid√©rer ces facteurs via la m√©trique IGP vers le NEXT_HOP

## La distance administrative

### Qu'est-ce que la distance administrative ?

Imaginez que vous recevez des conseils d'itin√©raire de plusieurs sources :
- Votre GPS (tr√®s fiable)
- Un ami (moyennement fiable)
- Un inconnu dans la rue (peu fiable)

La **distance administrative (AD)** est le niveau de **confiance** accord√© √† chaque source d'information de routage.

### D√©finition technique

La **distance administrative** est une valeur (0-255) qui indique la **fiabilit√© d'une source de routage**. Elle est utilis√©e quand **plusieurs protocoles** annoncent une route vers la m√™me destination.

**R√®gle** : Plus la distance administrative est **faible**, plus la source est **fiable**.

### Valeurs par d√©faut

| Source | Distance Administrative | Fiabilit√© |
|--------|------------------------|-----------|
| **Interface directement connect√©e** | 0 | Absolue |
| **Route statique** | 1 | Tr√®s √©lev√©e |
| **EIGRP summary route** | 5 | Tr√®s √©lev√©e |
| **eBGP** | 20 | √âlev√©e |
| **EIGRP (interne)** | 90 | Bonne |
| **IGRP** | 100 | Bonne |
| **OSPF** | 110 | Bonne |
| **IS-IS** | 115 | Bonne |
| **RIP** | 120 | Moyenne |
| **EIGRP (externe)** | 170 | Faible |
| **iBGP** | 200 | Faible |
| **Route inconnue** | 255 | Non fiable (rejet√©e) |

### Exemple de conflit de routes

```
Routeur re√ßoit 3 routes vers 192.168.10.0/24 :

Route 1 : via OSPF, m√©trique 50, AD = 110
Route 2 : via RIP, m√©trique 2, AD = 120
Route 3 : via Route statique, m√©trique 0, AD = 1

Question : Laquelle est install√©e dans la table de routage ?
```

**R√©ponse** : La route statique (AD = 1)

**Processus de d√©cision** :

1. Comparer les distances administratives
   - Route statique : AD = 1 ‚úÖ (plus faible)
   - OSPF : AD = 110
   - RIP : AD = 120

2. La route statique est s√©lectionn√©e

**Important** : Les m√©triques (50 pour OSPF, 2 pour RIP) ne sont m√™me **pas compar√©es** car elles sont de protocoles diff√©rents. Seule la distance administrative compte.

### Utilisation pratique

**Sc√©nario 1 : Route de secours**

```
! Route principale via OSPF (AD = 110)
router ospf 1
  network 10.0.0.0 0.0.0.255 area 0

! Route statique de backup avec AD modifi√©e
ip route 192.168.10.0 255.255.255.0 10.0.0.99 150
                                              ‚Üë AD plus √©lev√©e

R√©sultat :
- Normalement : OSPF utilis√© (AD 110 < 150)
- Si OSPF √©choue : Route statique prend le relais
```

**Sc√©nario 2 : Forcer une route sp√©cifique**

```
! M√™me si OSPF annonce une route, la route statique prime
ip route 203.0.113.0 255.255.255.0 10.1.1.1 1

R√©sultat : Route statique toujours utilis√©e (AD 1 < 110)
```

### Distance administrative vs M√©trique

```
Analogie :
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Distance Administrative = Source        ‚îÇ
‚îÇ "√Ä QUI je fais confiance ?"             ‚îÇ
‚îÇ (GPS vs ami vs inconnu)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ M√©trique = Chemin                       ‚îÇ
‚îÇ "QUEL chemin est le meilleur ?"         ‚îÇ
‚îÇ (plus court vs plus rapide)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Processus complet** :

1. **√âtape 1** : Comparer les distances administratives
   - S√©lectionner la source la plus fiable

2. **√âtape 2** : Si plusieurs routes de la m√™me source (m√™me AD)
   - Comparer les m√©triques
   - S√©lectionner la meilleure m√©trique

3. **√âtape 3** : Si m√©trique √©gale
   - Load balancing (si support√©)
   - Ou s√©lection selon d'autres crit√®res

## La convergence : d√©finition et importance

### Qu'est-ce que la convergence ?

La **convergence** est le processus par lequel tous les routeurs d'un r√©seau atteignent un **accord complet** sur la topologie du r√©seau apr√®s un changement.

**Changements d√©clencheurs** :
- Panne d'un lien
- Panne d'un routeur
- Ajout d'un nouveau lien/routeur
- Modification de m√©trique
- Changement de politique

### Analogie : Mise √† jour d'un annuaire

Imaginez un annuaire t√©l√©phonique partag√© dans une entreprise :

```
√âtat initial : Tout le monde a la m√™me version (converg√©)
‚Üì
Jean change de bureau et de num√©ro
‚Üì
Phase de transition : Information se propage
- Certains employ√©s ont l'ancienne info
- D'autres ont la nouvelle
- Risque d'appeler le mauvais num√©ro
‚Üì
√âtat final : Tout le monde a la nouvelle version (converg√©)
```

Le temps entre le changement et l'√©tat final est le **temps de convergence**.

### Importance de la convergence

**1. Disponibilit√© du r√©seau**

Plus la convergence est **rapide**, moins il y a d'**interruption de service**.

```
Convergence lente (RIP) : 3-7 minutes d'interruption
Convergence rapide (OSPF) : 2-5 secondes d'interruption

Pour une application critique : inacceptable vs acceptable
```

**2. Perte de paquets**

Pendant la convergence, certains paquets peuvent :
- √ätre perdus (rout√©s vers un lien mort)
- Boucler (boucles de routage temporaires)
- Prendre un chemin sous-optimal

**3. Exp√©rience utilisateur**

```
Temps de convergence : 30 secondes
Impact utilisateur :
- Appel VoIP : Coup√© (timeout ~10-20 secondes)
- Streaming vid√©o : Buffering visible
- Navigation web : Timeouts de pages
- SSH/RDP : Connexion perdue
```

### √âtats de convergence

**1. √âtat converg√©** ‚úÖ
- Toutes les tables de routage sont coh√©rentes
- Tous les routeurs ont la m√™me vue de la topologie
- Le trafic circule normalement

**2. √âtat non converg√©** ‚ö†Ô∏è
- Information incoh√©rente entre routeurs
- Risque de boucles
- Risque de blackholes (paquets perdus)
- Chemins sous-optimaux

**3. √âtat en transition** üîÑ
- Changement d√©tect√©
- Information se propage
- Calculs en cours
- √âtat temporaire (on esp√®re !)

## Processus de convergence par protocole

### RIP : Convergence lente

**Processus** :

```
Temps 0s : Lien R1-R2 tombe en panne
‚Üì
Temps 0-180s : R1 attend des mises √† jour de R2 (invalid timer)
‚Üì
Temps 180s : R1 marque les routes via R2 comme inaccessibles (m√©trique 16)
‚Üì
Temps 180-210s : R1 annonce ces routes comme inaccessibles
‚Üì
Temps 210s : Autres routeurs recalculent leurs routes
‚Üì
Temps 240s : Routes supprim√©es (flush timer)
‚Üì
Temps 240-420s : Propagation hop-by-hop + counting to infinity possible
‚Üì
Convergence compl√®te : 3-7 minutes ‚ùå
```

**Probl√®mes** :
- Timers tr√®s longs (180s pour d√©tecter une panne)
- Propagation hop-by-hop (lente)
- Counting to infinity
- Mises √† jour p√©riodiques toutes les 30s

**Optimisations** :
- Triggered updates : Annonce imm√©diate des changements
- Split horizon : √âvite certaines boucles
- Hold-down timers : Stabilise la convergence

**Temps de convergence typique** : **3-7 minutes**

### OSPF : Convergence rapide

**Processus** :

```
Temps 0s : Lien R1-R2 tombe en panne
‚Üì
Temps 0-1s : R1 d√©tecte la panne (carrier down ou timeout Hello)
‚Üì
Temps 1s : R1 g√©n√®re un nouveau LSA
‚Üì
Temps 1-2s : LSA inond√© (flooded) √† tous les routeurs de l'aire
‚Üì
Temps 2s : Tous les routeurs mettent √† jour leur LSDB
‚Üì
Temps 2-3s : Chaque routeur recalcule son arbre SPF (Dijkstra)
‚Üì
Temps 3-4s : Nouvelles routes install√©es dans la table de routage
‚Üì
Convergence compl√®te : 2-5 secondes ‚úÖ
```

**Avantages** :
- D√©tection rapide (Hello timer 10s, Dead timer 40s ou d√©tection hardware)
- Flooding imm√©diat (pas hop-by-hop)
- Tous les routeurs calculent en parall√®le
- Pas de boucles (vision compl√®te de la topologie)

**Optimisations** :
- Fast Hello : Hello 1s au lieu de 10s
- BFD (Bidirectional Forwarding Detection) : D√©tection sub-seconde
- Incremental SPF : Recalcule seulement les parties affect√©es
- SPF throttling : √âvite trop de recalculs

**Temps de convergence typique** : **2-5 secondes**

### EIGRP : Convergence tr√®s rapide

**Processus** :

```
Temps 0s : Lien R1-R2 tombe en panne
‚Üì
Temps 0-1s : R1 d√©tecte la panne
‚Üì
Temps 1s : R1 v√©rifie si route de secours existe (Feasible Successor)
‚Üì
Cas A : Feasible Successor existe
  ‚Üí Basculement imm√©diat (< 1 seconde) ‚úÖ‚úÖ
‚Üì
Cas B : Pas de Feasible Successor
  ‚Üí R1 lance DUAL (calcul actif)
  ‚Üí Queries envoy√©es aux voisins
  ‚Üí Attente des Replies
  ‚Üí Nouveau chemin calcul√© (2-3 secondes)
‚Üì
Convergence : < 1 seconde (avec FS) ou 2-3 secondes (sans FS)
```

**Avantages** :
- **Feasible Successor** : Route de backup pr√©-calcul√©e
- DUAL (Diffusing Update Algorithm) : √âvite les boucles
- Mises √† jour partielles (seulement les changements)
- Queries limit√©es (pas √† tous les routeurs)

**Temps de convergence typique** : **< 1 seconde** (avec backup) ou **2-3 secondes** (sans backup)

### BGP : Convergence contr√¥l√©e (lente)

**Processus** :

```
Temps 0s : Route retir√©e par un AS
‚Üì
Temps 0-1s : Message UPDATE (WITHDRAW) envoy√© aux pairs
‚Üì
Temps 1-60s : Propagation de proche en proche sur Internet
‚Üì
Temps 60-180s : Chaque AS recalcule son meilleur chemin
‚Üì
Temps 180-300s : Path exploration (teste diff√©rents chemins)
‚Üì
Temps 300-600s : Propagation des nouvelles annonces
‚Üì
Convergence compl√®te : 5-10 minutes (parfois plus) ‚ö†Ô∏è
```

**Caract√©ristiques** :
- Convergence **intentionnellement lente** (stabilit√© prioritaire)
- Path exploration : BGP essaie plusieurs chemins avant de trouver le meilleur
- Propagation globale (peut traverser toute la plan√®te)
- Consid√©rations politiques ralentissent le processus

**Optimisations** :
- Route damping : P√©nalise les routes instables (flapping)
- Advertisement interval : R√©duit le d√©lai entre annonces
- BGP Fast External Fallover : D√©tection rapide de panne

**Temps de convergence typique** : **5-15 minutes**

**Note** : La lenteur est **volontaire** - BGP privil√©gie la stabilit√© sur la rapidit√©.

### Tableau comparatif

| Protocole | D√©tection panne | Propagation | Recalcul | Convergence totale | M√©thode |
|-----------|----------------|-------------|----------|-------------------|---------|
| **RIP** | 180s | Hop-by-hop (lent) | Simple | **3-7 min** | Timers + p√©riodique |
| **OSPF** | 40s (ou <1s) | Flooding (rapide) | SPF (Dijkstra) | **2-5 sec** | √âv√©nementiel |
| **EIGRP** | <1s | Queries (rapide) | DUAL | **<1-3 sec** | Backup pr√©-calcul√© |
| **BGP** | <1s | Global (lent) | Path selection | **5-15 min** | Contr√¥l√©/politique |

## Facteurs affectant la convergence

### 1. Topologie du r√©seau

**Topologie lin√©aire** (plus lente) :
```
R1 -- R2 -- R3 -- R4 -- R5
Information se propage s√©quentiellement
```

**Topologie maill√©e** (plus rapide avec OSPF) :
```
    R1 -- R2
    |  \/  |
    |  /\  |
    R3 -- R4
Information inond√©e √† tous simultan√©ment
```

### 2. Nombre de routeurs

**Petit r√©seau** (5 routeurs) :
- Peu de calculs
- Propagation rapide
- LSDB/tables petites

**Grand r√©seau** (500 routeurs) :
- Nombreux calculs
- Propagation plus longue
- LSDB/tables volumineuses
- CPU plus sollicit√©

### 3. Complexit√© de la topologie

**Topologie simple** :
- Peu de chemins alternatifs
- Calculs simples
- Convergence rapide

**Topologie complexe** :
- Nombreux chemins alternatifs
- Calculs complexes
- Convergence plus lente

### 4. Type de changement

**Panne de lien** :
- D√©tection rapide (carrier down)
- Impact localis√©

**Panne de routeur** :
- D√©tection par timeout (plus lent)
- Impact sur tous les liens du routeur

**Changement de m√©trique** :
- Pas de panne, juste r√©optimisation
- Priorit√© plus basse

### 5. Charge du r√©seau

**R√©seau peu charg√©** :
- Mises √† jour propag√©es rapidement
- CPU disponible pour calculs

**R√©seau surcharg√©** :
- Mises √† jour retard√©es
- CPU occup√© par forwarding
- Convergence ralentie

### 6. Puissance des routeurs

**Routeurs puissants** :
- Calculs SPF rapides
- Traitement rapide des mises √† jour

**Routeurs faibles** :
- Calculs lents
- Risque de d√©passement de m√©moire
- Convergence ralentie

## Techniques d'optimisation de la convergence

### 1. Ajustement des timers

**OSPF** :
```
! R√©duire les Hello timers
interface GigabitEthernet0/0
  ip ospf hello-interval 1      ! 1 seconde au lieu de 10
  ip ospf dead-interval 3        ! 3 secondes au lieu de 40

R√©sultat : D√©tection de panne en 3s au lieu de 40s
```

**Attention** : Timers trop courts peuvent causer :
- Faux positifs (pannes fant√¥mes)
- Trafic de contr√¥le √©lev√©
- Instabilit√©

### 2. BFD (Bidirectional Forwarding Detection)

**Principe** : M√©canisme ind√©pendant du protocole pour d√©tecter les pannes en **millisecondes**.

```
interface GigabitEthernet0/0
  bfd interval 50 min_rx 50 multiplier 3

router ospf 1
  bfd all-interfaces

R√©sultat : D√©tection de panne en 150ms (50ms √ó 3)
```

**Avantages** :
- D√©tection sub-seconde
- Fonctionne pour OSPF, EIGRP, BGP, IS-IS
- Impl√©ment√© en hardware sur certains √©quipements

### 3. Hi√©rarchie et segmentation

**OSPF avec aires** :
```
     Area 0 (Backbone)
       /    |    \
   Area 1  Area 2  Area 3

Changement dans Area 1 :
- Ne d√©clenche pas de SPF dans Area 2 et 3
- Convergence localis√©e
- R√©seau global plus stable
```

**BGP avec route reflection** :
```
Route Reflector (RR)
   /    |    \
 R1    R2    R3

Au lieu de full mesh iBGP :
- Moins de sessions
- Convergence plus rapide
- Scalabilit√© am√©lior√©e
```

### 4. Route summarization

**Principe** : Agr√©ger plusieurs routes en une seule

```
Au lieu d'annoncer :
192.168.1.0/24
192.168.2.0/24
192.168.3.0/24
192.168.4.0/24

Annoncer :
192.168.0.0/22

Avantages :
- Moins de routes √† calculer
- Changement dans un sous-r√©seau n'affecte pas les autres aires
- Convergence plus rapide
```

### 5. Incremental SPF (iSPF)

**Principe OSPF classique** :
- Changement d√©tect√© ‚Üí Recalcul **complet** de l'arbre SPF

**Incremental SPF** :
- Changement d√©tect√© ‚Üí Recalcul **seulement des branches affect√©es**

```
Topologie :
       R1
      / | \
    R2 R3 R4
         |
        R5

Lien R3-R5 tombe :
- SPF complet : Recalcule tout l'arbre
- iSPF : Recalcule seulement la branche R3-R5

R√©sultat : Convergence 30-50% plus rapide
```

### 6. EIGRP Feasible Successor

**Principe** : Pr√©-calculer des routes de backup

```
Route vers 10.0.0.0/24 :

Successor (meilleur) : via R2, m√©trique 1000
Feasible Successor (backup) : via R3, m√©trique 1500

Si R2 tombe :
- Basculement IMM√âDIAT vers R3
- Pas de recalcul n√©cessaire
- Convergence < 1 seconde
```

**Configuration** :
```
router eigrp 100
  variance 2  ! Accepte routes jusqu'√† 2√ó la meilleure m√©trique

R√©sultat : Plus de Feasible Successors possibles
```

### 7. BGP graceful restart

**Principe** : Maintenir le forwarding pendant un red√©marrage de BGP

```
Sans graceful restart :
Red√©marrage BGP ‚Üí Toutes routes retir√©es ‚Üí Blackhole

Avec graceful restart :
Red√©marrage BGP ‚Üí Routes maintenues ‚Üí Convergence transparente
```

### 8. Pr√©ventif : Capacit√© de liens ad√©quate

**Principe** : √âviter la congestion qui ralentit la convergence

```
Lien surcharg√© (95% utilisation) :
- Mises √† jour retard√©es dans la queue
- Paquets Hello perdus (faux positifs)
- Convergence d√©grad√©e

Lien bien dimensionn√© (< 70% utilisation) :
- Mises √† jour transmises rapidement
- Convergence optimale
```

## Impact de la convergence lente

### 1. Applications temps r√©el

**VoIP** :
```
Timeout typique : 20 secondes
Convergence RIP : 3-7 minutes
R√©sultat : Appels coup√©s syst√©matiquement ‚ùå

Convergence OSPF : 2-5 secondes
R√©sultat : Courte interruption, souvent transparente ‚úÖ
```

**Visioconf√©rence** :
```
Seuil de tol√©rance : ~10 secondes
Convergence lente ‚Üí Coupure visible
Convergence rapide ‚Üí Possible latence courte
```

### 2. Applications transactionnelles

**E-commerce** :
```
Transaction en cours pendant convergence :
- Connexion perdue
- Transaction √©chou√©e
- Rollback n√©cessaire
- Exp√©rience utilisateur d√©grad√©e
```

**Services bancaires** :
```
Convergence pendant transaction :
- Risque de timeout
- Risque de double transaction
- N√©cessite m√©canismes de reprise robustes
```

### 3. Services cloud

**Haute disponibilit√© promise** :
```
SLA : 99.99% = 52 minutes de downtime/an

Convergence lente (7 min par panne, 10 pannes/an) :
= 70 minutes ‚Üí SLA non respect√© ‚ùå

Convergence rapide (5 sec par panne, 10 pannes/an) :
= 50 secondes ‚Üí SLA respect√© ‚úÖ
```

### 4. Boucles de routage temporaires

Pendant la convergence, des **boucles temporaires** peuvent appara√Ætre :

```
Avant panne :
A ‚Üí B ‚Üí C ‚Üí Destination

Pendant convergence :
A croit que B peut joindre Destination
B croit que A peut joindre Destination
‚Üí Paquet fait A ‚Üí B ‚Üí A ‚Üí B (boucle)

TTL d√©cr√©ment√© √† chaque saut
Apr√®s ~64 sauts : paquet jet√©
```

**Impact** :
- Paquets perdus
- Utilisation de bande passante
- Latence extr√™me pour certains paquets

### 5. Blackholes

**Blackhole** : Un routeur annonce qu'il peut atteindre une destination, mais ne le peut plus.

```
R1 continue d'envoyer √† R2
R2 jette les paquets (lien mort)
‚Üí Paquets perdus sans notification

Dur√©e du blackhole = Temps de convergence
```

## Convergence dans les architectures modernes

### 1. Datacenters et architectures leaf-spine

**Caract√©ristiques** :
- Topologies tr√®s maill√©es
- Chemins multiples (ECMP)
- Besoins de convergence ultra-rapide

**Solutions** :
```
Protocoles utilis√©s :
- BGP avec ECMP
- OSPF avec BFD
- Protocoles sp√©cialis√©s (RIFT)

Optimisations :
- BFD avec intervalles 50-100ms
- Timers BGP r√©duits
- Route dampening d√©sactiv√©
- Nombreux chemins √©gaux (64+ via ECMP)

Convergence typique : < 1 seconde
```

### 2. SD-WAN (Software-Defined WAN)

**Principe** : Orchestration centralis√©e du routage

```
Contr√¥leur SD-WAN
      |
  D√©tecte panne
      |
  Reconfigure tous les sites simultan√©ment
      |
Convergence : Quasi-imm√©diate (< 1 seconde)
```

**Avantages** :
- Visibilit√© globale
- D√©cisions centralis√©es
- Pas de propagation hop-by-hop
- Application-aware routing

### 3. Overlay networks

**Exemples** : VXLAN, GRE, IPsec tunnels

```
Underlay (r√©seau physique) : OSPF/BGP
Overlay (r√©seau logique) : Routes virtuelles

Panne dans l'underlay :
1. Convergence underlay (OSPF)
2. D√©tection par overlay
3. Reroutage overlay

Double convergence, mais :
- Underlay optimis√© (BFD, fast timers)
- Overlay pr√©-calcule alternatives
```

### 4. Kubernetes networking

**Caract√©ristiques** :
- Pods √©ph√©m√®res (cr√©√©s/d√©truits dynamiquement)
- Routes changent fr√©quemment
- Convergence doit √™tre quasi-instantan√©e

**Solutions** :
```
CNI plugins (Calico, Cilium, etc.) :
- Utilisent BGP en arri√®re-plan
- Optimisations agressives
- Route reflectors
- Graceful restart

Convergence : < 1 seconde pour ajout/retrait de pod
```

### 5. Edge computing

**D√©fis** :
- Latence critique (applications temps r√©el)
- Mobilit√© des utilisateurs
- Besoin de reroutage ultra-rapide

**Solutions** :
- Anycast (m√™me IP, multiple locations)
- BGP avec convergence optimis√©e
- DNS-based load balancing (convergence au niveau DNS)

## Mesurer et surveiller la convergence

### M√©triques importantes

**1. Temps de d√©tection** :
```
Temps entre la panne et sa d√©tection par le premier routeur
Cible : < 1 seconde (avec BFD)
```

**2. Temps de propagation** :
```
Temps pour que tous les routeurs soient inform√©s
Cible : < 2 secondes (OSPF/EIGRP)
```

**3. Temps de recalcul** :
```
Temps pour que chaque routeur recalcule ses routes
Cible : < 1 seconde
```

**4. Temps d'installation** :
```
Temps pour installer les nouvelles routes dans la FIB (Forwarding Information Base)
Cible : < 500ms
```

**5. Convergence totale** :
```
Du changement initial √† la stabilit√© compl√®te
Cible : < 5 secondes (IGP), acceptable jusqu'√† minutes (BGP)
```

### Outils de surveillance

**1. Logs et debug** :
```
! Cisco IOS
debug ip ospf spf
debug eigrp fsm
show ip bgp convergence

Affiche les √©v√©nements de convergence en temps r√©el
```

**2. SNMP Traps** :
```
Alertes automatiques sur :
- Changements de voisinage
- Flapping de routes
- Temps de convergence anormaux
```

**3. Syslog** :
```
Centralisation des logs
Analyse des patterns
D√©tection d'anomalies
```

**4. Outils sp√©cialis√©s** :
- **NetFlow/sFlow** : Analyse du trafic pendant convergence
- **ThousandEyes** : Mesure de convergence Internet BGP
- **Cisco DNA Center** : Assurance et analytics
- **Grafana/Prometheus** : M√©triques de convergence

### Tests de convergence

**1. Tests contr√¥l√©s** :
```
Sc√©nario :
1. D√©connecter un lien
2. Mesurer le temps jusqu'√† r√©tablissement du trafic
3. Reconnecter
4. Mesurer √† nouveau

Outils : iperf3, ping avec timestamp, packet capture
```

**2. Chaos engineering** :
```
Injecter des pannes al√©atoires pour tester :
- R√©silience du r√©seau
- Temps de convergence r√©els
- Identification de bottlenecks
```

## Points cl√©s √† retenir

1. **Les m√©triques d√©terminent le "meilleur" chemin** selon des crit√®res diff√©rents par protocole
2. **RIP utilise le nombre de sauts** (simple mais limit√©)
3. **OSPF utilise le co√ªt** bas√© sur la bande passante (plus intelligent)
4. **EIGRP utilise une m√©trique composite** (bande passante + d√©lai)
5. **BGP utilise des attributs multiples** (politiques prioritaires sur technique)
6. **La distance administrative** d√©partage les conflits entre protocoles
7. **La convergence** est le temps pour que tous les routeurs s'accordent sur la topologie
8. **RIP converge lentement** (minutes) ‚Üí Inadapt√© aux applications critiques
9. **OSPF/EIGRP convergent rapidement** (secondes) ‚Üí Standard pour r√©seaux modernes
10. **BGP converge intentionnellement lentement** (minutes) ‚Üí Stabilit√© d'Internet prioritaire
11. **L'optimisation est possible** (BFD, timers, hi√©rarchie, summarization)
12. **La convergence rapide est critique** pour VoIP, cloud, applications temps r√©el

## Ce qui vient ensuite

Dans la section suivante (**3.12.6**), nous explorerons les **implications pour les architectures cloud et microservices** :
- Comment les protocoles de routage s'adaptent au cloud
- D√©fis des architectures dynamiques et √©ph√©m√®res
- Service mesh et routage applicatif
- Tendances futures du routage

Vous avez maintenant une compr√©hension compl√®te des m√©triques et de la convergence, deux concepts fondamentaux qui distinguent les protocoles de routage et d√©terminent leurs cas d'usage appropri√©s !

---

**Conseil pratique** : La convergence est souvent sous-estim√©e lors de la conception r√©seau, mais elle a un impact direct sur l'exp√©rience utilisateur. Privil√©giez toujours des protocoles √† convergence rapide (OSPF, EIGRP) pour les applications critiques. Si vous √™tes limit√© √† RIP, investissez massivement dans la redondance au niveau applicatif. Et n'oubliez pas : un r√©seau qui converge lentement n'est pas un r√©seau "lent", c'est un r√©seau qui a des **interruptions fr√©quentes et prolong√©es** !

‚è≠Ô∏è [Implications pour les architectures cloud et microservices](/03-couche-internet/12.6-implications-cloud-microservices.md)
