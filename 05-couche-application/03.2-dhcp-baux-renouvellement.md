ğŸ” Retour au [Sommaire](/SOMMAIRE.md)

# 5.3.2 Baux et renouvellement

## Introduction

Le **bail DHCP** (lease) est au cÅ“ur du fonctionnement dynamique de DHCP. C'est ce mÃ©canisme qui permet d'attribuer des adresses IP de maniÃ¨re temporaire, de les rÃ©cupÃ©rer automatiquement, et d'optimiser l'utilisation d'un pool d'adresses limitÃ©.

Dans cette section, nous allons explorer en profondeur le cycle de vie d'un bail DHCP : de sa crÃ©ation Ã  son expiration, en passant par les diffÃ©rentes phases de renouvellement. Nous verrons Ã©galement comment les serveurs et clients gÃ¨rent ces baux, et quelles stratÃ©gies adopter pour diffÃ©rents types de rÃ©seaux.

Comprendre les baux DHCP est essentiel pour :
- **Planifier** correctement la taille des pools d'adresses
- **Optimiser** les durÃ©es de bail selon le contexte
- **Diagnostiquer** les problÃ¨mes de connectivitÃ© rÃ©seau
- **GÃ©rer** efficacement les ressources IP

## Qu'est-ce qu'un bail DHCP ?

### DÃ©finition dÃ©taillÃ©e

Un **bail DHCP** est un contrat temporaire entre un serveur DHCP et un client, autorisant ce dernier Ã  utiliser une adresse IP spÃ©cifique pendant une durÃ©e dÃ©terminÃ©e.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Composants d'un bail DHCP                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ â”œâ”€ Adresse IP attribuÃ©e : 192.168.1.50                   â”‚
â”‚ â”œâ”€ Adresse MAC du client : 00:1A:2B:3C:4D:5E             â”‚
â”‚ â”œâ”€ Timestamp de dÃ©but : 2024-12-06 10:00:00              â”‚
â”‚ â”œâ”€ DurÃ©e du bail : 86400 secondes (24 heures)            â”‚
â”‚ â”œâ”€ Timestamp d'expiration : 2024-12-07 10:00:00          â”‚
â”‚ â”œâ”€ T1 (Renewal Time) : 43200s (12h, 50%)                 â”‚
â”‚ â”œâ”€ T2 (Rebinding Time) : 75600s (21h, 87.5%)             â”‚
â”‚ â”œâ”€ Serveur DHCP : 192.168.1.1                            â”‚
â”‚ â”œâ”€ Ã‰tat : BOUND (liÃ©)                                    â”‚
â”‚ â””â”€ Configuration associÃ©e : masque, passerelle, DNS...   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Analogie : Location d'appartement

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bail immobilier              Bail DHCP                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ Locataire                    Client (MAC address)        â”‚
â”‚ Appartement nÂ°5              Adresse IP 192.168.1.50     â”‚
â”‚ DurÃ©e : 1 an                 DurÃ©e : 24 heures           â”‚
â”‚ Loyer mensuel                Renouvellement pÃ©riodique   â”‚
â”‚ Ã€ l'Ã©chÃ©ance : renouveler    Ã€ 50% : demander renouvell. â”‚
â”‚ ou partir                    ou perdre l'IP              â”‚
â”‚ Si non renouvelÃ© :           Si non renouvelÃ© :          â”‚
â”‚   Appartement libre          IP retourne au pool         â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Pourquoi des baux temporaires ?

**Avantages fondamentaux :**

```
1. Gestion dynamique des ressources
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pool : 100 adresses IP disponibles                 â”‚
â”‚ Appareils possibles : 300 (laptops, smartphones)   â”‚
â”‚                                                    â”‚
â”‚ Avec baux :                                        â”‚
â”‚ â€¢ En moyenne 80 connectÃ©s simultanÃ©ment            â”‚
â”‚ â€¢ 100 IPs suffisent pour 300 appareils âœ“           â”‚
â”‚                                                    â”‚
â”‚ Sans baux (attribution permanente) :               â”‚
â”‚ â€¢ NÃ©cessiterait 300 IPs                            â”‚
â”‚ â€¢ Ou configuration manuelle Ã  chaque fois          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. RÃ©cupÃ©ration automatique
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Appareil Ã©teint/dÃ©connectÃ© :                       â”‚
â”‚ â€¢ Bail expire automatiquement                      â”‚
â”‚ â€¢ IP retourne au pool                              â”‚
â”‚ â€¢ Disponible pour d'autres                         â”‚
â”‚                                                    â”‚
â”‚ Pas besoin d'intervention manuelle âœ“               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3. FlexibilitÃ© de configuration
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Changement de DNS du rÃ©seau :                      â”‚
â”‚ â€¢ Modifier sur serveur DHCP                        â”‚
â”‚ â€¢ Au renouvellement, clients reÃ§oivent nouveau DNS â”‚
â”‚ â€¢ Propagation automatique                          â”‚
â”‚                                                    â”‚
â”‚ Pas besoin de reconfigurer 300 machines âœ“          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

4. MobilitÃ©
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Laptop utilisÃ© dans diffÃ©rents lieux :             â”‚
â”‚ â€¢ Bureau : 192.168.1.50 (bail 8h)                  â”‚
â”‚ â€¢ Maison : 192.168.0.15 (bail 24h)                 â”‚
â”‚ â€¢ CafÃ© : 10.0.0.123 (bail 1h)                      â”‚
â”‚                                                    â”‚
â”‚ Adaptation automatique Ã  chaque rÃ©seau âœ“           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Cycle de vie d'un bail DHCP

### Vue d'ensemble complÃ¨te

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Cycle de vie complet d'un bail DHCP             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   INIT      â”‚  Ã‰tat initial : pas d'IP
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ DHCPDISCOVER
       â”‚ DHCPOFFER
       â”‚ DHCPREQUEST
       â”‚ DHCPACK
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BOUND     â”‚  IP attribuÃ©e, utilisation normale
â”‚  (0-50%)    â”‚  Timer T1 actif
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ T1 expire (50% du bail)
       â”‚ Tentative renouvellement
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RENEWING   â”‚  Essais de renouvellement (unicast)
â”‚ (50-87.5%)  â”‚  Peut continuer Ã  utiliser l'IP
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Si ACK reÃ§u â†’ retour Ã  BOUND
       â”‚ Si timeout â†’ T2 expire (87.5%)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REBINDING   â”‚  Dernier effort (broadcast)
â”‚(87.5-100%)  â”‚  N'importe quel serveur peut rÃ©pondre
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Si ACK reÃ§u â†’ retour Ã  BOUND
       â”‚ Si expiration complÃ¨te (100%)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   INIT      â”‚  DOIT arrÃªter d'utiliser l'IP
â”‚             â”‚  Recommence depuis le dÃ©but
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Timeline dÃ©taillÃ©e d'un bail de 24 heures

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bail de 86400 secondes (24 heures)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Heure â”‚ Temps Ã©coulÃ©â”‚ %  â”‚ Ã‰tat      â”‚ Action
â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
00:00 â”‚     0s      â”‚ 0% â”‚ INIT      â”‚ DORA complet
00:00 â”‚     1s      â”‚ 0% â”‚ BOUND     â”‚ IP configurÃ©e âœ“
      â”‚             â”‚    â”‚           â”‚ Utilisation normale
      â”‚             â”‚    â”‚           â”‚
12:00 â”‚  43200s     â”‚50% â”‚ RENEWING  â”‚ T1 expire
      â”‚             â”‚    â”‚           â”‚ â†’ DHCPREQUEST unicast
12:00 â”‚  43201s     â”‚50% â”‚ BOUND     â”‚ ACK reÃ§u, renouvelÃ© âœ“
      â”‚             â”‚    â”‚           â”‚ Nouveau bail : 24h
      â”‚             â”‚    â”‚           â”‚
[Si renouvellement avait Ã©chouÃ© :]
      â”‚             â”‚    â”‚           â”‚
12:00 â”‚  43200s     â”‚50% â”‚ RENEWING  â”‚ T1 expire
      â”‚             â”‚    â”‚           â”‚ â†’ REQUEST (pas de rÃ©p.)
12:30 â”‚  45000s     â”‚52% â”‚ RENEWING  â”‚ Retry REQUEST
13:00 â”‚  46800s     â”‚54% â”‚ RENEWING  â”‚ Retry REQUEST
      â”‚             â”‚    â”‚           â”‚ [continues...]
      â”‚             â”‚    â”‚           â”‚
21:00 â”‚  75600s     â”‚87.5%â”‚REBINDING â”‚ T2 expire
      â”‚             â”‚    â”‚           â”‚ â†’ REQUEST broadcast
21:00 â”‚  75601s     â”‚87.5%â”‚BOUND     â”‚ ACK reÃ§u âœ“
      â”‚             â”‚    â”‚           â”‚
[Si tout Ã©choue :]
      â”‚             â”‚    â”‚           â”‚
24:00 â”‚  86400s     â”‚100%â”‚ INIT      â”‚ Bail expire
      â”‚             â”‚    â”‚           â”‚ DOIT arrÃªter IP âœ—
      â”‚             â”‚    â”‚           â”‚ Recommence DISCOVER
```

## Ã‰tats du client DHCP

### Machine Ã  Ã©tats dÃ©taillÃ©e

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Ã‰tats du client DHCP (RFC 2131)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â•”â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   INIT    â•‘  â€¢ Pas d'IP configurÃ©e
â•‘           â•‘  â€¢ Envoi DHCPDISCOVER
â•šâ•â•â•â•â•â•¤â•â•â•â•â•â•  â€¢ Attend DHCPOFFER
      â”‚
      â”‚ ReÃ§oit DHCPOFFER(s)
      â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ SELECTING â•‘  â€¢ Compare les offres
â•‘           â•‘  â€¢ Choisit un serveur
â•šâ•â•â•â•â•â•¤â•â•â•â•â•â•  â€¢ Envoie DHCPREQUEST
      â”‚
      â”‚ Attend DHCPACK
      â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   BOUND   â•‘  â€¢ IP configurÃ©e et utilisÃ©e
â•‘           â•‘  â€¢ Timer T1 (renewal) actif
â•šâ•â•â•â•â•â•¤â•â•â•â•â•â•  â€¢ Timer T2 (rebinding) actif
      â”‚        â€¢ Timer expiration actif
      â”‚
      â”‚ T1 expire (50%)
      â†“
â•”â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘ RENEWING  â•‘  â€¢ Tente renouvellement (unicast)
â•‘           â•‘  â€¢ Continue d'utiliser l'IP
â•šâ•â•â•â•â•â•¤â•â•â•â•â•â•  â€¢ RÃ©essaie pÃ©riodiquement
      â”‚
      â”œâ”€â†’ ACK reÃ§u â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                      â”‚
      â”‚ T2 expire (87.5%)    â”‚
      â†“                      â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•—                â”‚
â•‘ REBINDING â•‘                â”‚
â•‘           â•‘  â€¢ Broadcast Ã  tout serveur
â•šâ•â•â•â•â•â•¤â•â•â•â•â•â•  â€¢ Continue d'utiliser l'IP
      â”‚        â€¢ Dernier recours
      â”‚                      â”‚
      â”œâ”€â†’ ACK reÃ§u â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                      â”‚
      â”‚ Bail expire (100%)   â”‚
      â†“                      â”‚
â•”â•â•â•â•â•â•â•â•â•â•â•â•—                â”‚
â•‘   INIT    â•‘  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â•‘           â•‘  Retour Ã  BOUND
â•šâ•â•â•â•â•â•â•â•â•â•â•â•  avec nouveau bail
```

### Description dÃ©taillÃ©e de chaque Ã©tat

**1. INIT (Initialization)**
```
CaractÃ©ristiques :
â”œâ”€ Pas d'adresse IP
â”œâ”€ Interface rÃ©seau inactive (niveau IP)
â”œâ”€ Peut avoir lien physique actif (Ethernet/WiFi)
â””â”€ Ã‰tat initial au dÃ©marrage

Actions :
â”œâ”€ GÃ©nÃ¨re Transaction ID alÃ©atoire
â”œâ”€ Construit DHCPDISCOVER
â””â”€ Envoie en broadcast

Transitions :
â””â”€ ReÃ§oit DHCPOFFER â†’ SELECTING
```

**2. SELECTING (SÃ©lection d'une offre)**
```
CaractÃ©ristiques :
â”œâ”€ A reÃ§u une ou plusieurs offres
â”œâ”€ Toujours pas d'IP configurÃ©e
â””â”€ Doit choisir un serveur

Actions :
â”œâ”€ Collecte les offres (attente 1-3 secondes)
â”œâ”€ SÃ©lectionne une offre (gÃ©nÃ©ralement la premiÃ¨re)
â”œâ”€ Construit DHCPREQUEST avec :
â”‚   â€¢ Option 54 : Server Identifier (serveur choisi)
â”‚   â€¢ Option 50 : Requested IP (IP de l'offre)
â””â”€ Envoie REQUEST en broadcast

CritÃ¨res de sÃ©lection :
â”œâ”€ Premier reÃ§u (dÃ©faut)
â”œâ”€ Serveur prÃ©fÃ©rÃ© (si configurÃ©)
â”œâ”€ Meilleur bail (plus long)
â””â”€ Charge serveur (si indiquÃ©)

Transitions :
â”œâ”€ ReÃ§oit DHCPACK â†’ BOUND
â””â”€ ReÃ§oit DHCPNAK â†’ INIT
```

**3. BOUND (LiÃ© - Configuration active)**
```
CaractÃ©ristiques :
â”œâ”€ IP configurÃ©e et opÃ©rationnelle âœ“
â”œâ”€ Peut communiquer sur le rÃ©seau
â”œâ”€ Bail actif et valide
â””â”€ Utilisation normale

Timers actifs :
â”œâ”€ T1 (Renewal) : 50% du bail
â”œâ”€ T2 (Rebinding) : 87.5% du bail
â””â”€ Expiration : 100% du bail

Actions :
â”œâ”€ Utilise l'IP normalement
â”œâ”€ Surveille les timers
â””â”€ Attend expiration de T1

Transitions :
â”œâ”€ T1 expire â†’ RENEWING
â”œâ”€ DHCPFORCE-RENEW reÃ§u â†’ RENEWING
â””â”€ Utilisateur libÃ¨re IP â†’ INIT
```

**4. RENEWING (Renouvellement)**
```
CaractÃ©ristiques :
â”œâ”€ Continue d'utiliser l'IP âœ“
â”œâ”€ Tente de renouveler le bail
â”œâ”€ Communication UNICAST vers serveur original
â””â”€ Peut continuer pendant les tentatives

Timing :
â”œâ”€ DÃ©but : T1 (50% du bail)
â”œâ”€ Fin : T2 (87.5% du bail) ou ACK reÃ§u
â””â”€ RÃ©essais : PÃ©riodiques jusqu'Ã  T2

Actions :
â”œâ”€ Envoie DHCPREQUEST (unicast)
â”‚   â€¢ ciaddr : IP actuelle
â”‚   â€¢ Pas d'option 54 ni 50
â”‚   â€¢ Destination : serveur DHCP original
â”œâ”€ Attend DHCPACK
â””â”€ RÃ©essaie si timeout

Transitions :
â”œâ”€ ReÃ§oit DHCPACK â†’ BOUND (bail renouvelÃ©)
â”œâ”€ ReÃ§oit DHCPNAK â†’ INIT (recommencer)
â””â”€ T2 expire sans rÃ©ponse â†’ REBINDING
```

**5. REBINDING (Reliage - Dernier recours)**
```
CaractÃ©ristiques :
â”œâ”€ Continue d'utiliser l'IP âœ“
â”œâ”€ Serveur original ne rÃ©pond pas
â”œâ”€ Communication BROADCAST
â””â”€ Accepte n'importe quel serveur DHCP

Timing :
â”œâ”€ DÃ©but : T2 (87.5% du bail)
â”œâ”€ Fin : Expiration (100%) ou ACK reÃ§u
â””â”€ RÃ©essais : FrÃ©quents jusqu'Ã  expiration

Actions :
â”œâ”€ Envoie DHCPREQUEST (broadcast)
â”‚   â€¢ ciaddr : IP actuelle
â”‚   â€¢ Destination : 255.255.255.255
â”œâ”€ N'importe quel serveur peut rÃ©pondre
â””â”€ RÃ©essaie rapidement

Transitions :
â”œâ”€ ReÃ§oit DHCPACK â†’ BOUND (bail renouvelÃ©)
â”œâ”€ ReÃ§oit DHCPNAK â†’ INIT
â””â”€ Bail expire (100%) â†’ INIT (DOIT arrÃªter IP)
```

**6. INIT-REBOOT (RedÃ©marrage avec mÃ©moire)**
```
CaractÃ©ristiques :
â”œâ”€ Machine redÃ©marÃ©e
â”œâ”€ Se souvient de l'ancienne IP
â”œâ”€ VÃ©rifie si IP toujours valide
â””â”€ Optimisation (Ã©vite DORA complet si possible)

Actions :
â”œâ”€ Lit configuration sauvegardÃ©e
â”‚   â€¢ IP prÃ©cÃ©dente : 192.168.1.50
â”‚   â€¢ Bail expirÃ© ? VÃ©rifier timestamp
â”œâ”€ Envoie DHCPREQUEST
â”‚   â€¢ Option 50 : Requested IP (ancienne)
â”‚   â€¢ Broadcast
â””â”€ Attend confirmation

Transitions :
â”œâ”€ ReÃ§oit DHCPACK â†’ BOUND (IP toujours valide âœ“)
â”œâ”€ ReÃ§oit DHCPNAK â†’ INIT (IP plus valide âœ—)
â””â”€ Timeout â†’ INIT
```

## Timers T1, T2 et Expiration

### Calcul des timers

Les timers T1 et T2 sont calculÃ©s en pourcentage du bail total :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Calcul des timers (valeurs par dÃ©faut RFC 2131)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Soit L = durÃ©e du bail (Lease Time)

T1 (Renewal Time) :
â”œâ”€ Valeur : L Ã— 0.5 (50%)
â”œâ”€ Option DHCP : 58
â””â”€ Calcul : peut Ãªtre fourni par serveur ou calculÃ©

T2 (Rebinding Time) :
â”œâ”€ Valeur : L Ã— 0.875 (87.5%)
â”œâ”€ Option DHCP : 59
â””â”€ Calcul : peut Ãªtre fourni par serveur ou calculÃ©

Expiration :
â””â”€ Valeur : L Ã— 1.0 (100%)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Exemples selon durÃ©es de bail                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ Bail 1 heure (3600s) :                                   â”‚
â”‚ â”œâ”€ T1 : 1800s (30 minutes)                               â”‚
â”‚ â”œâ”€ T2 : 3150s (52.5 minutes)                             â”‚
â”‚ â””â”€ Exp: 3600s (60 minutes)                               â”‚
â”‚                                                          â”‚
â”‚ Bail 8 heures (28800s) :                                 â”‚
â”‚ â”œâ”€ T1 : 14400s (4 heures)                                â”‚
â”‚ â”œâ”€ T2 : 25200s (7 heures)                                â”‚
â”‚ â””â”€ Exp: 28800s (8 heures)                                â”‚
â”‚                                                          â”‚
â”‚ Bail 24 heures (86400s) :                                â”‚
â”‚ â”œâ”€ T1 : 43200s (12 heures)                               â”‚
â”‚ â”œâ”€ T2 : 75600s (21 heures)                               â”‚
â”‚ â””â”€ Exp: 86400s (24 heures)                               â”‚
â”‚                                                          â”‚
â”‚ Bail 7 jours (604800s) :                                 â”‚
â”‚ â”œâ”€ T1 : 302400s (3.5 jours)                              â”‚
â”‚ â”œâ”€ T2 : 529200s (6.125 jours)                            â”‚
â”‚ â””â”€ Exp: 604800s (7 jours)                                â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Visualisation des phases

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ReprÃ©sentation visuelle d'un bail de 24h                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

0h                    12h                   21h          24h
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     â”‚                      â”‚            â”‚
â”‚   PHASE BOUND       â”‚   PHASE RENEWING     â”‚  REBINDING â”‚
â”‚   (utilisation      â”‚   (renouvellement    â”‚  (dernier  â”‚
â”‚    normale)         â”‚    unicast)          â”‚   recours) â”‚
â”‚                     â”‚                      â”‚            â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚
â”‚                     â”‚                      â”‚            â”‚
â”‚ Client utilise IP   â”‚ Tente renouvellement â”‚ Broadcast  â”‚
â”‚ Pas d'action rÃ©seau â”‚ Peut continuer util. â”‚ Urgent !   â”‚
â”‚                     â”‚                      â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       50%                   87.5%               100%

Largeur des phases :
â”œâ”€ BOUND : 50% du temps total (12h)
â”œâ”€ RENEWING : 37.5% du temps (9h)
â””â”€ REBINDING : 12.5% du temps (3h)

ProbabilitÃ© de succÃ¨s :
â”œâ”€ BOUND : Aucune action (100% stable)
â”œâ”€ RENEWING : 99%+ (serveur gÃ©nÃ©ralement disponible)
â””â”€ REBINDING : 95% (si serveur vraiment en panne)
```

### Pourquoi ces pourcentages ?

```
50% (T1) - Renewal :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Assez tÃ´t pour plusieurs tentatives              â”‚
â”‚ â€¢ Laisse 50% du bail pour rÃ©soudre problÃ¨mes       â”‚
â”‚ â€¢ Ã‰vite charge rÃ©seau juste avant expiration       â”‚
â”‚ â€¢ Serveur a le temps de gÃ©rer la requÃªte           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

87.5% (T2) - Rebinding :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Dernier recours avant expiration                 â”‚
â”‚ â€¢ 12.5% du bail restant (3h pour bail 24h)         â”‚
â”‚ â€¢ Temps suffisant pour broadcast et rÃ©ponse        â”‚
â”‚ â€¢ Urgence sans Ãªtre panique                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

100% - Expiration :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Limite stricte d'utilisation                     â”‚
â”‚ â€¢ Client DOIT arrÃªter d'utiliser l'IP              â”‚
â”‚ â€¢ SÃ©curitÃ© : Ã©vite IPs orphelines                  â”‚
â”‚ â€¢ Force recommencement propre                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Processus de renouvellement dÃ©taillÃ©

### Renouvellement normal (T1)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ScÃ©nario : Renouvellement rÃ©ussi Ã  T1                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ã‰tat initial :
â”œâ”€ Client : 192.168.1.50
â”œâ”€ Bail : 24h, attribuÃ© Ã  10:00
â”œâ”€ T1 : 22:00 (50% = 12h plus tard)
â””â”€ Ã‰tat : BOUND

Timeline :

22:00:00 : Timer T1 expire
           â””â”€ Passage Ã©tat BOUND â†’ RENEWING

22:00:00.100 : Construction DHCPREQUEST
               â”œâ”€ Op : BOOTREQUEST (1)
               â”œâ”€ ciaddr : 192.168.1.50
               â”œâ”€ Transaction ID : nouveau
               â””â”€ Pas d'options 50 ni 54

22:00:00.200 : Envoi DHCPREQUEST
               â”œâ”€ Destination IP : 192.168.1.1 (UNICAST)
               â”œâ”€ Destination MAC : MAC du serveur
               â””â”€ Port : 67

22:00:00.300 : Serveur reÃ§oit REQUEST
               â”œâ”€ Identifie client par MAC
               â”œâ”€ VÃ©rifie validitÃ© du bail
               â”œâ”€ Approuve renouvellement
               â””â”€ PrÃ©pare DHCPACK

22:00:00.400 : Serveur envoie DHCPACK
               â”œâ”€ yiaddr : 192.168.1.50
               â”œâ”€ Option 51 : Lease Time = 86400 (24h)
               â”œâ”€ Option 58 : T1 = 43200 (12h)
               â”œâ”€ Option 59 : T2 = 75600 (21h)
               â””â”€ Autres options (DNS, gateway...)

22:00:00.500 : Client reÃ§oit ACK
               â””â”€ Passage Ã©tat RENEWING â†’ BOUND

22:00:00.600 : Client met Ã  jour :
               â”œâ”€ Nouveau bail : 24h Ã  partir de maintenant
               â”œâ”€ Nouvelle Ã©chÃ©ance : demain 22:00
               â”œâ”€ Nouveau T1 : demain 10:00 (12h)
               â”œâ”€ Nouveau T2 : demain 19:00 (21h)
               â””â”€ Continue utilisation normale âœ“

DurÃ©e totale : ~0.5 seconde
Impact utilisateur : Aucun (transparent)
```

### Ã‰chec de renouvellement : passage au rebinding

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ScÃ©nario : Serveur ne rÃ©pond pas Ã  T1                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ã‰tat initial :
â”œâ”€ Client : 192.168.1.50
â”œâ”€ Bail attribuÃ© Ã  10:00, expire Ã  10:00 lendemain
â””â”€ T1 : 22:00, T2 : 07:00 lendemain

Timeline :

22:00:00 : T1 expire â†’ Ã‰tat RENEWING
22:00:00 : DHCPREQUEST (unicast) â†’ Pas de rÃ©ponse
22:02:00 : Retry DHCPREQUEST â†’ Pas de rÃ©ponse
22:05:00 : Retry DHCPREQUEST â†’ Pas de rÃ©ponse
22:10:00 : Retry DHCPREQUEST â†’ Pas de rÃ©ponse
...
23:00:00 : Retry DHCPREQUEST â†’ Pas de rÃ©ponse
...
07:00:00 : T2 expire â†’ Ã‰tat REBINDING âš ï¸

07:00:00 : DHCPREQUEST (BROADCAST)
           â”œâ”€ Destination IP : 255.255.255.255
           â”œâ”€ Destination MAC : FF:FF:FF:FF:FF:FF
           â””â”€ N'importe quel serveur peut rÃ©pondre

ScÃ©narios possibles :

ScÃ©nario A : Serveur original revient
07:00:01 : Serveur rÃ©pond DHCPACK
           â””â”€ Ã‰tat REBINDING â†’ BOUND âœ“

ScÃ©nario B : Autre serveur DHCP rÃ©pond
07:00:01 : Serveur backup rÃ©pond DHCPACK
           â””â”€ Ã‰tat REBINDING â†’ BOUND âœ“
           â””â”€ Nouveau serveur devient rÃ©fÃ©rence

ScÃ©nario C : Aucun serveur ne rÃ©pond
07:00:01 : Pas de rÃ©ponse
07:00:10 : Retry BROADCAST
...
09:59:50 : Retry BROADCAST
10:00:00 : EXPIRATION COMPLÃˆTE âœ—
           â”œâ”€ Ã‰tat REBINDING â†’ INIT
           â”œâ”€ Client DOIT arrÃªter d'utiliser 192.168.1.50
           â”œâ”€ DÃ©configure interface rÃ©seau
           â””â”€ Commence nouveau DORA
```

### StratÃ©gie de retry pendant RENEWING

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Algorithme de retry pendant RENEWING                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Principe : Exponential backoff with jitter

T1 = 12h00 (dÃ©but RENEWING)
T2 = 21h00 (fin RENEWING)
DurÃ©e phase RENEWING : 9 heures (32400 secondes)

Tentatives :
â”œâ”€ 12h00m00s : 1Ã¨re tentative (immÃ©diate)
â”œâ”€ 12h01m00s : 2Ã¨me tentative (60s plus tard)
â”œâ”€ 12h03m00s : 3Ã¨me tentative (120s plus tard)
â”œâ”€ 12h07m00s : 4Ã¨me tentative (240s plus tard)
â”œâ”€ 12h15m00s : 5Ã¨me tentative (480s plus tard)
â”œâ”€ 12h31m00s : 6Ã¨me tentative (960s plus tard)
â”œâ”€ 13h03m00s : 7Ã¨me tentative (1920s plus tard)
â”œâ”€ 14h07m00s : 8Ã¨me tentative (3840s plus tard)
â””â”€ [continues avec dÃ©lai max ~30 minutes]

Avantages :
âœ“ DÃ©tection rapide si serveur disponible
âœ“ Ã‰vite surcharge rÃ©seau si serveur down
âœ“ Randomization Ã©vite tempÃªtes de requÃªtes
âœ“ Laisse 9h pour rÃ©soudre le problÃ¨me
```

## Gestion des baux cÃ´tÃ© serveur

### Base de donnÃ©es des baux

Un serveur DHCP maintient une base de donnÃ©es de tous les baux actifs :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Exemple de base de donnÃ©es de baux (serveur DHCP)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IP Address    â”‚ MAC Address       â”‚ Ã‰tat    â”‚ DÃ©but    â”‚ Fin      â”‚ Hostname
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
192.168.1.50  â”‚ 00:1A:2B:3C:4D:5E â”‚ ACTIVE  â”‚ 10:00:00 â”‚ 10:00:00 â”‚ laptop-bob
              â”‚                   â”‚         â”‚ 06/12    â”‚ 07/12    â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
192.168.1.51  â”‚ AA:BB:CC:DD:EE:FF â”‚ ACTIVE  â”‚ 11:30:00 â”‚ 11:30:00 â”‚ phone-alice
              â”‚                   â”‚         â”‚ 06/12    â”‚ 07/12    â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
192.168.1.52  â”‚ 11:22:33:44:55:66 â”‚ OFFERED â”‚ 14:20:00 â”‚ 14:25:00 â”‚ (unknown)
              â”‚                   â”‚         â”‚ 06/12    â”‚ 06/12    â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
192.168.1.53  â”‚ 77:88:99:AA:BB:CC â”‚ EXPIRED â”‚ 09:00:00 â”‚ 09:00:00 â”‚ tablet-charlie
              â”‚                   â”‚         â”‚ 05/12    â”‚ 06/12    â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
192.168.1.54  â”‚ (none)            â”‚ FREE    â”‚ -        â”‚ -        â”‚ -
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€
192.168.1.55  â”‚ DE:AD:BE:EF:00:01 â”‚ DECLINEDâ”‚ 15:10:00 â”‚ -        â”‚ (conflict)
              â”‚                   â”‚         â”‚ 06/12    â”‚          â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€

Ã‰tats possibles :
â”œâ”€ FREE : IP disponible dans le pool
â”œâ”€ OFFERED : IP proposÃ©e, en attente de REQUEST (5 min)
â”œâ”€ ACTIVE : IP attribuÃ©e et bail actif
â”œâ”€ EXPIRED : Bail expirÃ©, IP sera libÃ©rÃ©e bientÃ´t
â”œâ”€ DECLINED : IP en conflit, temporairement retirÃ©e
â””â”€ RESERVED : IP rÃ©servÃ©e pour une MAC spÃ©cifique
```

### Fichier de baux (exemple Linux - ISC DHCP)

```bash
# /var/lib/dhcp/dhcpd.leases

# Bail actif
lease 192.168.1.50 {
  starts 5 2024/12/06 09:00:00;
  ends 6 2024/12/07 09:00:00;
  cltt 5 2024/12/06 09:00:00;
  binding state active;
  next binding state free;
  rewind binding state free;
  hardware ethernet 00:1a:2b:3c:4d:5e;
  uid "\001\000\032+<M^";
  client-hostname "laptop-bob";
}

# Bail expirÃ© (sera nettoyÃ©)
lease 192.168.1.53 {
  starts 4 2024/12/05 08:00:00;
  ends 5 2024/12/06 08:00:00;
  tstp 5 2024/12/06 08:00:00;
  binding state free;
  hardware ethernet 77:88:99:aa:bb:cc;
  client-hostname "tablet-charlie";
}

# Bail abandonnÃ© (DECLINE)
lease 192.168.1.55 {
  starts 5 2024/12/06 14:10:00;
  ends never;
  abandoned;
  hardware ethernet de:ad:be:ef:00:01;
}
```

### Ã‰tats des baux cÃ´tÃ© serveur

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Machine Ã  Ã©tats d'un bail (cÃ´tÃ© serveur)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FREE   â”‚  IP disponible dans le pool
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â”‚ DISCOVER reÃ§u â†’ OFFER envoyÃ©
      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ OFFERED  â”‚  IP proposÃ©e, en attente (5 min timeout)
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
      â”‚
      â”œâ”€â†’ Timeout (5 min) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                             â”‚
      â”‚ REQUEST reÃ§u (acceptation)  â”‚
      â†“                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  ACTIVE  â”‚  Bail attribuÃ©         â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                        â”‚
      â”‚                             â”‚
      â”œâ”€â†’ RENEW reÃ§u (prolonge) â”€â”€â”€â”€â”¤
      â”‚                             â”‚
      â”‚ RELEASE reÃ§u (libÃ©ration)   â”‚
      â”‚ ou Bail expire              â”‚
      â†“                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚ EXPIRED  â”‚  En attente nettoyage  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                        â”‚
      â”‚                             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚   FREE   â”‚  â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  Retour au pool
```

### Nettoyage et recyclage

```
Processus de nettoyage (garbage collection) :

PÃ©riodicitÃ© : Toutes les heures (configurable)

Actions :
â”œâ”€ Parcourir tous les baux
â”œâ”€ Identifier les baux expirÃ©s depuis >24h
â”œâ”€ Les supprimer de la base
â”œâ”€ LibÃ©rer mÃ©moire
â””â”€ Logger les statistiques

Baux DECLINED (conflits) :
â”œâ”€ MarquÃ©s "abandoned"
â”œâ”€ RetirÃ©s du pool temporairement
â”œâ”€ DurÃ©e : 1 heure par dÃ©faut
â”œâ”€ AprÃ¨s : retour au pool
â””â”€ Admin doit investiguer cause conflit

Exemple de log :
[2024-12-06 10:00:00] Garbage collection started
[2024-12-06 10:00:01] Found 3 expired leases
[2024-12-06 10:00:01] Removed 192.168.1.75 (expired 26h ago)
[2024-12-06 10:00:01] Removed 192.168.1.82 (expired 48h ago)
[2024-12-06 10:00:01] Removed 192.168.1.93 (expired 30h ago)
[2024-12-06 10:00:01] Garbage collection completed
[2024-12-06 10:00:01] Pool statistics: 150/200 IPs available
```

## StratÃ©gies de durÃ©e de bail

### Facteurs Ã  considÃ©rer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Facteurs influenÃ§ant le choix de la durÃ©e du bail        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. Taille du pool vs nombre de clients
   â”œâ”€ Pool large (IPs abondantes) â†’ Bail long possible
   â””â”€ Pool serrÃ© (IPs limitÃ©es) â†’ Bail court nÃ©cessaire

2. MobilitÃ© des clients
   â”œâ”€ Clients fixes (postes bureau) â†’ Bail long (7 jours)
   â””â”€ Clients mobiles (cafÃ©, aÃ©roport) â†’ Bail court (1h)

3. StabilitÃ© requise
   â”œâ”€ Serveurs/imprimantes â†’ Bail trÃ¨s long ou rÃ©servation
   â””â”€ InvitÃ©s â†’ Bail court

4. FrÃ©quence des changements de configuration
   â”œâ”€ Config stable â†’ Bail long
   â””â”€ Config change souvent â†’ Bail court

5. Charge rÃ©seau
   â”œâ”€ RÃ©seau chargÃ© â†’ Bail long (moins de trafic DHCP)
   â””â”€ RÃ©seau peu chargÃ© â†’ FlexibilitÃ©

6. CapacitÃ©s de monitoring
   â”œâ”€ Monitoring faible â†’ Bail long (moins de problÃ¨mes)
   â””â”€ Monitoring fort â†’ Bail court acceptable
```

### Recommandations par type de rÃ©seau

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DurÃ©es recommandÃ©es selon le contexte                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚ RÃ‰SEAU DOMESTIQUE
â”‚ â”œâ”€ Type : Box Internet
â”‚ â”œâ”€ DurÃ©e : 24 heures (86400s)
â”‚ â”œâ”€ Raison : Ã‰quilibre stabilitÃ©/flexibilitÃ©
â”‚ â””â”€ Clients : 5-20 appareils, rotation faible
â”‚
â”‚ ENTREPRISE - POSTES FIXES (Ethernet)
â”‚ â”œâ”€ Type : Bureau, postes de travail
â”‚ â”œâ”€ DurÃ©e : 7 jours (604800s)
â”‚ â”œâ”€ Raison : TrÃ¨s stable, changement rare
â”‚ â””â”€ Alternative : RÃ©servation DHCP recommandÃ©e
â”‚
â”‚ ENTREPRISE - WIFI EMPLOYÃ‰S
â”‚ â”œâ”€ Type : Laptops employÃ©s
â”‚ â”œâ”€ DurÃ©e : 8-24 heures (28800-86400s)
â”‚ â”œâ”€ Raison : MobilitÃ© modÃ©rÃ©e (bureau/maison)
â”‚ â””â”€ Compromis : StabilitÃ© pendant journÃ©e travail
â”‚
â”‚ ENTREPRISE - WIFI INVITÃ‰S
â”‚ â”œâ”€ Type : Visiteurs, contractors
â”‚ â”œâ”€ DurÃ©e : 2-4 heures (7200-14400s)
â”‚ â”œâ”€ Raison : Forte rotation, pool limitÃ©
â”‚ â””â”€ RÃ©cupÃ©ration rapide des IPs
â”‚
â”‚ HOTSPOT PUBLIC (CafÃ©, AÃ©roport, HÃ´tel)
â”‚ â”œâ”€ Type : Clients de passage
â”‚ â”œâ”€ DurÃ©e : 30-60 minutes (1800-3600s)
â”‚ â”œâ”€ Raison : TrÃ¨s forte rotation
â”‚ â””â”€ Pool : Peut Ãªtre petit avec baux courts
â”‚
â”‚ Ã‰VÃ‰NEMENT / CONFÃ‰RENCE
â”‚ â”œâ”€ Type : Participants temporaires
â”‚ â”œâ”€ DurÃ©e : 4-8 heures (14400-28800s)
â”‚ â”œâ”€ Raison : DurÃ©e de l'Ã©vÃ©nement
â”‚ â””â”€ Ã‰vite renouvellements pendant sessions
â”‚
â”‚ DATA CENTER / SERVEURS
â”‚ â”œâ”€ Type : VMs, conteneurs
â”‚ â”œâ”€ DurÃ©e : Infini ou trÃ¨s long
â”‚ â”œâ”€ Raison : IPs stables pour monitoring
â”‚ â””â”€ Alternative : IP statique prÃ©fÃ©rable
â”‚
â”‚ LABORATOIRE / DEV / TEST
â”‚ â”œâ”€ Type : Machines de test
â”‚ â”œâ”€ DurÃ©e : TrÃ¨s long (7+ jours) ou infini
â”‚ â”œâ”€ Raison : StabilitÃ© pour tests reproductibles
â”‚ â””â”€ Changements frÃ©quents â†’ Bail court (1h)
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Calcul de la taille du pool

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Formule pour dimensionner un pool DHCP                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Formule de base :
Pool size = (Peak concurrent users) Ã— (1 + Safety margin)

Variables :
â”œâ”€ Peak concurrent : Maximum d'utilisateurs simultanÃ©s
â”œâ”€ Safety margin : Marge de sÃ©curitÃ© (10-20%)
â””â”€ DurÃ©e de bail : Influence indirecte via turnover

Exemple 1 : Entreprise (100 employÃ©s)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ EmployÃ©s : 100
â”œâ”€ Taux prÃ©sence : 80% (20% absents/congÃ©s/dÃ©placements)
â”œâ”€ SimultanÃ©s : 80 personnes
â”œâ”€ Appareils par personne : 1.5 (laptop + phone)
â”œâ”€ Total simultanÃ© : 80 Ã— 1.5 = 120 appareils
â”œâ”€ Marge sÃ©curitÃ© : 20%
â””â”€ Pool requis : 120 Ã— 1.2 = 144 IPs

Recommandation : Pool de 150-200 IPs
DurÃ©e bail : 8 heures (journÃ©e de travail)

Exemple 2 : CafÃ© (50 places)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ Places : 50
â”œâ”€ Taux occupation moyen : 60%
â”œâ”€ SimultanÃ©s : 30 clients
â”œâ”€ Appareils par client : 1.3 (laptop/phone/tablette)
â”œâ”€ Total simultanÃ© : 30 Ã— 1.3 = 39 appareils
â”œâ”€ DurÃ©e visite moyenne : 1.5 heures
â”œâ”€ Bail : 1 heure
â”‚   â””â”€ Turnover : Quelques IPs libÃ©rÃ©es chaque heure
â”œâ”€ Marge : 30%
â””â”€ Pool requis : 39 Ã— 1.3 = 51 IPs

Recommandation : Pool de 50-70 IPs
DurÃ©e bail : 1 heure (rotation rapide)

Exemple 3 : ConfÃ©rence (500 participants)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”œâ”€ Participants : 500
â”œâ”€ PrÃ©sence simultanÃ©e : 90% (450 personnes)
â”œâ”€ Appareils par personne : 2 (laptop + phone)
â”œâ”€ Total simultanÃ© : 450 Ã— 2 = 900 appareils
â”œâ”€ DurÃ©e bail : 8 heures (durÃ©e confÃ©rence)
â”œâ”€ Marge : 10% (Ã©vÃ©nement contrÃ´lÃ©)
â””â”€ Pool requis : 900 Ã— 1.1 = 990 IPs

Recommandation : Pool de 1000 IPs (2Ã— /22)
DurÃ©e bail : 8 heures
```

## ProblÃ¨mes courants et solutions

### Ã‰puisement du pool (Pool exhaustion)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProblÃ¨me : Plus d'IPs disponibles                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SymptÃ´me :
â”œâ”€ Nouveaux clients ne reÃ§oivent pas d'IP
â”œâ”€ Serveur log : "No free leases"
â””â”€ Clients restent en Ã©tat INIT ou obtiennent 169.254.x.x

Causes possibles :

1. Pool trop petit
   â”œâ”€ Solution : Agrandir le pool (/24 â†’ /23)
   â””â”€ Ou : Ajouter un deuxiÃ¨me serveur DHCP

2. Bail trop long
   â”œâ”€ IPs bloquÃ©es longtemps par clients partis
   â”œâ”€ Solution : RÃ©duire durÃ©e de bail
   â””â”€ Exemple : 24h â†’ 4h dans un cafÃ©

3. Baux "zombies" (clients Ã©teints)
   â”œâ”€ Clients ne libÃ¨rent pas IP (pas de RELEASE)
   â”œâ”€ Solution : Baux plus courts
   â””â”€ Ou : Nettoyage manuel pÃ©riodique

4. Attaque DoS
   â”œâ”€ Attaquant demande toutes les IPs
   â”œâ”€ Solution : DHCP snooping, rate limiting
   â””â”€ Bloquer MAC sources suspectes

Actions immÃ©diates :
â”œâ”€ VÃ©rifier baux actifs vs expirÃ©s
â”œâ”€ LibÃ©rer manuellement baux anciens
â”œâ”€ RÃ©duire temporairement durÃ©e de bail
â””â”€ Planifier expansion du pool

Commandes de diagnostic :
# Linux (ISC DHCP)
dhcp-lease-list
dhcpd-pools -c /etc/dhcp/dhcpd.conf -l /var/lib/dhcp/dhcpd.leases

# Windows Server
Get-DhcpServerv4Scope | Get-DhcpServerv4ScopeStatistics
```

### Baux non renouvelÃ©s (Serveur inaccessible)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProblÃ¨me : Serveur DHCP ne rÃ©pond plus                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Timeline du problÃ¨me :

T = 0h : Serveur DHCP tombe en panne
         â”œâ”€ Clients en Ã©tat BOUND : Pas d'impact immÃ©diat âœ“
         â””â”€ Nouveaux clients : Ne peuvent pas obtenir IP âœ—

T = +12h : Premiers clients atteignent T1 (50%)
           â”œâ”€ Tentent renouvellement (RENEWING)
           â”œâ”€ Pas de rÃ©ponse du serveur
           â””â”€ Continuent d'utiliser IP (OK) âœ“

T = +21h : Premiers clients atteignent T2 (87.5%)
           â”œâ”€ Ã‰tat REBINDING
           â”œâ”€ Broadcast, toujours pas de rÃ©ponse
           â””â”€ Continuent d'utiliser IP (OK) âœ“

T = +24h : Premiers clients atteignent expiration (100%)
           â”œâ”€ DOIVENT arrÃªter d'utiliser IP âœ—
           â”œâ”€ Perte de connectivitÃ©
           â””â”€ Impact utilisateur majeur

Solution : Haute disponibilitÃ© DHCP

Option 1 : Failover (DHCP HA)
â”œâ”€ Deux serveurs DHCP synchronisÃ©s
â”œâ”€ Pool partagÃ© ou divisÃ©
â”œâ”€ Si primaire tombe, secondaire prend le relais
â””â”€ Transparent pour les clients âœ“

Option 2 : Split scope (80/20)
â”œâ”€ Serveur A gÃ¨re 80% du pool (192.168.1.50-189)
â”œâ”€ Serveur B gÃ¨re 20% du pool (192.168.1.190-200)
â”œâ”€ Si A tombe, B continue avec ses 20%
â””â”€ DÃ©gradÃ© mais fonctionnel

Option 3 : Load balancing
â”œâ”€ 50/50 : Chaque serveur gÃ¨re 50% des requÃªtes
â”œâ”€ Pool partagÃ©
â””â”€ Haute disponibilitÃ© ET performance
```

### Conflits d'adresse IP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProblÃ¨me : Deux machines avec la mÃªme IP                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ScÃ©nario typique :

Client A reÃ§oit 192.168.1.50 via DHCP
Imprimante B configurÃ©e en statique : 192.168.1.50
â†’ Conflit ! âœ—

DÃ©tection :

Par le client DHCP :
â”œâ”€ ARP Probe aprÃ¨s rÃ©ception DHCPACK
â”œâ”€ Si rÃ©ponse reÃ§ue â†’ Conflit dÃ©tectÃ©
â”œâ”€ Client envoie DHCPDECLINE
â””â”€ Demande nouvelle IP

Par un utilisateur :
â”œâ”€ Erreur "IP address conflict" (Windows)
â”œâ”€ ProblÃ¨mes rÃ©seau intermittents
â””â”€ Diagnostics manuels requis

RÃ©solution :

1. PrÃ©vention :
   â”œâ”€ SÃ©parer clairement pool DHCP et IPs statiques
   â”œâ”€ Pool DHCP : 192.168.1.50-200
   â”œâ”€ IPs statiques : 192.168.1.10-49
   â””â”€ Documenter les attributions statiques

2. Ping-check (serveur DHCP) :
   â”œâ”€ Serveur ping l'IP avant de l'offrir
   â”œâ”€ Si rÃ©ponse â†’ Skip cette IP
   â””â”€ Offre IP suivante

3. ARP check (serveur DHCP) :
   â”œâ”€ Serveur envoie ARP Request
   â”œâ”€ Si rÃ©ponse â†’ IP utilisÃ©e
   â””â”€ Mark as conflict

4. DHCP Conflict Detection :
   # Configuration ISC DHCP
   ping-check true;
   ping-timeout 1;

   # Configuration Windows Server DHCP
   Set-DhcpServerv4OptionValue -ComputerName DHCP1 `
     -OptionId 60 -Value "MSFT 5.0"
   Set-DhcpServerv4DnsSetting -ComputerName DHCP1 `
     -DynamicUpdates Always -DeleteDnsRRonLeaseExpiry $True

5. EnquÃªte forensique :
   â”œâ”€ Identifier les deux machines (ARP table)
   â”œâ”€ Corriger la machine en statique
   â””â”€ LibÃ©rer le bail DHCP si nÃ©cessaire
```

### Baux "collants" (Sticky leases)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ProblÃ¨me : Client reÃ§oit toujours la mÃªme IP             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Comportement observÃ© :
â”œâ”€ Client A se dÃ©connecte
â”œâ”€ Bail expire aprÃ¨s 24h
â”œâ”€ Client A se reconnecte 2 jours plus tard
â””â”€ ReÃ§oit la mÃªme IP : 192.168.1.50

Pourquoi ?
Nombreux serveurs DHCP mÃ©morisent l'association MACâ†”IP :
â”œâ”€ PrÃ©fÃ©rence pour la derniÃ¨re IP utilisÃ©e
â”œâ”€ AmÃ©liore stabilitÃ© (logs, monitoring)
â”œâ”€ Ã‰vite confusion utilisateurs
â””â”€ Facilite dÃ©pannage

ImplÃ©mentation :
# ISC DHCP
one-lease-per-client true;  # Une seule IP par MAC

# Windows Server DHCP
Conflict detection : 1-2 attempts

Est-ce un problÃ¨me ?
Non, gÃ©nÃ©ralement souhaitable :
âœ“ Logs cohÃ©rents
âœ“ RÃ¨gles firewall stables
âœ“ Monitoring simplifiÃ©
âœ“ ExpÃ©rience utilisateur constante

Quand c'est problÃ©matique :
âœ— Tests rÃ©seau (besoin IPs variÃ©es)
âœ— DÃ©mÃ©nagement physique de machine
âœ— Clonage de machines (mÃªme MAC)

Solution pour forcer nouvelle IP :
# LibÃ©rer explicitement
ipconfig /release    (Windows)
dhclient -r          (Linux)

# Nouveau MAC (virtuel)
ip link set dev eth0 address 02:00:00:00:00:01

# Ou attendre expiration complÃ¨te + nettoyage serveur
```

## Haute disponibilitÃ© DHCP

### Architecture Failover

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DHCP Failover (High Availability)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Topologie :

     RÃ©seau 192.168.1.0/24
            â”‚
      â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
      â”‚           â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Serveur A  â”‚ â”‚ Serveur B â”‚
â”‚ PRIMARY    â”‚ â”‚ SECONDARY â”‚
â”‚ .1.10      â”‚ â”‚ .1.11     â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚           â”‚
      â”‚  Sync     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Port TCP 647

Configuration :
â”œâ”€ Pool partagÃ© : 192.168.1.50-200
â”œâ”€ Synchronisation continue des baux
â”œâ”€ Heartbeat entre serveurs
â””â”€ Bascule automatique si panne

Modes de fonctionnement :

1. Mode actif/actif (Load Balance)
   â”œâ”€ Les deux servent des clients
   â”œâ”€ RÃ©partition 50/50
   â”œâ”€ Pool partagÃ©
   â””â”€ Meilleure performance

2. Mode actif/passif (Hot Standby)
   â”œâ”€ Primaire sert les clients
   â”œâ”€ Secondaire en attente
   â”œâ”€ Bascule si primaire down
   â””â”€ Plus simple Ã  gÃ©rer

Ã‰tats de synchronisation :
â”œâ”€ NORMAL : Sync OK, les deux opÃ©rationnels
â”œâ”€ COMMUNICATIONS-INTERRUPTED : Pas de sync
â”œâ”€ PARTNER-DOWN : Partenaire dÃ©tectÃ© down
â”œâ”€ POTENTIAL-CONFLICT : Risque de conflit
â””â”€ RESOLUTION-INTERRUPTED : ProblÃ¨me rÃ©solution
```

### Configuration Failover (ISC DHCP)

```
# /etc/dhcp/dhcpd.conf - Serveur PRIMARY

failover peer "dhcp-failover" {
  primary;
  address 192.168.1.10;      # IP de ce serveur
  port 647;
  peer address 192.168.1.11; # IP du partenaire
  peer port 647;
  max-response-delay 60;
  max-unacked-updates 10;
  mclt 3600;                 # Maximum Client Lead Time
  split 128;                 # Load balance 50/50 (255=100%)
  load balance max seconds 3;
}

subnet 192.168.1.0 netmask 255.255.255.0 {
  pool {
    failover peer "dhcp-failover";
    range 192.168.1.50 192.168.1.200;
  }
  option routers 192.168.1.1;
  option domain-name-servers 192.168.1.10, 8.8.8.8;
}

# /etc/dhcp/dhcpd.conf - Serveur SECONDARY

failover peer "dhcp-failover" {
  secondary;
  address 192.168.1.11;      # IP de ce serveur
  port 647;
  peer address 192.168.1.10; # IP du partenaire
  peer port 647;
  max-response-delay 60;
  max-unacked-updates 10;
  load balance max seconds 3;
}

subnet 192.168.1.0 netmask 255.255.255.0 {
  pool {
    failover peer "dhcp-failover";
    range 192.168.1.50 192.168.1.200;
  }
  option routers 192.168.1.1;
  option domain-name-servers 192.168.1.10, 8.8.8.8;
}
```

### ScÃ©nario de panne avec Failover

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ScÃ©nario : Panne du serveur primaire                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Ã‰tat normal :
â”œâ”€ PRIMARY (A) : Actif, sert 50% des clients
â”œâ”€ SECONDARY (B) : Actif, sert 50% des clients
â””â”€ Synchronisation continue

T = 0s : Serveur PRIMARY tombe en panne
         â””â”€ ArrÃªt brutal (panne matÃ©rielle)

T = +15s : SECONDARY dÃ©tecte perte de heartbeat
           â”œâ”€ Passage Ã©tat COMMUNICATIONS-INTERRUPTED
           â”œâ”€ Continue de servir ses clients
           â””â”€ Attend 60s (max-response-delay)

T = +60s : SECONDARY dÃ©clare PRIMARY down
           â”œâ”€ Passage Ã©tat PARTNER-DOWN
           â”œâ”€ Prend en charge 100% du pool
           â””â”€ Sert tous les nouveaux clients âœ“

T = +5min : Client qui Ã©tait servi par PRIMARY atteint T1
            â”œâ”€ Tente renouvellement vers PRIMARY (Ã©chec)
            â”œâ”€ Attend T2 (rebinding)
            â””â”€ SECONDARY rÃ©pond au broadcast âœ“

Impact utilisateur :
â”œâ”€ Clients actifs : Aucun (pendant durÃ©e du bail)
â”œâ”€ Nouveaux clients : Aucun (SECONDARY prend le relais)
â”œâ”€ Renouvellements : LÃ©ger dÃ©lai (T1 â†’ T2)
â””â”€ Service continuitÃ© : 100% âœ“

T = +2h : Administrateur rÃ©pare PRIMARY
          â””â”€ RedÃ©marre serveur

T = +2h +30s : SECONDARY dÃ©tecte PRIMARY
               â”œâ”€ Resynchronisation des baux
               â”œâ”€ Retour Ã©tat NORMAL
               â””â”€ RÃ©partition 50/50 restaurÃ©e âœ“

DurÃ©e d'indisponibilitÃ© : 0 seconde
Impact utilisateur : Transparent
```

## Monitoring et mÃ©triques

### MÃ©triques importantes Ã  surveiller

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dashboard de monitoring DHCP                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚
â”‚ 1. Utilisation du pool
â”‚    â”œâ”€ IPs totales : 200
â”‚    â”œâ”€ IPs attribuÃ©es : 142 (71%)
â”‚    â”œâ”€ IPs libres : 58 (29%)
â”‚    â””â”€ Seuil alerte : >85% ğŸŸ¡  >95% ğŸ”´
â”‚
â”‚ 2. Taux de requÃªtes
â”‚    â”œâ”€ DISCOVER : 120/heure
â”‚    â”œâ”€ REQUEST : 480/heure (includes renewals)
â”‚    â”œâ”€ RELEASE : 15/heure
â”‚    â””â”€ Tendance : â†— +5% vs hier
â”‚
â”‚ 3. Taux de succÃ¨s
â”‚    â”œâ”€ DISCOVER â†’ OFFER : 100% âœ“
â”‚    â”œâ”€ REQUEST â†’ ACK : 99.8% âœ“
â”‚    â”œâ”€ REQUEST â†’ NAK : 0.2%
â”‚    â””â”€ Pool exhausted : 0 events âœ“
â”‚
â”‚ 4. DurÃ©e moyenne de bail
â”‚    â”œâ”€ ConfigurÃ©e : 86400s (24h)
â”‚    â”œâ”€ Moyenne rÃ©elle : 18200s (~5h)
â”‚    â””â”€ Raison : Clients mobiles, dÃ©connexions
â”‚
â”‚ 5. Top clients (par renouvellements)
â”‚    â”œâ”€ laptop-bob (50) : Normal âœ“
â”‚    â”œâ”€ phone-alice (45) : Normal âœ“
â”‚    â”œâ”€ IoT-device-123 (450) : Suspect ğŸŸ¡
â”‚    â””â”€ unknown (1200) : DoS attack ? ğŸ”´
â”‚
â”‚ 6. Conflits dÃ©tectÃ©s
â”‚    â”œâ”€ DerniÃ¨re 24h : 2 conflits
â”‚    â”œâ”€ 192.168.1.75 : RÃ©solu (DECLINE envoyÃ©)
â”‚    â””â”€ 192.168.1.82 : Investigation requise ğŸŸ¡
â”‚
â”‚ 7. SantÃ© du serveur
â”‚    â”œâ”€ Uptime : 47 jours âœ“
â”‚    â”œâ”€ CPU : 2% âœ“
â”‚    â”œâ”€ MÃ©moire : 180 MB / 2 GB (9%) âœ“
â”‚    â””â”€ Latence rÃ©ponse : 12ms (avg) âœ“
â”‚
â”‚ 8. Failover status (si applicable)
â”‚    â”œâ”€ Ã‰tat : NORMAL âœ“
â”‚    â”œâ”€ Partner : 192.168.1.11 (SECONDARY) âœ“
â”‚    â”œâ”€ DerniÃ¨re sync : 5 secondes ago âœ“
â”‚    â””â”€ Baux non syncÃ©s : 0 âœ“
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Alertes recommandÃ©es :
â”œâ”€ Pool >85% utilisÃ© : Warning
â”œâ”€ Pool >95% utilisÃ© : Critical
â”œâ”€ Taux NAK >5% : Investigation
â”œâ”€ Serveur failover down : Critical
â”œâ”€ Conflits >10/jour : Warning
â””â”€ Latence >100ms : Warning
```

### Commandes de diagnostic

```bash
# Linux (ISC DHCP)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Voir les baux actifs
dhcp-lease-list

# Statistiques du pool
dhcpd-pools -c /etc/dhcp/dhcpd.conf -l /var/lib/dhcp/dhcpd.leases

# Logs en temps rÃ©el
tail -f /var/log/syslog | grep dhcpd

# Windows Server DHCP
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# Statistiques scope
Get-DhcpServerv4Scope | Get-DhcpServerv4ScopeStatistics

# Baux actifs
Get-DhcpServerv4Lease -ScopeId 192.168.1.0

# RÃ©servations
Get-DhcpServerv4Reservation -ScopeId 192.168.1.0

# Ã‰tat failover
Get-DhcpServerv4Failover

# DÃ©tection conflits
Get-DhcpServerv4Scope | Get-DhcpServerv4OptionValue -OptionId 82
```

## Points clÃ©s Ã  retenir

ğŸ”‘ **Le bail est une attribution temporaire d'IP avec durÃ©e dÃ©finie**

ğŸ”‘ **Cycle de vie : INIT â†’ BOUND â†’ RENEWING (T1, 50%) â†’ REBINDING (T2, 87.5%) â†’ INIT**

ğŸ”‘ **T1 (50%) : Renouvellement unicast vers serveur original**

ğŸ”‘ **T2 (87.5%) : Rebinding broadcast, n'importe quel serveur peut rÃ©pondre**

ğŸ”‘ **Ã€ expiration (100%) : Client DOIT arrÃªter d'utiliser l'IP**

ğŸ”‘ **Serveur maintient base de donnÃ©es de tous les baux (actifs, expirÃ©s, offerts)**

ğŸ”‘ **DurÃ©e de bail selon contexte : 1h (cafÃ©) Ã  7 jours (bureau fixe)**

ğŸ”‘ **Pool sizing : (Peak concurrent users) Ã— 1.2 pour marge sÃ©curitÃ©**

ğŸ”‘ **Haute disponibilitÃ© via Failover (actif/actif ou actif/passif)**

ğŸ”‘ **Monitoring : Surveiller utilisation pool, taux succÃ¨s, conflits, latence**

---

## Ce que nous avons appris

Dans cette section, nous avons explorÃ© en dÃ©tail :

- âœ… Le concept de bail DHCP et son cycle de vie complet
- âœ… Les Ã©tats du client DHCP (INIT, BOUND, RENEWING, REBINDING)
- âœ… Les timers T1 et T2 et leur calcul
- âœ… Le processus de renouvellement et rebinding avec exemples
- âœ… La gestion des baux cÃ´tÃ© serveur (base de donnÃ©es, Ã©tats)
- âœ… Les stratÃ©gies de durÃ©e de bail selon le contexte
- âœ… Le calcul de la taille du pool d'adresses
- âœ… Les problÃ¨mes courants (Ã©puisement, conflits, serveur down)
- âœ… Les solutions de haute disponibilitÃ© (Failover)
- âœ… Le monitoring et les mÃ©triques importantes

## Conclusion

La gestion des baux est au cÅ“ur de DHCP. Comprendre le cycle de vie complet d'un bail, du T1 au T2 jusqu'Ã  l'expiration, permet de :
- Dimensionner correctement les pools d'adresses
- Choisir des durÃ©es de bail adaptÃ©es au contexte
- Diagnostiquer efficacement les problÃ¨mes de connectivitÃ©
- ImplÃ©menter une haute disponibilitÃ© robuste

La beautÃ© de DHCP rÃ©side dans sa simplicitÃ© apparente qui cache une gestion sophistiquÃ©e des ressources IP, permettant Ã  des milliards d'appareils de se connecter automatiquement aux rÃ©seaux chaque jour.

---

**Fin du module DHCP - Prochaine section : HTTP/HTTPS** ğŸ‘‰

â­ï¸ [HTTP/HTTPS](/05-couche-application/04-http-https.md)
