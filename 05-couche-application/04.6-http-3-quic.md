ğŸ” Retour au [Sommaire](/SOMMAIRE.md)

# 5.4.6 HTTP/3 et QUIC : Transport sur UDP

## Introduction

HTTP/3, publiÃ© en **juin 2022** (RFC 9114), reprÃ©sente une **rÃ©volution dans l'histoire du Web** : aprÃ¨s plus de 40 ans d'utilisation de TCP comme protocole de transport, HTTP abandonne TCP au profit de **QUIC** (Quick UDP Internet Connections), un nouveau protocole basÃ© sur **UDP**.

**Ce changement est radical :**
```
HTTP/0.9 Ã  HTTP/2 : Tous utilisent TCP
HTTP/3 : Utilise QUIC/UDP

C'est comme si aprÃ¨s 40 ans de conduite Ã  droite,
on passait Ã  la conduite Ã  gauche !
```

**Pourquoi un tel changement ?**

Parce que TCP, malgrÃ© toutes ses qualitÃ©s, prÃ©sente des **limitations fondamentales** impossibles Ã  rÃ©soudre sans le remplacer complÃ¨tement :
- Head-of-line blocking au niveau transport
- Handshake lent (1-2 RTT)
- Ossification du rÃ©seau (middleboxes figent le protocole)
- Pas de migration de connexion
- TLS en surcouche (overhead)

## Le problÃ¨me fondamental : TCP Head-of-Line Blocking

### Rappel du problÃ¨me

MÃªme avec le multiplexage HTTP/2, **TCP introduit un blocage au niveau transport**.

**ScÃ©nario :**

```
HTTP/2 sur TCP :

Application (HTTP/2) : 3 streams indÃ©pendants
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Stream 1 â”‚ â”‚Stream 3 â”‚ â”‚Stream 5 â”‚
â”‚ (HTML)  â”‚ â”‚ (CSS)   â”‚ â”‚ (Image) â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚           â”‚           â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Multiplexage   â”‚
        â”‚      HTTP/2      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    Connexion     â”‚
        â”‚       TCP        â”‚ â† Un seul tuyau !
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
        Paquets TCP numÃ©rotÃ©s sÃ©quentiellement

Timeline :
Paquet 1 : [S1 data] âœ… reÃ§u
Paquet 2 : [S3 data] âŒ PERDU
Paquet 3 : [S5 data] âœ… reÃ§u
Paquet 4 : [S1 data] âœ… reÃ§u

ProblÃ¨me :
TCP voit : 1, ?, 3, 4
TCP bloque TOUT jusqu'Ã  recevoir le paquet 2
MÃªme si S5 et S1 ont reÃ§u leurs donnÃ©es (paquet 3 et 4)

â†’ Stream 5 et Stream 1 attendent inutilement
   Ã  cause de la perte sur Stream 3
```

### Impact mesurable

**Test rÃ©el avec 1% de perte de paquets :**

```
HTTP/1.1 (6 connexions TCP) :
- Perte affecte 1 connexion sur 6
- Les 5 autres continuent normalement
- Impact : ~17% des ressources
- Temps de chargement : 3.2s

HTTP/2 (1 connexion TCP) :
- Perte affecte LA connexion unique
- Tous les streams bloquÃ©s
- Impact : 100% des ressources
- Temps de chargement : 4.1s

HTTP/3 (QUIC/UDP) :
- Perte affecte seulement le stream concernÃ©
- Les autres streams continuent
- Impact : ~33% (1 stream sur 3 dans cet exemple)
- Temps de chargement : 2.8s

Paradoxe : Sur rÃ©seaux Ã  pertes, HTTP/1.1 peut battre HTTP/2 !
HTTP/3 rÃ©sout ce problÃ¨me
```

### Visualisation du blocage

```
HTTP/2 sur TCP - Perte de paquet :
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Stream 1 : â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Stream 3 : â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆ
Stream 5 : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
           â†‘       â†‘
           OK    BLOCAGE Ã  cause de la perte sur Stream 3
                 Tout attend la retransmission

HTTP/3 sur QUIC - Perte de paquet :
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Stream 1 : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ âœ… Continue
Stream 3 : â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆ       â¸ï¸ Attend seulement
Stream 5 : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ âœ… Continue
           â†‘       â†‘
           OK    Seul Stream 3 bloquÃ©, les autres continuent
```

## QUIC : Quick UDP Internet Connections

### Origines et dÃ©veloppement

**Timeline :**

```
2012 : Google commence le dÃ©veloppement de QUIC
2013 : DÃ©ploiement expÃ©rimental sur les services Google
2015 : ~50% du trafic Google utilise QUIC
2016 : IETF commence la standardisation
2021 : RFC 9000 (QUIC v1) publiÃ©
2022 : RFC 9114 (HTTP/3) publiÃ©
2025 : ~30% du trafic web utilise HTTP/3
```

**Objectifs de QUIC :**
- âœ… Ã‰liminer le head-of-line blocking TCP
- âœ… RÃ©duire la latence de connexion (0-RTT)
- âœ… AmÃ©liorer la sÃ©curitÃ© (TLS 1.3 intÃ©grÃ©)
- âœ… Permettre la migration de connexion
- âœ… Ã‰viter l'ossification du rÃ©seau
- âœ… Faciliter l'Ã©volution du protocole

### Pourquoi UDP ?

**TCP est "ossifiÃ©" :**

```
ProblÃ¨me : TCP existe depuis 1981
- Nombreuses middleboxes (NAT, firewalls, proxies)
- Ces Ã©quipements "comprennent" TCP
- Modifier TCP = risque de casser les middleboxes
- Impossible de dÃ©ployer une nouvelle version de TCP

Exemple d'ossification :
TCP Fast Open (TFO) :
- Excellente idÃ©e (Ã©conomie 1 RTT)
- StandardisÃ© en 2014
- Adoption : <5% en 2025
- Raison : Middleboxes bloquent ou modifient

QUIC choisit UDP :
- UDP est simple et flexible
- Les middleboxes laissent passer UDP
- Tout le "travail" dans l'espace utilisateur (pas le kernel)
- Ã‰volution rapide possible
```

**UDP : Simple et transparent**

```
UDP = "Enveloppe transparente"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  En-tÃªte UDP (8 bytes)      â”‚
â”‚  - Port source              â”‚
â”‚  - Port destination         â”‚
â”‚  - Longueur                 â”‚
â”‚  - Checksum                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  DonnÃ©es QUIC               â”‚ â† Tout est ici
â”‚  (Encryption, flow control, â”‚
â”‚   congestion, multiplexing, â”‚
â”‚   reliability, etc.)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Les middleboxes voient juste "UDP"
et laissent passer
```

### Architecture de QUIC

**QUIC = TCP + TLS + HTTP/2 fusionnÃ©s et amÃ©liorÃ©s**

```
Stack HTTP/2 :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     HTTP/2       â”‚ â† Multiplexage HTTP
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      TLS         â”‚ â† SÃ©curitÃ©
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      TCP         â”‚ â† FiabilitÃ©, ordre, congestion
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       IP         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total : 3 handshakes sÃ©parÃ©s
- TCP : 1 RTT
- TLS : 1-2 RTT
- Total : 2-3 RTT avant HTTP


Stack HTTP/3 :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     HTTP/3       â”‚ â† Mapping HTTP sur QUIC
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                  â”‚
â”‚      QUIC        â”‚ â† Tout intÃ©grÃ© :
â”‚                  â”‚   - Multiplexage
â”‚   (over UDP)     â”‚   - SÃ©curitÃ© (TLS 1.3)
â”‚                  â”‚   - FiabilitÃ©
â”‚                  â”‚   - Congestion
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       IP         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total : 1 handshake combinÃ©
- QUIC : 1 RTT (ou 0-RTT si reconnexion)
```

### CaractÃ©ristiques principales de QUIC

**1. TLS 1.3 intÃ©grÃ© (obligatoire)**

```
QUIC chiffre toujours :
- Pas de QUIC en clair
- TLS 1.3 dans le protocole lui-mÃªme
- Headers de transport chiffrÃ©s
- Seul le header de paquet QUIC est visible

Paquet QUIC :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header QUIC (non chiffrÃ©)    â”‚ â† Routage uniquement
â”‚ - Flags                      â”‚
â”‚ - Connection ID              â”‚
â”‚ - Packet Number              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Payload QUIC (chiffrÃ©)       â”‚ â† Tout le reste
â”‚ - Frames QUIC                â”‚
â”‚ - DonnÃ©es application        â”‚
â”‚ - ACKs, flow control         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**2. Streams indÃ©pendants au niveau transport**

```
QUIC streams :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Connexion QUIC               â”‚
â”‚                                     â”‚
â”‚  Stream 0 : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ        â”‚ â† IndÃ©pendant
â”‚  Stream 4 : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ                  â”‚ â† IndÃ©pendant
â”‚  Stream 8 : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ          â”‚ â† IndÃ©pendant
â”‚  Stream 12: â–ˆâ–ˆâ–ˆâ–ˆ                    â”‚ â† IndÃ©pendant
â”‚                                     â”‚
â”‚  Perte sur Stream 4 :               â”‚
â”‚  â†’ Bloque seulement Stream 4        â”‚
â”‚  â†’ Stream 0, 8, 12 continuent       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Au niveau UDP :
- Tous les streams dans les mÃªmes paquets UDP
- Mais QUIC gÃ¨re l'indÃ©pendance en interne
```

**3. Connection ID (pas IP:Port)**

```
TCP identifie une connexion par :
(IP source, Port source, IP dest, Port dest)

ProblÃ¨me : Changement d'IP = nouvelle connexion
Exemple : WiFi â†’ 4G sur mobile


QUIC identifie par Connection ID :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Connection ID: 0x8f4a9c2b    â”‚ â† Identifiant unique
â”‚ IP source: 192.168.1.100     â”‚ â† Peut changer
â”‚ Port source: 54321           â”‚ â† Peut changer
â”‚ IP dest: 93.184.216.34       â”‚
â”‚ Port dest: 443               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Avantage : Migration de connexion
WiFi (192.168.1.100) â†’ 4G (10.20.30.40)
â†’ MÃªme Connection ID
â†’ Connexion continue sans interruption
```

**4. Packet Number Space**

```
TCP : NumÃ©ros de sÃ©quence par byte
- Complexe
- RÃ©utilisation des numÃ©ros (wraparound)

QUIC : NumÃ©ros de paquets
- Un numÃ©ro par paquet
- Jamais rÃ©utilisÃ©
- Plus simple pour dÃ©tecter les pertes
- Meilleure estimation RTT

Exemple :
Paquet 1 : EnvoyÃ© Ã  T=0, Stream 0 data
Paquet 2 : EnvoyÃ© Ã  T=10ms, Stream 4 data
Paquet 3 : EnvoyÃ© Ã  T=20ms, Stream 8 data

Paquet 2 perdu, retransmis :
Paquet 4 : Retransmission de Paquet 2 data, Ã  T=100ms
          (nouveau numÃ©ro, mÃªme donnÃ©es)

Plus facile de calculer RTT et dÃ©tecter les pertes
```

## Ã‰tablissement de connexion QUIC

### Premier handshake : 1-RTT

**QUIC combine TLS et transport en un seul handshake :**

```
Client                                  Serveur
  â”‚                                       â”‚
  â”‚â”€â”€â”€â”€ Initial (ClientHello) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     - Connection ID                   â”‚
  â”‚     - TLS ClientHello                 â”‚
  â”‚     - ParamÃ¨tres QUIC                 â”‚
  â”‚                                       â”‚
  â”‚<â”€â”€â”€ Initial (ServerHello) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚     Handshake                         â”‚
  â”‚     - TLS ServerHello                 â”‚
  â”‚     - Certificat                      â”‚
  â”‚     - ParamÃ¨tres QUIC                 â”‚
  â”‚                                       â”‚
  â”‚â”€â”€â”€â”€ Handshake (Finished) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                                       â”‚
  â”‚â”€â”€â”€â”€ 1-RTT (Application Data) â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     [RequÃªte HTTP/3]                  â”‚
  â”‚                                       â”‚
  â”‚<â”€â”€â”€ 1-RTT (Application Data) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚     [RÃ©ponse HTTP/3]                  â”‚

Total : 1 RTT pour Ã©tablir la connexion
       + immÃ©diatement donnÃ©es applicatives
```

**Comparaison avec HTTP/2 :**

```
HTTP/2 (TCP + TLS) :

Client â†’ Serveur : TCP SYN
Serveur â†’ Client : TCP SYN-ACK
Client â†’ Serveur : TCP ACK
                   [1 RTT passÃ©]

Client â†’ Serveur : TLS ClientHello
Serveur â†’ Client : TLS ServerHello, Certificate, Done
Client â†’ Serveur : TLS Finished
                   [2 RTT passÃ©s]

Client â†’ Serveur : GET /index.html
                   [PremiÃ¨re requÃªte HTTP possible]

Total : 2 RTT minimum avant la premiÃ¨re requÃªte


HTTP/3 (QUIC) :

Client â†’ Serveur : QUIC Initial (ClientHello)
Serveur â†’ Client : QUIC Initial/Handshake (ServerHello, Cert)
Client â†’ Serveur : QUIC Handshake (Finished)
                   + GET /index.html
                   [1 RTT passÃ©]

Total : 1 RTT avant la premiÃ¨re requÃªte

Ã‰conomie : 1 RTT par connexion
```

### Reconnexion : 0-RTT

**Pour les connexions rÃ©pÃ©tÃ©es, QUIC permet 0-RTT :**

```
PremiÃ¨re connexion :
Client stocke les paramÃ¨tres du serveur

Reconnexion (moins de 7 jours aprÃ¨s) :

Client                                  Serveur
  â”‚                                       â”‚
  â”‚â”€â”€â”€â”€ 0-RTT (Early Data) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     - Session resumption token        â”‚
  â”‚     - Application data                â”‚
  â”‚     - GET /api/data                   â”‚ â† DÃ©jÃ  envoyÃ© !
  â”‚                                       â”‚
  â”‚<â”€â”€â”€ 1-RTT (Response) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚     - 200 OK                          â”‚
  â”‚     - DonnÃ©es                         â”‚

Total : 0 RTT !
La premiÃ¨re requÃªte HTTP est envoyÃ©e immÃ©diatement
```

**Gains de performance :**

```
Latence rÃ©seau : 50ms (RTT)

TCP + TLS 1.3 (avec session resumption) :
- TCP handshake : 50ms
- TLS resumption : 50ms
- PremiÃ¨re requÃªte possible : 100ms

QUIC avec 0-RTT :
- PremiÃ¨re requÃªte envoyÃ©e immÃ©diatement : 0ms
- RÃ©ponse : 50ms (1 RTT)

Gain : 100ms Ã©conomisÃ©s

Sur connexions mobiles (RTT 100-200ms) :
Gain : 200-400ms par reconnexion
```

**Limitations du 0-RTT :**

```
âš ï¸ ProblÃ¨me de sÃ©curitÃ© : Replay attacks

DonnÃ©es 0-RTT peuvent Ãªtre rejouÃ©es :
Attaquant capture le paquet 0-RTT
Attaquant renvoie le mÃªme paquet

Exemple dangereux :
0-RTT : POST /transfer?amount=1000&to=attacker

Solution : Utiliser 0-RTT uniquement pour :
âœ… RequÃªtes GET (idempotentes)
âœ… DonnÃ©es sans effet de bord
âŒ Pas pour POST, PUT, DELETE
âŒ Pas pour actions sensibles
```

## Migration de connexion

### Le problÃ¨me avec TCP

```
Connexion TCP identifiÃ©e par :
(IP_src, Port_src, IP_dst, Port_dst)

ScÃ©nario mobile :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Utilisateur sur WiFi                 â”‚
â”‚    IP: 192.168.1.100                    â”‚
â”‚    Connexion Ã©tablie avec serveur       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. Utilisateur sort, passe en 4G        â”‚
â”‚    IP: 10.20.30.40                      â”‚ â† IP change !
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. TCP voit une nouvelle IP             â”‚
â”‚    â†’ Connexion perdue                   â”‚
â”‚    â†’ Doit refaire handshake             â”‚
â”‚    â†’ Application interrompue            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Impact utilisateur :
- VidÃ©o YouTube s'arrÃªte
- TÃ©lÃ©chargement recommence
- Formulaire perdu
```

### La solution QUIC : Connection ID

```
QUIC identifie par Connection ID :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Connection ID: 0xf4a9c2b8                â”‚ â† Constant
â”‚ IP, Port: Peuvent changer                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ScÃ©nario avec QUIC :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Utilisateur sur WiFi                 â”‚
â”‚    Connection ID: 0xf4a9c2b8            â”‚
â”‚    IP: 192.168.1.100                    â”‚
â”‚    Stream video en cours                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2. Passage en 4G                        â”‚
â”‚    Connection ID: 0xf4a9c2b8            â”‚ â† MÃªme ID
â”‚    IP: 10.20.30.40                      â”‚ â† IP changÃ©
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 3. Envoi de paquet avec nouvelle IP     â”‚
â”‚    Serveur reconnaÃ®t le Connection ID   â”‚
â”‚    â†’ Connexion continue                 â”‚
â”‚    â†’ Aucune interruption                â”‚
â”‚    â†’ Stream vidÃ©o continue              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PATH_CHALLENGE et PATH_RESPONSE

**Validation du nouveau chemin :**

```
Client change d'IP :

Client (nouvelle IP)              Serveur
  â”‚                                  â”‚
  â”‚â”€â”€â”€â”€ PATH_CHALLENGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     (sur nouvelle IP)            â”‚
  â”‚                                  â”‚
  â”‚<â”€â”€â”€ PATH_RESPONSE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚     (valide le nouveau chemin)   â”‚
  â”‚                                  â”‚
  â”‚â”€â”€â”€â”€ DonnÃ©es continues â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     (migration validÃ©e)          â”‚

SÃ©curitÃ© :
- EmpÃªche les attaques de migration malveillantes
- VÃ©rifie que le client contrÃ´le vraiment la nouvelle IP
```

### Use cases de la migration

**1. Mobile WiFi â†” Cellulaire**
```
Transition transparente lors des dÃ©placements
Pas d'interruption d'appel vidÃ©o
TÃ©lÃ©chargements continuent
```

**2. Dual-stack IPv4/IPv6**
```
Commence en IPv6
Bascule en IPv4 si IPv6 Ã©choue
Sans casser la connexion
```

**3. Multi-path QUIC (expÃ©rimental)**
```
Utiliser WiFi ET 4G simultanÃ©ment
AgrÃ©ger la bande passante
Redondance pour fiabilitÃ©
```

## HTTP/3 sur QUIC

### Mapping HTTP sur QUIC

**HTTP/3 utilise les streams QUIC :**

```
HTTP/2 frames â†’ HTTP/3 frames â†’ QUIC streams

RequÃªte HTTP/3 :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUIC Stream 0                        â”‚
â”‚   HTTP/3 HEADERS frame               â”‚
â”‚     :method: GET                     â”‚
â”‚     :path: /index.html               â”‚
â”‚     :scheme: https                   â”‚
â”‚     :authority: example.com          â”‚
â”‚   HTTP/3 DATA frame (si body)        â”‚
â”‚     [donnÃ©es POST]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

RÃ©ponse HTTP/3 :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QUIC Stream 0 (mÃªme stream)          â”‚
â”‚   HTTP/3 HEADERS frame               â”‚
â”‚     :status: 200                     â”‚
â”‚     content-type: text/html          â”‚
â”‚   HTTP/3 DATA frame                  â”‚
â”‚     <!DOCTYPE html>...               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Types de frames HTTP/3

```
DATA          : Contenu de la requÃªte/rÃ©ponse
HEADERS       : Headers HTTP
CANCEL_PUSH   : Annuler un server push
SETTINGS      : ParamÃ¨tres de connexion
PUSH_PROMISE  : Annonce de server push (rarement utilisÃ©)
GOAWAY        : Fermeture de connexion
MAX_PUSH_ID   : Limite de server push
```

### Streams rÃ©servÃ©s

**QUIC streams pour HTTP/3 :**

```
Stream 0 : Control stream (bidirectionnel)
           - SETTINGS
           - GOAWAY
           - ParamÃ¨tres de connexion

Stream 2 : Control stream serveur

Stream 3 : QPACK encoder stream
           - Compression des headers

Stream 7 : QPACK decoder stream

Streams client (ID impairs 1+) : RequÃªtes HTTP
Streams serveur (ID pairs 4+) : Server push (rare)
```

### QPACK : Compression des headers pour HTTP/3

**HPACK (HTTP/2) ne fonctionne pas bien avec QUIC :**

```
ProblÃ¨me HPACK sur QUIC :
- HPACK nÃ©cessite ordre strict
- Stream A met Ã  jour la table dynamique
- Stream B dÃ©pend de cette mise Ã  jour
- Si Stream A est retardÃ© (perte) â†’ Stream B bloquÃ©

â†’ RÃ©introduit du head-of-line blocking !
```

**QPACK : Version adaptÃ©e Ã  QUIC**

```
QPACK = HPACK + rÃ©fÃ©rences dynamiques non bloquantes

Deux modes :
1. Mode non-bloquant (dÃ©faut)
   - N'utilise que la table statique
   - Pas de dÃ©pendance entre streams

2. Mode dynamique (optionnel)
   - Utilise la table dynamique
   - Avec streams dÃ©diÃ©s (encoder/decoder)
   - Permet de bloquer si nÃ©cessaire pour meilleure compression
```

### Exemple de communication HTTP/3

```
Client                                    Serveur
  â”‚                                         â”‚
  â”‚â”€â”€â”€â”€ QUIC Connection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     (1-RTT handshake)                   â”‚
  â”‚                                         â”‚
  â”‚â”€â”€â”€â”€ SETTINGS (Stream 0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚<â”€â”€â”€ SETTINGS (Stream 0) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚                                         â”‚
  â”‚â”€â”€â”€â”€ HEADERS (Stream 4) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     GET /index.html                     â”‚
  â”‚                                         â”‚
  â”‚â”€â”€â”€â”€ HEADERS (Stream 8) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     GET /style.css                      â”‚
  â”‚                                         â”‚
  â”‚<â”€â”€â”€ HEADERS + DATA (Stream 4) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚     200 OK [HTML]                       â”‚
  â”‚                                         â”‚
  â”‚<â”€â”€â”€ HEADERS + DATA (Stream 8) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚     200 OK [CSS]                        â”‚
  â”‚                                         â”‚
  â”‚â”€â”€â”€â”€ HEADERS (Stream 12) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚     GET /app.js                         â”‚
  â”‚                                         â”‚
  â”‚<â”€â”€â”€ HEADERS + DATA (Stream 12) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”‚     200 OK [JavaScript]                 â”‚

Tous les streams indÃ©pendants
Perte sur un stream = pas d'impact sur les autres
```

## Alt-Svc : DÃ©couverte d'HTTP/3

### Le problÃ¨me de dÃ©ploiement

```
ProblÃ¨me : Comment le client sait qu'HTTP/3 est disponible ?

HTTP/3 utilise UDP port 443
HTTP/1.1 et HTTP/2 utilisent TCP port 443

Le client ne peut pas deviner
```

### Solution : Alt-Svc header

**Le serveur annonce HTTP/3 via HTTP/2 ou HTTP/1.1 :**

```
PremiÃ¨re connexion (HTTP/2) :

Client â†’ Serveur : GET / (HTTP/2 sur TCP)

Serveur â†’ Client :
HTTP/2 200 OK
Alt-Svc: h3=":443"; ma=86400
Content-Type: text/html

[HTML content]

Signification :
- h3=":443" : HTTP/3 disponible sur le mÃªme host, port 443
- ma=86400 : Valide pendant 86400 secondes (24h)
```

**Connexions suivantes :**

```
Client stocke l'info "HTTP/3 disponible"

Prochaine requÃªte :
Client â†’ Serveur : Essaie HTTP/3 (QUIC/UDP) sur port 443

Si succÃ¨s :
  â†’ Utilise HTTP/3

Si Ã©chec (firewall bloque UDP) :
  â†’ Fallback sur HTTP/2 ou HTTP/1.1
```

### Alt-Svc via DNS

**HTTPS DNS record (type 65) :**

```
DNS query : example.com HTTPS?

DNS response :
example.com. 3600 IN HTTPS 1 . alpn="h3,h2" port="443"

Signification :
- alpn="h3,h2" : Supporte HTTP/3 et HTTP/2
- port="443"
- Le client peut tenter HTTP/3 directement
```

## Comparaison HTTP/1.1 vs HTTP/2 vs HTTP/3

### Stack protocolaire

```
HTTP/1.1 :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    HTTP/1.1      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      TLS         â”‚ (optionnel)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      TCP         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       IP         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HTTP/2 :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     HTTP/2       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      TLS         â”‚ (obligatoire navigateurs)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      TCP         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       IP         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HTTP/3 :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     HTTP/3       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      QUIC        â”‚ (TLS 1.3 intÃ©grÃ©)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      UDP         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚       IP         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Tableau comparatif complet

| CaractÃ©ristique | HTTP/1.1 | HTTP/2 | HTTP/3 |
|----------------|----------|---------|---------|
| **Transport** | TCP | TCP | QUIC/UDP |
| **Format** | Texte | Binaire | Binaire |
| **Connexions** | 6+ | 1 | 1 |
| **Multiplexage** | âŒ | âœ… | âœ… |
| **HOL Blocking HTTP** | âœ… | âŒ | âŒ |
| **HOL Blocking Transport** | N/A | âœ… TCP | âŒ |
| **Handshake** | 1 RTT TCP + 1-2 RTT TLS | 1 RTT TCP + 1-2 RTT TLS | 1 RTT (ou 0-RTT) |
| **Compression headers** | âŒ | âœ… HPACK | âœ… QPACK |
| **Server Push** | âŒ | âœ… (dÃ©prÃ©ciÃ©) | âš ï¸ (rarement) |
| **Migration connexion** | âŒ | âŒ | âœ… |
| **Encryption** | Optionnel | Obligatoire (browsers) | Obligatoire |
| **Support middleboxes** | âœ…âœ…âœ… | âœ…âœ… | âš ï¸ (UDP bloquÃ© ~5%) |
| **RÃ©sistance perte paquets** | âš ï¸ | âŒ | âœ… |

### Performances comparÃ©es

**ScÃ©nario : Page web avec 100 ressources**

```
RÃ©seau : 100 Mbps, RTT 50ms, 0% perte

HTTP/1.1 :
- 6 connexions parallÃ¨les
- Handshakes : 6 Ã— 100ms = 600ms
- Headers non compressÃ©s : 50 KB
- Temps total : 4.2s

HTTP/2 :
- 1 connexion
- Handshake : 100ms
- Headers compressÃ©s : 5 KB
- Multiplexage
- Temps total : 2.1s

HTTP/3 :
- 1 connexion
- Handshake : 50ms (ou 0ms si 0-RTT)
- Headers compressÃ©s : 5 KB
- Multiplexage sans HOL
- Temps total : 1.8s

AmÃ©lioration HTTP/3 vs HTTP/2 : 14%
```

**Avec 2% de perte de paquets :**

```
HTTP/1.1 : 5.1s (6 connexions, perte sur 1-2)
HTTP/2 : 6.8s (1 connexion, tout bloquÃ©)
HTTP/3 : 2.3s (streams indÃ©pendants)

HTTP/3 gagne largement sur rÃ©seaux Ã  pertes !
```

### Gains selon le type de rÃ©seau

```
Fibre optique (faible latence, faible perte) :
HTTP/1.1 : 100%
HTTP/2   : 150% (50% plus rapide)
HTTP/3   : 160% (10% plus rapide que HTTP/2)
â†’ Gain modÃ©rÃ©

4G/5G (latence moyenne, pertes occasionnelles) :
HTTP/1.1 : 100%
HTTP/2   : 140%
HTTP/3   : 200% (2Ã— plus rapide que HTTP/1.1)
â†’ Gain significatif grÃ¢ce Ã  0-RTT et rÃ©sistance aux pertes

Satellite/distant (haute latence) :
HTTP/1.1 : 100%
HTTP/2   : 180%
HTTP/3   : 280% (2.8Ã— plus rapide)
â†’ Gain majeur grÃ¢ce Ã  0-RTT
```

## DÃ©fis et limitations d'HTTP/3

### 1. Blocage UDP par les middleboxes

**ProblÃ¨me :**

```
Estimation : 5-10% du trafic Internet bloque UDP

Raisons :
- Politiques de sÃ©curitÃ© d'entreprise
- Firewalls anciens
- NAT ne comprenant pas QUIC
- Filtrage agressif

Impact :
Client essaie HTTP/3 â†’ Timeout
â†’ Fallback sur HTTP/2
â†’ Perte de temps (1-3 secondes)
```

**Solution : Happy Eyeballs v2**

```
Algorithme de connexion intelligent :

T=0ms   : Essayer HTTP/3 (QUIC/UDP)
T=100ms : Si pas de rÃ©ponse, essayer HTTP/2 (TCP) en parallÃ¨le
T=200ms : Utiliser la premiÃ¨re connexion qui rÃ©pond

Avantage : Fallback rapide si UDP bloquÃ©
```

### 2. Performance CPU

**QUIC dans l'espace utilisateur :**

```
TCP :
- ImplÃ©mentÃ© dans le kernel
- OptimisÃ© depuis 40 ans
- Hardware offload (NIC)

QUIC :
- ImplÃ©mentÃ© en userspace
- Code plus rÃ©cent
- Pas d'offload matÃ©riel (pour l'instant)
- Encryption pour tout

Impact CPU :
QUIC utilise 1.5-2Ã— plus de CPU que TCP

Mais : AmÃ©lioration continue
Les implÃ©mentations s'optimisent
```

### 3. ComplexitÃ©

```
QUIC est complexe :
- Transport + TLS + congestion control + flow control
- Debugging difficile (tout chiffrÃ©)
- Nombreuses implÃ©mentations (compatibilitÃ©)
- Ã‰volution rapide du standard
```

### 4. Congestion control

**UDP n'a pas de congestion control natif :**

```
TCP : Congestion control dans le kernel
â†’ Ã‰quitable entre connexions

QUIC : ImplÃ©mente sa propre congestion control
â†’ Risque de fairness issues avec TCP

Solution :
QUIC implÃ©mente des algos similaires Ã  TCP :
- CUBIC
- BBR
- New Reno
```

### 5. DÃ©ploiement progressif

**Ã‰tat actuel (2025) :**

```
Support navigateurs : 100%
- Chrome : Depuis 2020
- Firefox : Depuis 2021
- Safari : Depuis 2022
- Edge : Depuis 2020

Support serveurs :
- Nginx : 1.25.0+ (2023)
- Caddy : Natif
- LiteSpeed : Natif
- Apache : Module experimental
- Node.js : BibliothÃ¨ques tierces

Sites web :
- Google : âœ…
- Facebook/Meta : âœ…
- Cloudflare : âœ…
- YouTube : âœ…
- Top 1000 : ~50%
- Tous sites : ~25-30%
```

## ImplÃ©mentations QUIC

### BibliothÃ¨ques principales

**Google's quiche :**
```
Langage : C
UtilisÃ© par : Chrome, Cloudflare
https://github.com/cloudflare/quiche
```

**LSQUIC (LiteSpeed) :**
```
Langage : C
UtilisÃ© par : LiteSpeed Web Server
Performance : Excellente
```

**Quinn (Rust) :**
```rust
// Exemple Quinn
use quinn::{Endpoint, ServerConfig};

let mut server = Endpoint::server(server_config, addr)?;

while let Some(conn) = server.accept().await {
    tokio::spawn(async move {
        let connection = conn.await?;
        // Handle HTTP/3
    });
}
```

**aioquic (Python) :**
```python
from aioquic.asyncio import serve
from aioquic.h3.connection import H3Connection

async def handle(
    scope,
    receive,
    send,
):
    if scope["type"] == "http":
        await send({
            "type": "http.response.start",
            "status": 200,
            "headers": [(b"content-type", b"text/html")],
        })
        await send({
            "type": "http.response.body",
            "body": b"Hello from HTTP/3!",
        })

await serve(
    "0.0.0.0",
    443,
    configuration=configuration,
    create_protocol=H3Connection,
    handler=handle,
)
```

### Configuration serveur

**Nginx (1.25+) :**

```nginx
server {
    listen 443 quic reuseport;          # HTTP/3
    listen 443 ssl http2;                # HTTP/2 fallback

    server_name example.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    # Annoncer HTTP/3
    add_header Alt-Svc 'h3=":443"; ma=86400';

    # ParamÃ¨tres QUIC
    quic_retry on;
    ssl_early_data on;  # 0-RTT
}
```

**Caddy (natif) :**

```caddyfile
example.com {
    # HTTP/3 activÃ© par dÃ©faut
    encode gzip
    file_server

    # ParamÃ¨tres optionnels
    protocols h1 h2 h3
}
```

**Node.js (avec bibliothÃ¨que) :**

```javascript
const { createQuicSocket } = require('net');
const { createSecureContext } = require('tls');

const socket = createQuicSocket({ endpoint: { port: 443 } });

socket.listen({
  key: fs.readFileSync('server-key.pem'),
  cert: fs.readFileSync('server-cert.pem'),
  alpn: 'h3'
});

socket.on('session', (session) => {
  session.on('stream', (stream) => {
    // Handle HTTP/3 stream
    stream.end('Hello from HTTP/3!');
  });
});
```

## VÃ©rifier HTTP/3

### Chrome DevTools

```
1. F12 â†’ Network
2. Activer la colonne "Protocol"
3. Actualiser la page
4. Chercher "h3" ou "http/3"

Ou :

chrome://net-internals/#http3
â†’ Voir les connexions HTTP/3 actives
```

### curl avec HTTP/3

```bash
# Compiler curl avec support HTTP/3
# (ou utiliser une version prÃ©-compilÃ©e)

curl --http3 -I https://www.cloudflare.com

# RÃ©sultat :
HTTP/3 200
alt-svc: h3=":443"; ma=86400
content-type: text/html
...
```

### Sites de test

```
https://www.http3check.net/
â†’ VÃ©rifie si votre site supporte HTTP/3

https://cloudflare-quic.com/
â†’ Page de test Cloudflare HTTP/3
```

### Code JavaScript (browser)

```javascript
// VÃ©rifier le protocole utilisÃ©
fetch('https://www.example.com')
  .then(response => {
    // PerformanceResourceTiming
    const perfEntries = performance.getEntriesByType('resource');
    const entry = perfEntries.find(e => e.name.includes('example.com'));

    console.log('Protocol:', entry.nextHopProtocol);
    // "h3" pour HTTP/3
    // "h2" pour HTTP/2
    // "http/1.1" pour HTTP/1.1
  });

// Ou via PerformanceObserver
const observer = new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    console.log(entry.name, entry.nextHopProtocol);
  }
});
observer.observe({ entryTypes: ['resource'] });
```

## L'avenir d'HTTP/3 et QUIC

### Adoption croissante

```
PrÃ©visions :
2025 : 30% du trafic web
2026 : 50%
2027 : 70%
2030 : >90%

Facteurs :
âœ… Support navigateur universel
âœ… Performance prouvÃ©e sur mobile
âœ… CDN (Cloudflare, Fastly, Akamai) migrent
âœ… Google, Meta, Amazon utilisent
âš ï¸ Adoption plus lente cÃ´tÃ© serveur origin
```

### QUIC au-delÃ  de HTTP

**QUIC n'est pas limitÃ© Ã  HTTP :**

```
Applications actuelles :
- HTTP/3 (le plus connu)
- DNS over QUIC (DoQ)
- VPN over QUIC
- Streaming media
- Gaming (faible latence)
- IoT

QUIC peut transporter n'importe quel protocole
C'est un transport gÃ©nÃ©rique
```

### Ã‰volutions futures

**Extensions QUIC :**

```
- Multipath QUIC
  â†’ Utiliser plusieurs chemins rÃ©seau simultanÃ©ment
  â†’ WiFi + 4G en parallÃ¨le

- QUIC v2
  â†’ Optimisations
  â†’ Nouveaux usages

- Datagram extension
  â†’ Support UDP pur (gaming, VoIP)
  â†’ Sans garantie d'ordre/fiabilitÃ©

- Unreliable streams
  â†’ Streams sans retransmission
  â†’ Pour temps rÃ©el strict
```

### Impact sur l'Ã©cosystÃ¨me

**Changements induits par QUIC :**

```
1. Middleboxes
   - Doivent laisser passer UDP
   - Ã‰volution vers transparence

2. Load balancers
   - Support QUIC natif nÃ©cessaire
   - Connection ID routing

3. Monitoring
   - Nouveaux outils de debugging
   - Analyse de trafic QUIC

4. Optimisations rÃ©seau
   - Focus sur latence, pas juste dÃ©bit
   - 0-RTT devient critique

5. SÃ©curitÃ©
   - TLS 1.3 obligatoire partout
   - Encryption by default
```

## Migration vers HTTP/3

### Checklist de dÃ©ploiement

**PrÃ©requis :**
```
âœ… Certificat TLS valide (obligatoire)
âœ… Serveur supportant HTTP/3 (Nginx 1.25+, Caddy, etc.)
âœ… Port UDP 443 ouvert sur firewall
âœ… Load balancer supportant QUIC (si applicable)
```

**Ã‰tapes :**

```
1. Installer/mettre Ã  jour le serveur web
   nginx â‰¥ 1.25 ou caddy â‰¥ 2.0

2. Activer HTTP/3 dans la configuration
   listen 443 quic;

3. Ajouter Alt-Svc header
   add_header Alt-Svc 'h3=":443"; ma=86400';

4. Configurer le firewall
   iptables -A INPUT -p udp --dport 443 -j ACCEPT

5. Tester
   curl --http3 -I https://votre-site.com

6. Monitorer
   Logs, mÃ©triques, erreurs

7. Rollback plan
   Garder HTTP/2 actif en parallÃ¨le
```

### StratÃ©gie de dÃ©ploiement progressive

```
Phase 1 : Test (1-2 semaines)
- Activer HTTP/3 sur serveur de staging
- Tests internes
- VÃ©rifier compatibilitÃ©

Phase 2 : Canary (2-4 semaines)
- Activer sur 5% du trafic
- Monitorer performances
- Analyser erreurs

Phase 3 : Rollout graduel (1-2 mois)
- 10% â†’ 25% â†’ 50% â†’ 100%
- Surveillance continue
- Ajustements si nÃ©cessaire

Phase 4 : Optimisation
- Tuning paramÃ¨tres QUIC
- Analyse des gains
- Documentation
```

### Bonnes pratiques

```
âœ… Garder HTTP/2 actif (fallback)
âœ… Utiliser Alt-Svc pour dÃ©couverte
âœ… Activer 0-RTT prudemment (seulement GET)
âœ… Monitorer le taux de fallback TCP
âœ… Logs sÃ©parÃ©s HTTP/3 vs HTTP/2
âœ… Tester depuis diffÃ©rents rÃ©seaux
âœ… VÃ©rifier avec divers clients
```

---

## Points clÃ©s Ã  retenir

ğŸ”‘ **QUIC sur UDP** : Abandon de TCP aprÃ¨s 40 ans pour plus de flexibilitÃ©

ğŸ”‘ **RÃ©sout HOL blocking** : Streams indÃ©pendants au niveau transport

ğŸ”‘ **0-RTT** : Reconnexion instantanÃ©e, gain majeur de latence

ğŸ”‘ **Migration de connexion** : Connection ID permet changement d'IP sans interruption

ğŸ”‘ **TLS 1.3 intÃ©grÃ©** : SÃ©curitÃ© obligatoire et native

ğŸ”‘ **1-RTT handshake** : Connection + TLS en un seul Ã©change

ğŸ”‘ **QPACK** : Compression headers adaptÃ©e au multiplexage

ğŸ”‘ **Performance mobile** : Excellente sur rÃ©seaux Ã  haute latence/pertes

ğŸ”‘ **Adoption progressive** : 30% du web en 2025, croissance continue

ğŸ”‘ **DÃ©fis** : 5-10% UDP bloquÃ©, complexitÃ©, CPU overhead

---

## Ce que nous allons voir ensuite

Dans la prochaine section **5.4.7 Ã‰volution des performances web**, nous explorerons :
- Comparaison approfondie HTTP/1.1 â†’ HTTP/2 â†’ HTTP/3
- MÃ©triques de performance (TTFB, FCP, LCP)
- Optimisations modernes
- Cas d'usage et recommandations
- Futur du web

**SynthÃ¨se de l'Ã©volution complÃ¨te d'HTTP !** ğŸ‘‰

---

*HTTP/3 et QUIC reprÃ©sentent une rÃ©volution dans les protocoles rÃ©seau. En abandonnant TCP pour UDP et en rÃ©inventant le transport de bout en bout, ils rÃ©solvent des problÃ¨mes vieux de dÃ©cennies tout en introduisant de nouvelles possibilitÃ©s. La migration vers HTTP/3 est en cours et transformera fondamentalement la faÃ§on dont les donnÃ©es circulent sur Internet dans les annÃ©es Ã  venir.*

â­ï¸ [Ã‰volution des performances web](/05-couche-application/04.7-evolution-performances-web.md)
