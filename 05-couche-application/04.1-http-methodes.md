üîù Retour au [Sommaire](/SOMMAIRE.md)

# 5.4.1 M√©thodes HTTP

## Introduction

Les **m√©thodes HTTP** (aussi appel√©es "verbes HTTP") d√©finissent l'**action** que le client souhaite effectuer sur une ressource identifi√©e par une URL. Chaque requ√™te HTTP doit sp√©cifier une m√©thode, qui indique au serveur ce que le client attend comme op√©ration.

Bien que HTTP d√©finisse plusieurs m√©thodes, vous utiliserez principalement **GET** et **POST** dans la navigation web classique, mais dans le contexte des APIs REST modernes, comprendre toutes les m√©thodes est essentiel pour concevoir des interfaces propres et conformes aux standards.

## Vue d'ensemble des m√©thodes HTTP

HTTP/1.1 d√©finit **9 m√©thodes principales** :

| M√©thode | Usage principal | Safe | Idempotent | Cacheable |
|---------|----------------|------|------------|-----------|
| **GET** | R√©cup√©rer une ressource | ‚úÖ | ‚úÖ | ‚úÖ |
| **POST** | Cr√©er une ressource, soumettre des donn√©es | ‚ùå | ‚ùå | ‚ö†Ô∏è |
| **PUT** | Remplacer une ressource compl√®te | ‚ùå | ‚úÖ | ‚ùå |
| **PATCH** | Modifier partiellement une ressource | ‚ùå | ‚ùå | ‚ùå |
| **DELETE** | Supprimer une ressource | ‚ùå | ‚úÖ | ‚ùå |
| **HEAD** | R√©cup√©rer uniquement les headers | ‚úÖ | ‚úÖ | ‚úÖ |
| **OPTIONS** | Obtenir les options de communication | ‚úÖ | ‚úÖ | ‚ùå |
| **CONNECT** | √âtablir un tunnel (proxy) | ‚ùå | ‚ùå | ‚ùå |
| **TRACE** | Effectuer un test de boucle | ‚úÖ | ‚úÖ | ‚ùå |

**Terminologie importante :**

- **Safe (S√ªre)** : La m√©thode ne modifie pas l'√©tat du serveur (lecture seule)
- **Idempotent (Idempotente)** : Effectuer la m√™me requ√™te plusieurs fois a le m√™me effet qu'une seule fois
- **Cacheable (Cachable)** : La r√©ponse peut √™tre mise en cache

## GET - R√©cup√©rer une ressource

### Description

`GET` est la m√©thode la plus utilis√©e. Elle permet de **r√©cup√©rer** une ressource sans la modifier. Chaque fois que vous tapez une URL dans votre navigateur ou cliquez sur un lien, vous effectuez une requ√™te GET.

### Caract√©ristiques

- ‚úÖ **Safe** : Ne modifie pas l'√©tat du serveur
- ‚úÖ **Idempotent** : Faire 10 fois GET sur `/users/123` retourne toujours la m√™me chose
- ‚úÖ **Cacheable** : Les r√©ponses GET peuvent √™tre mises en cache

### Format de la requ√™te

```http
GET /api/users/123 HTTP/1.1
Host: api.example.com
Accept: application/json
User-Agent: Mozilla/5.0
```

**Points importants :**
- GET **ne doit pas avoir de body** (corps de requ√™te)
- Les param√®tres sont pass√©s dans l'URL (query string)
- Le serveur retourne la ressource dans le body de la r√©ponse

### Exemples concrets

**1. Navigation web classique**
```http
GET /products/laptop-dell-xps HTTP/1.1
Host: www.shop.com

‚Üí Retourne la page HTML du produit
```

**2. API REST - R√©cup√©rer un utilisateur**
```http
GET /api/v1/users/42 HTTP/1.1
Host: api.example.com
Accept: application/json

R√©ponse :
HTTP/1.1 200 OK
Content-Type: application/json

{
  "id": 42,
  "name": "Alice Dupont",
  "email": "alice@example.com"
}
```

**3. R√©cup√©rer une liste avec filtres**
```http
GET /api/products?category=electronics&price_max=1000&sort=price_asc HTTP/1.1
Host: api.example.com

Param√®tres dans l'URL :
- category=electronics
- price_max=1000
- sort=price_asc
```

**4. Pagination**
```http
GET /api/users?page=2&limit=50 HTTP/1.1
Host: api.example.com

‚Üí Retourne les utilisateurs 51 √† 100
```

### Utilisation en code

**JavaScript (fetch)**
```javascript
// Simple GET
fetch('https://api.example.com/users/123')
  .then(response => response.json())
  .then(data => console.log(data));

// GET avec param√®tres
const params = new URLSearchParams({
  category: 'electronics',
  price_max: 1000
});
fetch(`https://api.example.com/products?${params}`)
  .then(response => response.json())
  .then(data => console.log(data));
```

**Python (requests)**
```python
import requests

# Simple GET
response = requests.get('https://api.example.com/users/123')
user = response.json()

# GET avec param√®tres
params = {'category': 'electronics', 'price_max': 1000}
response = requests.get('https://api.example.com/products', params=params)
products = response.json()
```

**curl**
```bash
# Simple GET
curl https://api.example.com/users/123

# GET avec param√®tres
curl "https://api.example.com/products?category=electronics&price_max=1000"

# GET avec headers personnalis√©s
curl -H "Authorization: Bearer token123" \
     https://api.example.com/private/data
```

### Bonnes pratiques

‚úÖ **Utilisez GET uniquement pour la lecture**
```
‚ùå Mauvais : GET /deleteUser?id=123
‚úÖ Bon     : DELETE /users/123
```

‚úÖ **Soyez conscient de la longueur des URLs**
```
Limite typique : 2000-8000 caract√®res selon les navigateurs/serveurs
Pour de gros param√®tres ‚Üí Utilisez POST
```

‚úÖ **GET doit √™tre sans effet de bord**
```
‚ùå Mauvais : GET /api/incrementCounter
‚úÖ Bon     : POST /api/counter/increment
```

### Limitations

‚ùå **Pas de donn√©es sensibles dans l'URL**
```http
‚ùå √âvitez : GET /login?username=alice&password=secret123
‚úÖ Pr√©f√©rez : POST /login (avec body chiffr√©)

Raisons :
- Les URLs apparaissent dans les logs serveur
- Les URLs sont stock√©es dans l'historique du navigateur
- Les URLs peuvent √™tre partag√©es accidentellement
```

‚ùå **Taille limit√©e de l'URL**
```
Si vous devez envoyer beaucoup de donn√©es ‚Üí POST
```

## POST - Cr√©er ou soumettre des donn√©es

### Description

`POST` est utilis√©e pour **soumettre des donn√©es** au serveur, g√©n√©ralement pour cr√©er une nouvelle ressource ou d√©clencher un traitement. C'est la m√©thode utilis√©e par les formulaires HTML.

### Caract√©ristiques

- ‚ùå **Not Safe** : Modifie l'√©tat du serveur
- ‚ùå **Not Idempotent** : Faire POST 2 fois peut cr√©er 2 ressources
- ‚ö†Ô∏è **Partiellement Cacheable** : Rarement mis en cache dans la pratique

### Format de la requ√™te

```http
POST /api/users HTTP/1.1
Host: api.example.com
Content-Type: application/json
Content-Length: 78

{
  "name": "Bob Martin",
  "email": "bob@example.com",
  "age": 30
}
```

**Points importants :**
- POST **a g√©n√©ralement un body** contenant les donn√©es
- Le `Content-Type` indique le format des donn√©es
- Le serveur traite les donn√©es et retourne souvent la ressource cr√©√©e

### Exemples concrets

**1. Cr√©er un utilisateur**
```http
POST /api/users HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "name": "Alice Dupont",
  "email": "alice@example.com"
}

R√©ponse :
HTTP/1.1 201 Created
Location: /api/users/123
Content-Type: application/json

{
  "id": 123,
  "name": "Alice Dupont",
  "email": "alice@example.com",
  "created_at": "2025-12-06T14:30:00Z"
}
```

**2. Soumettre un formulaire**
```http
POST /contact HTTP/1.1
Host: www.example.com
Content-Type: application/x-www-form-urlencoded

name=Jean+Dupont&email=jean%40example.com&message=Bonjour
```

**3. Upload de fichier**
```http
POST /api/upload HTTP/1.1
Host: api.example.com
Content-Type: multipart/form-data; boundary=----WebKitFormBoundary

------WebKitFormBoundary
Content-Disposition: form-data; name="file"; filename="photo.jpg"
Content-Type: image/jpeg

[binary data of the image]
------WebKitFormBoundary--
```

**4. Authentification**
```http
POST /api/login HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "username": "alice",
  "password": "SecureP@ssw0rd"
}

R√©ponse :
HTTP/1.1 200 OK
Content-Type: application/json

{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "expires_in": 3600
}
```

**5. Traitement complexe**
```http
POST /api/search HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "query": "machine learning",
  "filters": {
    "date_from": "2024-01-01",
    "categories": ["AI", "data-science"]
  },
  "limit": 10
}
```

### Utilisation en code

**JavaScript (fetch)**
```javascript
// Cr√©er un utilisateur
fetch('https://api.example.com/users', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    name: 'Alice',
    email: 'alice@example.com'
  })
})
.then(response => response.json())
.then(data => console.log('Utilisateur cr√©√©:', data));

// Soumettre un formulaire
const formData = new FormData();
formData.append('name', 'Jean');
formData.append('email', 'jean@example.com');

fetch('https://example.com/contact', {
  method: 'POST',
  body: formData
});
```

**Python (requests)**
```python
import requests

# JSON
data = {
    'name': 'Alice',
    'email': 'alice@example.com'
}
response = requests.post('https://api.example.com/users', json=data)

# Form data
data = {
    'name': 'Jean',
    'email': 'jean@example.com'
}
response = requests.post('https://example.com/contact', data=data)

# Upload de fichier
files = {'file': open('photo.jpg', 'rb')}
response = requests.post('https://api.example.com/upload', files=files)
```

**curl**
```bash
# JSON
curl -X POST https://api.example.com/users \
  -H "Content-Type: application/json" \
  -d '{"name":"Alice","email":"alice@example.com"}'

# Form data
curl -X POST https://example.com/contact \
  -d "name=Jean&email=jean@example.com"

# Upload de fichier
curl -X POST https://api.example.com/upload \
  -F "file=@photo.jpg"
```

### POST vs GET pour les formulaires

**Formulaire avec GET :**
```html
<form action="/search" method="GET">
  <input name="q" value="laptop">
  <button type="submit">Rechercher</button>
</form>

‚Üí URL g√©n√©r√©e : /search?q=laptop
‚Üí Appropri√© pour les recherches (bookmarkable, partageable)
```

**Formulaire avec POST :**
```html
<form action="/login" method="POST">
  <input name="username" value="alice">
  <input name="password" type="password" value="secret">
  <button type="submit">Se connecter</button>
</form>

‚Üí Donn√©es envoy√©es dans le body (pas visible dans l'URL)
‚Üí Appropri√© pour les donn√©es sensibles ou les modifications
```

### Bonnes pratiques

‚úÖ **Retournez le code 201 Created pour les cr√©ations**
```http
HTTP/1.1 201 Created
Location: /api/users/123
```

‚úÖ **Incluez l'en-t√™te Location pour indiquer o√π trouver la ressource cr√©√©e**

‚úÖ **Utilisez POST quand l'op√©ration n'est pas idempotente**
```
POST /orders ‚Üí Cr√©e une nouvelle commande √† chaque appel
```

‚úÖ **Validez les donn√©es c√¥t√© serveur**
```http
R√©ponse en cas d'erreur :
HTTP/1.1 400 Bad Request
Content-Type: application/json

{
  "error": "Validation failed",
  "details": {
    "email": "Invalid email format"
  }
}
```

## PUT - Remplacer une ressource

### Description

`PUT` est utilis√©e pour **remplacer compl√®tement** une ressource existante. Si la ressource n'existe pas, PUT peut la cr√©er (selon l'impl√©mentation).

### Caract√©ristiques

- ‚ùå **Not Safe** : Modifie l'√©tat du serveur
- ‚úÖ **Idempotent** : PUT la m√™me ressource 10 fois a le m√™me effet qu'une seule fois
- ‚ùå **Not Cacheable**

### Idempotence de PUT

```
√âtat initial :
{ "id": 123, "name": "Alice", "email": "alice@example.com" }

PUT /users/123 (1√®re fois)
{ "name": "Alice Updated", "email": "newemail@example.com" }
‚Üí Ressource modifi√©e

PUT /users/123 (2√®me fois, m√™mes donn√©es)
{ "name": "Alice Updated", "email": "newemail@example.com" }
‚Üí Ressource identique, aucun changement

PUT /users/123 (10√®me fois, m√™mes donn√©es)
‚Üí Toujours le m√™me r√©sultat : idempotent !
```

### Format de la requ√™te

```http
PUT /api/users/123 HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "name": "Alice Dupont",
  "email": "alice.dupont@example.com",
  "age": 31,
  "address": "123 Rue Example"
}
```

**Important :** PUT remplace **toute** la ressource. Vous devez envoyer tous les champs, m√™me ceux qui ne changent pas.

### Exemples concrets

**1. Mettre √† jour un utilisateur**
```http
PUT /api/users/123 HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "name": "Alice Martin",
  "email": "alice.martin@example.com",
  "age": 31
}

R√©ponse :
HTTP/1.1 200 OK
Content-Type: application/json

{
  "id": 123,
  "name": "Alice Martin",
  "email": "alice.martin@example.com",
  "age": 31,
  "updated_at": "2025-12-06T15:45:00Z"
}
```

**2. Remplacer une configuration**
```http
PUT /api/settings/theme HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "mode": "dark",
  "primary_color": "#1a1a1a",
  "font_size": "medium"
}
```

**3. PUT peut cr√©er (upsert)**
```http
PUT /api/users/999 HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "name": "Nouvel Utilisateur",
  "email": "new@example.com"
}

Si l'utilisateur 999 n'existe pas :
HTTP/1.1 201 Created
Location: /api/users/999

Si l'utilisateur 999 existe :
HTTP/1.1 200 OK
```

### Utilisation en code

**JavaScript**
```javascript
fetch('https://api.example.com/users/123', {
  method: 'PUT',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    name: 'Alice Martin',
    email: 'alice.martin@example.com',
    age: 31
  })
})
.then(response => response.json())
.then(data => console.log('Utilisateur mis √† jour:', data));
```

**Python**
```python
data = {
    'name': 'Alice Martin',
    'email': 'alice.martin@example.com',
    'age': 31
}
response = requests.put('https://api.example.com/users/123', json=data)
```

**curl**
```bash
curl -X PUT https://api.example.com/users/123 \
  -H "Content-Type: application/json" \
  -d '{"name":"Alice Martin","email":"alice.martin@example.com","age":31}'
```

### PUT vs POST

| Crit√®re | POST | PUT |
|---------|------|-----|
| **Idempotence** | Non | Oui |
| **Usage principal** | Cr√©er (URI non d√©termin√©e) | Remplacer (URI connue) |
| **URI cible** | Collection (`/users`) | Ressource sp√©cifique (`/users/123`) |
| **Effet de r√©p√©tition** | Cr√©e plusieurs ressources | M√™me r√©sultat |

**Exemple illustratif :**
```
POST /users          ‚Üí Cr√©e un utilisateur, serveur g√©n√®re l'ID
                        (POST 3 fois = 3 utilisateurs cr√©√©s)

PUT /users/123       ‚Üí Remplace l'utilisateur 123
                        (PUT 3 fois = utilisateur 123 toujours identique)
```

## PATCH - Modification partielle

### Description

`PATCH` est utilis√©e pour **modifier partiellement** une ressource. Contrairement √† PUT qui remplace toute la ressource, PATCH ne modifie que les champs sp√©cifi√©s.

### Caract√©ristiques

- ‚ùå **Not Safe** : Modifie l'√©tat du serveur
- ‚ùå **Not Idempotent** : Selon l'impl√©mentation (peut l'√™tre)
- ‚ùå **Not Cacheable**

### Format de la requ√™te

```http
PATCH /api/users/123 HTTP/1.1
Host: api.example.com
Content-Type: application/json

{
  "email": "newemail@example.com"
}
```

**Important :** Seuls les champs √† modifier sont envoy√©s.

### Exemples concrets

**1. Modifier uniquement l'email**
```http
√âtat initial :
{
  "id": 123,
  "name": "Alice Dupont",
  "email": "alice@example.com",
  "age": 30
}

PATCH /api/users/123 HTTP/1.1
Content-Type: application/json

{
  "email": "alice.new@example.com"
}

R√©sultat :
{
  "id": 123,
  "name": "Alice Dupont",           ‚Üê inchang√©
  "email": "alice.new@example.com", ‚Üê modifi√©
  "age": 30                         ‚Üê inchang√©
}
```

**2. Modifier plusieurs champs**
```http
PATCH /api/users/123 HTTP/1.1
Content-Type: application/json

{
  "email": "alice.new@example.com",
  "age": 31
}
```

**3. JSON Patch (RFC 6902)**

Format standardis√© pour d√©crire des modifications complexes :

```http
PATCH /api/users/123 HTTP/1.1
Content-Type: application/json-patch+json

[
  { "op": "replace", "path": "/email", "value": "new@example.com" },
  { "op": "add", "path": "/phone", "value": "+33612345678" },
  { "op": "remove", "path": "/temp_field" }
]
```

Op√©rations disponibles : `add`, `remove`, `replace`, `move`, `copy`, `test`

### Utilisation en code

**JavaScript**
```javascript
fetch('https://api.example.com/users/123', {
  method: 'PATCH',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    email: 'newemail@example.com'
  })
});
```

**Python**
```python
data = {'email': 'newemail@example.com'}
response = requests.patch('https://api.example.com/users/123', json=data)
```

**curl**
```bash
curl -X PATCH https://api.example.com/users/123 \
  -H "Content-Type: application/json" \
  -d '{"email":"newemail@example.com"}'
```

### PATCH vs PUT

| Crit√®re | PUT | PATCH |
|---------|-----|-------|
| **Remplacement** | Complet | Partiel |
| **Champs requis** | Tous | Seulement ceux √† modifier |
| **Idempotence** | Oui | Peut varier |
| **Bande passante** | Plus √©lev√©e | Plus faible |

**Exemple comparatif :**
```
Ressource initiale :
{
  "id": 1,
  "name": "Alice",
  "email": "alice@example.com",
  "age": 30,
  "address": "123 Rue Example"
}

Objectif : Changer uniquement l'email

PUT (doit tout envoyer) :
{
  "name": "Alice",
  "email": "newemail@example.com",
  "age": 30,
  "address": "123 Rue Example"
}

PATCH (envoie seulement ce qui change) :
{
  "email": "newemail@example.com"
}
```

### Bonnes pratiques

‚úÖ **Utilisez PATCH pour les modifications partielles**
```
Changer un seul champ ? ‚Üí PATCH
Remplacer toute la ressource ? ‚Üí PUT
```

‚úÖ **Validez que les champs modifi√©s existent**
```http
PATCH avec champ inexistant :
HTTP/1.1 400 Bad Request
{
  "error": "Field 'nonexistent_field' does not exist"
}
```

## DELETE - Supprimer une ressource

### Description

`DELETE` est utilis√©e pour **supprimer** une ressource du serveur.

### Caract√©ristiques

- ‚ùå **Not Safe** : Modifie l'√©tat du serveur
- ‚úÖ **Idempotent** : Supprimer 10 fois a le m√™me effet que supprimer 1 fois
- ‚ùå **Not Cacheable**

### Idempotence de DELETE

```
DELETE /users/123 (1√®re fois) ‚Üí 200 OK, utilisateur supprim√©
DELETE /users/123 (2√®me fois) ‚Üí 404 Not Found (d√©j√† supprim√©)

√âtat final identique : l'utilisateur n'existe plus
‚Üí Idempotent !
```

### Format de la requ√™te

```http
DELETE /api/users/123 HTTP/1.1
Host: api.example.com
Authorization: Bearer token123
```

**Note :** DELETE n'a g√©n√©ralement pas de body.

### Exemples concrets

**1. Supprimer un utilisateur**
```http
DELETE /api/users/123 HTTP/1.1
Host: api.example.com

R√©ponse :
HTTP/1.1 204 No Content
```

**2. Supprimer avec confirmation**
```http
DELETE /api/orders/456 HTTP/1.1
Host: api.example.com

R√©ponse :
HTTP/1.1 200 OK
Content-Type: application/json

{
  "message": "Order 456 deleted successfully",
  "deleted_at": "2025-12-06T16:00:00Z"
}
```

**3. Suppression impossible**
```http
DELETE /api/users/999 HTTP/1.1

R√©ponse :
HTTP/1.1 404 Not Found

{
  "error": "User not found"
}
```

**4. Suppression interdite**
```http
DELETE /api/admin/users/1 HTTP/1.1

R√©ponse :
HTTP/1.1 403 Forbidden

{
  "error": "Cannot delete admin user"
}
```

### Utilisation en code

**JavaScript**
```javascript
fetch('https://api.example.com/users/123', {
  method: 'DELETE',
  headers: {
    'Authorization': 'Bearer token123'
  }
})
.then(response => {
  if (response.ok) {
    console.log('Utilisateur supprim√©');
  }
});
```

**Python**
```python
response = requests.delete(
    'https://api.example.com/users/123',
    headers={'Authorization': 'Bearer token123'}
)
if response.status_code == 204:
    print('Utilisateur supprim√©')
```

**curl**
```bash
curl -X DELETE https://api.example.com/users/123 \
  -H "Authorization: Bearer token123"
```

### Codes de statut appropri√©s

| Code | Signification |
|------|---------------|
| **200 OK** | Suppression r√©ussie avec contenu de r√©ponse |
| **204 No Content** | Suppression r√©ussie sans contenu de r√©ponse |
| **404 Not Found** | Ressource n'existe pas |
| **403 Forbidden** | Suppression non autoris√©e |
| **409 Conflict** | Suppression impossible (d√©pendances) |

### Bonnes pratiques

‚úÖ **Soft delete vs Hard delete**
```
Hard delete : Suppression d√©finitive de la base de donn√©es
DELETE /users/123 ‚Üí L'utilisateur n'existe plus

Soft delete : Marquage comme supprim√©
DELETE /users/123 ‚Üí user.deleted = true
L'utilisateur existe toujours mais est inactif
```

‚úÖ **V√©rifiez les autorisations**
```python
# Exemple c√¥t√© serveur
if current_user.id != user_to_delete.id and not current_user.is_admin:
    return Response(status=403)
```

‚úÖ **G√©rez les d√©pendances**
```http
DELETE /api/categories/5

Si la cat√©gorie a des produits :
HTTP/1.1 409 Conflict
{
  "error": "Cannot delete category with existing products",
  "product_count": 42
}
```

## HEAD - R√©cup√©rer uniquement les headers

### Description

`HEAD` est identique √† GET, mais le serveur retourne **uniquement les headers**, sans le body.

### Caract√©ristiques

- ‚úÖ **Safe** : Ne modifie pas l'√©tat du serveur
- ‚úÖ **Idempotent**
- ‚úÖ **Cacheable**

### Utilit√©

HEAD est utile pour :
- V√©rifier si une ressource existe
- Obtenir la taille d'un fichier avant de le t√©l√©charger
- V√©rifier la date de derni√®re modification
- Tester l'accessibilit√© d'une URL

### Exemples concrets

**1. V√©rifier l'existence d'une ressource**
```http
HEAD /api/users/123 HTTP/1.1
Host: api.example.com

R√©ponse :
HTTP/1.1 200 OK
Content-Type: application/json
Content-Length: 245
Last-Modified: Thu, 05 Dec 2025 10:30:00 GMT

[pas de body]
```

**2. V√©rifier la taille d'un fichier**
```http
HEAD /downloads/largefile.zip HTTP/1.1
Host: files.example.com

R√©ponse :
HTTP/1.1 200 OK
Content-Length: 524288000
Content-Type: application/zip

‚Üí Le fichier fait ~524 MB, d√©cidez si vous voulez le t√©l√©charger
```

**3. V√©rifier si une ressource a chang√©**
```http
HEAD /api/data/report.pdf HTTP/1.1
Host: api.example.com

R√©ponse :
HTTP/1.1 200 OK
Last-Modified: Sat, 06 Dec 2025 08:00:00 GMT
ETag: "33a64df551425fcc55e4d42a148795d9f25f89d4"

‚Üí Comparez avec la version locale pour savoir s'il faut ret√©l√©charger
```

### Utilisation en code

**curl**
```bash
# HEAD request
curl -I https://example.com/file.pdf

# Affiche uniquement les headers
```

**Python**
```python
response = requests.head('https://example.com/largefile.zip')
file_size = int(response.headers.get('Content-Length', 0))
print(f"Taille du fichier : {file_size / (1024*1024):.2f} MB")
```

**JavaScript**
```javascript
fetch('https://example.com/file.pdf', {
  method: 'HEAD'
})
.then(response => {
  const size = response.headers.get('Content-Length');
  const modified = response.headers.get('Last-Modified');
  console.log(`Taille: ${size}, Modifi√©: ${modified}`);
});
```

## OPTIONS - D√©couvrir les options disponibles

### Description

`OPTIONS` permet de d√©couvrir les **m√©thodes HTTP support√©es** par une ressource et d'autres options de communication.

### Caract√©ristiques

- ‚úÖ **Safe** : Ne modifie pas l'√©tat du serveur
- ‚úÖ **Idempotent**
- ‚ùå **Not Cacheable**

### Utilit√© principale : CORS

OPTIONS est principalement utilis√© pour les requ√™tes **CORS (Cross-Origin Resource Sharing)** preflight.

### Exemples concrets

**1. D√©couvrir les m√©thodes support√©es**
```http
OPTIONS /api/users/123 HTTP/1.1
Host: api.example.com

R√©ponse :
HTTP/1.1 200 OK
Allow: GET, PUT, PATCH, DELETE, HEAD, OPTIONS
```

**2. Preflight CORS**
```http
OPTIONS /api/users HTTP/1.1
Host: api.example.com
Origin: https://app.example.com
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type, Authorization

R√©ponse :
HTTP/1.1 204 No Content
Access-Control-Allow-Origin: https://app.example.com
Access-Control-Allow-Methods: GET, POST, PUT, DELETE
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Max-Age: 86400
```

Le navigateur envoie automatiquement cette requ√™te OPTIONS avant une requ√™te "complexe" pour v√©rifier si le serveur autorise la requ√™te cross-origin.

**3. OPTIONS sur toutes les ressources**
```http
OPTIONS * HTTP/1.1
Host: api.example.com

R√©ponse :
HTTP/1.1 200 OK
Allow: GET, POST, HEAD, OPTIONS
```

### Utilisation en code

**curl**
```bash
curl -X OPTIONS https://api.example.com/users/123 -v
```

**JavaScript (g√©n√©ralement automatique)**
```javascript
// Le navigateur envoie automatiquement OPTIONS pour CORS
// Vous n'avez g√©n√©ralement pas besoin de le faire manuellement
fetch('https://api.autre-domaine.com/data', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({data: 'test'})
});
// ‚Üí Le navigateur envoie d'abord OPTIONS, puis POST
```

## CONNECT - √âtablir un tunnel

### Description

`CONNECT` est utilis√©e pour √©tablir un **tunnel** √† travers un proxy, principalement pour HTTPS.

### Utilit√©

Permet de cr√©er une connexion de bout en bout √† travers un proxy HTTP pour du trafic non-HTTP (typiquement HTTPS/TLS).

### Exemple

```http
CONNECT server.example.com:443 HTTP/1.1
Host: server.example.com:443

R√©ponse du proxy :
HTTP/1.1 200 Connection Established

[Le tunnel est √©tabli, TLS handshake peut commencer]
```

**Usage typique :**
```
Client ‚Üí Proxy HTTP ‚Üí CONNECT ‚Üí Serveur HTTPS
         ‚Üë
         Tunnel transparent pour le trafic chiffr√©
```

**Note :** En tant que d√©veloppeur d'applications, vous utiliserez rarement CONNECT directement. C'est g√©r√© automatiquement par les proxys et les navigateurs.

## TRACE - Diagnostic de boucle

### Description

`TRACE` effectue un **test de boucle** le long du chemin vers la ressource cible.

### Caract√©ristiques

- ‚úÖ **Safe**
- ‚úÖ **Idempotent**
- ‚ùå **Not Cacheable**

### Exemple

```http
TRACE /api/users HTTP/1.1
Host: api.example.com

R√©ponse :
HTTP/1.1 200 OK
Content-Type: message/http

TRACE /api/users HTTP/1.1
Host: api.example.com
Via: 1.1 proxy.example.com
```

### Pourquoi TRACE est peu utilis√©

- ‚ùå **Risques de s√©curit√©** : Peut r√©v√©ler des informations sensibles (cookies, tokens)
- ‚ùå **Souvent d√©sactiv√©** : La plupart des serveurs modernes d√©sactivent TRACE
- ‚ùå **Peu utile** : Les outils de d√©bogage modernes sont plus efficaces

## Tableau r√©capitulatif complet

| M√©thode | Usage | Safe | Idempotent | Body requ√™te | Body r√©ponse | Code succ√®s typique |
|---------|-------|------|------------|--------------|--------------|---------------------|
| **GET** | Lire | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ | 200 OK |
| **POST** | Cr√©er/Soumettre | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ | 201 Created |
| **PUT** | Remplacer | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ | 200 OK / 204 |
| **PATCH** | Modifier | ‚ùå | ‚ö†Ô∏è | ‚úÖ | ‚úÖ | 200 OK |
| **DELETE** | Supprimer | ‚ùå | ‚úÖ | ‚ùå | ‚ö†Ô∏è | 204 No Content |
| **HEAD** | Headers seulement | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå | 200 OK |
| **OPTIONS** | D√©couvrir options | ‚úÖ | ‚úÖ | ‚ùå | ‚ö†Ô∏è | 200 OK / 204 |
| **CONNECT** | Tunnel | ‚ùå | ‚ùå | ‚ö†Ô∏è | ‚ö†Ô∏è | 200 |
| **TRACE** | Diagnostic | ‚úÖ | ‚úÖ | ‚ùå | ‚úÖ | 200 OK |

## Les m√©thodes dans le contexte REST

### Architecture REST

REST (Representational State Transfer) utilise les m√©thodes HTTP de mani√®re s√©mantique pour manipuler des ressources :

```
Ressource : /api/users

GET    /api/users        ‚Üí Liste tous les utilisateurs
POST   /api/users        ‚Üí Cr√©e un nouvel utilisateur
GET    /api/users/123    ‚Üí R√©cup√®re l'utilisateur 123
PUT    /api/users/123    ‚Üí Remplace l'utilisateur 123
PATCH  /api/users/123    ‚Üí Modifie l'utilisateur 123
DELETE /api/users/123    ‚Üí Supprime l'utilisateur 123
```

### CRUD et m√©thodes HTTP

| Op√©ration CRUD | M√©thode HTTP | Exemple |
|----------------|--------------|---------|
| **Create** | POST | POST /users |
| **Read** | GET | GET /users/123 |
| **Update** | PUT ou PATCH | PUT /users/123 |
| **Delete** | DELETE | DELETE /users/123 |

### Exemple d'API REST compl√®te

```
Collection d'articles de blog : /api/articles

GET    /api/articles
‚Üí Liste tous les articles (avec pagination)

POST   /api/articles
‚Üí Cr√©e un nouvel article
Body : { "title": "Mon article", "content": "..." }

GET    /api/articles/42
‚Üí R√©cup√®re l'article 42

PUT    /api/articles/42
‚Üí Remplace compl√®tement l'article 42
Body : { "title": "Nouveau titre", "content": "Nouveau contenu", ... }

PATCH  /api/articles/42
‚Üí Modifie partiellement l'article 42
Body : { "title": "Titre modifi√©" }

DELETE /api/articles/42
‚Üí Supprime l'article 42

GET    /api/articles/42/comments
‚Üí Sous-ressource : commentaires de l'article 42

POST   /api/articles/42/comments
‚Üí Ajoute un commentaire √† l'article 42
```

## Bonnes pratiques g√©n√©rales

### 1. Utilisez la bonne m√©thode pour la bonne action

```
‚ùå √âvitez :
GET  /deleteUser?id=123
POST /getUser
GET  /updateUser?id=123&name=Alice

‚úÖ Pr√©f√©rez :
DELETE /users/123
GET    /users/123
PUT    /users/123
```

### 2. Respectez l'idempotence

```
Op√©rations idempotentes (GET, PUT, DELETE) :
‚Üí Peuvent √™tre r√©essay√©es sans risque

Op√©rations non-idempotentes (POST) :
‚Üí N√©cessitent des tokens d'idempotence ou de la logique m√©tier
```

### 3. Utilisez les codes de statut appropri√©s

```http
POST /users ‚Üí 201 Created (succ√®s de cr√©ation)
GET /users/123 ‚Üí 200 OK (ressource trouv√©e)
GET /users/999 ‚Üí 404 Not Found (ressource inexistante)
PUT /users/123 ‚Üí 200 OK ou 204 No Content
DELETE /users/123 ‚Üí 204 No Content
```

### 4. S√©curisez vos endpoints

```
Authentification :
- Utilisez des tokens (JWT, OAuth)
- HTTPS obligatoire

Autorisation :
- V√©rifiez les permissions pour PUT, PATCH, DELETE
- Limitez l'acc√®s selon les r√¥les
```

### 5. Validez les donn√©es

```python
# Exemple validation c√¥t√© serveur
@app.route('/users', methods=['POST'])
def create_user():
    data = request.json

    # Validation
    if not data.get('email'):
        return {'error': 'Email required'}, 400

    if not is_valid_email(data['email']):
        return {'error': 'Invalid email format'}, 400

    # Cr√©ation
    user = User.create(data)
    return user.to_dict(), 201
```

### 6. Documentez votre API

Utilisez des outils comme :
- OpenAPI/Swagger
- Postman Collections
- API Blueprint

Exemple de documentation :
```yaml
paths:
  /users/{id}:
    get:
      summary: R√©cup√®re un utilisateur
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Utilisateur trouv√©
        '404':
          description: Utilisateur non trouv√©
```

---

## Points cl√©s √† retenir

üîë **GET** : Lecture de ressources - Safe, idempotent, cacheable

üîë **POST** : Cr√©ation ou soumission - Non safe, non idempotent

üîë **PUT** : Remplacement complet - Non safe, idempotent

üîë **PATCH** : Modification partielle - Non safe, parfois idempotent

üîë **DELETE** : Suppression - Non safe, idempotent

üîë **HEAD** : Headers seulement - Utile pour v√©rifications

üîë **OPTIONS** : D√©couvrir les options - Crucial pour CORS

üîë **Utilisez la bonne m√©thode** : Respectez la s√©mantique HTTP pour des APIs propres et pr√©visibles

üîë **REST = HTTP s√©mantique** : Les m√©thodes HTTP mappent naturellement aux op√©rations CRUD

---

## Ce que nous allons voir ensuite

Dans la prochaine section **5.4.2 Codes de statut HTTP**, nous explorerons en d√©tail :
- Les diff√©rentes cat√©gories de codes (2xx, 3xx, 4xx, 5xx)
- La signification de chaque code courant
- Quand utiliser quel code
- Les bonnes pratiques de gestion des erreurs

**Les m√©thodes HTTP et les codes de statut forment ensemble le langage de communication entre clients et serveurs web !** üëâ

---

*Ma√Ætriser les m√©thodes HTTP est essentiel pour concevoir des APIs REST propres, pr√©visibles et conformes aux standards du Web. Chaque m√©thode a sa s√©mantique et son utilit√© - utilisez-les correctement !*

‚è≠Ô∏è [Codes de statut](/05-couche-application/04.2-http-codes-statut.md)
