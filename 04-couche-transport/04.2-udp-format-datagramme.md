ğŸ” Retour au [Sommaire](/SOMMAIRE.md)

# 4.4.2 Format du datagramme UDP

## Introduction

L'en-tÃªte UDP est remarquable par sa **simplicitÃ© extrÃªme** : seulement **8 octets** (64 bits), soit l'en-tÃªte de protocole de transport le plus compact qui existe. Cette simplicitÃ© est une caractÃ©ristique fondamentale d'UDP et reflÃ¨te sa philosophie minimaliste.

Pour mettre cela en perspective :
- **En-tÃªte UDP** : 8 octets
- **En-tÃªte TCP** : 20-60 octets (minimum 20, jusqu'Ã  60 avec options)
- **En-tÃªte IP** : 20-60 octets (minimum 20)

Dans cette section, nous allons dissÃ©quer chaque octet de l'en-tÃªte UDP et comprendre le rÃ´le prÃ©cis de chaque champ.

## Structure globale d'un datagramme UDP

Un datagramme UDP complet se compose de deux parties :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   DATAGRAMME UDP                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         EN-TÃŠTE UDP (8 octets)                    â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚  â€¢ Port source (2 octets)                         â”‚  â”‚
â”‚  â”‚  â€¢ Port destination (2 octets)                    â”‚  â”‚
â”‚  â”‚  â€¢ Longueur (2 octets)                            â”‚  â”‚
â”‚  â”‚  â€¢ Checksum (2 octets)                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         DONNÃ‰ES                                   â”‚  â”‚
â”‚  â”‚         (0 Ã  65 527 octets)                       â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚  DonnÃ©es de l'application                         â”‚  â”‚
â”‚  â”‚  (payload)                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## L'en-tÃªte UDP : 8 octets de prÃ©cision

### Vue d'ensemble

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|          Port Source          |       Port Destination        |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|           Longueur            |           Checksum            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                         DONNÃ‰ES                               |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

**Organisation** :
- **Octets 0-1** : Port source
- **Octets 2-3** : Port destination
- **Octets 4-5** : Longueur
- **Octets 6-7** : Checksum

Chaque champ occupe exactement 16 bits (2 octets).

## Champ 1 : Port Source (16 bits)

### Description

Le **port source** identifie l'application Ã©mettrice sur la machine source.

**CaractÃ©ristiques** :
- Taille : 16 bits (2 octets)
- Valeurs possibles : 0-65535
- Position : Octets 0-1 de l'en-tÃªte
- Format : Entier non signÃ© (big-endian)

### RÃ´le et utilisation

**Pour les clients** : GÃ©nÃ©ralement un port Ã©phÃ©mÃ¨re (49152-65535) attribuÃ© automatiquement par le systÃ¨me d'exploitation.

**Pour les serveurs** : Port bien connu ou enregistrÃ© sur lequel le service Ã©coute (ex: 53 pour DNS).

### CaractÃ¨re optionnel

Le port source peut Ãªtre mis Ã  **zÃ©ro** (0x0000) si l'application n'attend pas de rÃ©ponse. Cela indique "pas de port de retour" ou "rÃ©ponse non attendue".

**Exemple d'utilisation avec port source Ã  0** : Envoi de logs en broadcast UDP oÃ¹ aucune rÃ©ponse n'est attendue.

### Exemple hexadÃ©cimal

```
Port source = 54231 (dÃ©cimal) = 0xD3D7 (hexadÃ©cimal)

En mÃ©moire (big-endian) :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0xD3   â”‚ 0xD7   â”‚  = 54231
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Octet 0  Octet 1
```

**VÃ©rification** : 0xD3D7 = (211 Ã— 256) + 215 = 54016 + 215 = 54231 âœ“

## Champ 2 : Port Destination (16 bits)

### Description

Le **port destination** identifie l'application rÃ©ceptrice sur la machine destination.

**CaractÃ©ristiques** :
- Taille : 16 bits (2 octets)
- Valeurs possibles : 0-65535
- Position : Octets 2-3 de l'en-tÃªte
- Format : Entier non signÃ© (big-endian)

### RÃ´le et importance

Ce champ est **obligatoire** et doit toujours contenir une valeur valide. Il dÃ©termine quelle application sur la machine destination recevra le datagramme.

**Exemples de ports destination courants** :
- 53 : DNS
- 67 : DHCP (serveur)
- 68 : DHCP (client)
- 123 : NTP
- 161 : SNMP
- 514 : Syslog

### Exemple hexadÃ©cimal

```
Port destination = 53 (DNS) = 0x0035 (hexadÃ©cimal)

En mÃ©moire (big-endian) :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0x00   â”‚ 0x35   â”‚  = 53
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Octet 2  Octet 3
```

## Champ 3 : Longueur (16 bits)

### Description

Le champ **longueur** spÃ©cifie la taille totale du datagramme UDP (en-tÃªte + donnÃ©es) en octets.

**CaractÃ©ristiques** :
- Taille : 16 bits (2 octets)
- Valeurs possibles : 8-65535
- Position : Octets 4-5 de l'en-tÃªte
- Format : Entier non signÃ© (big-endian)
- Valeur minimale : 8 (en-tÃªte seul, sans donnÃ©es)
- Valeur maximale : 65535 (limite thÃ©orique)

### Calcul de la longueur

```
Longueur UDP = Taille en-tÃªte (8 octets) + Taille donnÃ©es

Exemples :
â€¢ Datagramme vide : 8 + 0 = 8 octets
â€¢ RequÃªte DNS (50 octets de donnÃ©es) : 8 + 50 = 58 octets
â€¢ Datagramme de 1000 octets : 8 + 1000 = 1008 octets
```

### Redondance avec IP

Ce champ peut sembler redondant car **l'en-tÃªte IP contient dÃ©jÃ  la longueur totale du paquet IP**. On pourrait dÃ©duire la longueur UDP :

```
Longueur UDP = Longueur totale IP - Taille en-tÃªte IP
```

**Pourquoi le garder alors ?**
1. **Historique** : HÃ©ritÃ© de la conception originale
2. **Validation** : Permet de vÃ©rifier la cohÃ©rence avec IP
3. **SimplicitÃ©** : Ã‰vite de dÃ©pendre de l'en-tÃªte IP pour traiter UDP
4. **Fragmentation** : Utile pour les fragments IP

### Exemple hexadÃ©cimal

```
Longueur = 58 octets = 0x003A (hexadÃ©cimal)

En mÃ©moire (big-endian) :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0x00   â”‚ 0x3A   â”‚  = 58
â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  Octet 4  Octet 5

Signification : 8 octets d'en-tÃªte + 50 octets de donnÃ©es
```

### Limites pratiques

**Limite thÃ©orique** : 65535 octets (limite du champ 16 bits)

**Limite IP** : Un paquet IP peut contenir au maximum 65535 octets (en-tÃªte IP inclus), donc :
```
Longueur max UDP = 65535 (paquet IP) - 20 (en-tÃªte IP min)
                 = 65515 octets

DonnÃ©es max UDP = 65515 - 8 (en-tÃªte UDP)
                = 65507 octets
```

**Limite pratique** : MTU Ethernet = 1500 octets
```
DonnÃ©es UDP recommandÃ©es = 1500 - 20 (IP) - 8 (UDP)
                          = 1472 octets

Ou mieux (avec marge) : 1400 octets
```

## Champ 4 : Checksum (16 bits)

### Description

Le **checksum** (somme de contrÃ´le) est utilisÃ© pour dÃ©tecter les erreurs de transmission dans le datagramme UDP.

**CaractÃ©ristiques** :
- Taille : 16 bits (2 octets)
- Position : Octets 6-7 de l'en-tÃªte
- Format : ComplÃ©ment Ã  1 de la somme en complÃ©ment Ã  1
- Statut IPv4 : **Optionnel** (peut Ãªtre 0x0000)
- Statut IPv6 : **Obligatoire** (ne peut pas Ãªtre 0x0000)

### Pourquoi un checksum ?

IP a dÃ©jÃ  un checksum pour protÃ©ger son propre en-tÃªte, mais **pas pour les donnÃ©es**. UDP ajoute un checksum qui couvre :
1. Un pseudo-en-tÃªte (empruntÃ© Ã  IP)
2. L'en-tÃªte UDP complet
3. Les donnÃ©es UDP

Cela permet de dÃ©tecter :
- Erreurs de transmission (corruption de bits)
- Erreurs de routage (paquet livrÃ© Ã  la mauvaise machine)
- Corruption en mÃ©moire

### CaractÃ¨re optionnel (IPv4)

En IPv4, le checksum UDP est **optionnel**. Si l'Ã©metteur ne calcule pas de checksum, il met le champ Ã  **0x0000**.

**Raisons de l'omettre** :
- Gain de performance (pas de calcul)
- Application fait sa propre vÃ©rification
- RÃ©seau trÃ¨s fiable (ex: rÃ©seau local)

**Pourquoi le calculer** :
- DÃ©tection d'erreurs
- SÃ©curitÃ©
- Bonne pratique

### Checksum obligatoire (IPv6)

En IPv6, le checksum UDP est **obligatoire**. La valeur 0x0000 est interdite. Si le calcul donne 0x0000, on utilise 0xFFFF Ã  la place.

**Raison** : IPv6 n'a pas de checksum dans son en-tÃªte (contrairement Ã  IPv4), donc UDP doit impÃ©rativement vÃ©rifier l'intÃ©gritÃ©.

### Le pseudo-en-tÃªte

Le checksum UDP inclut un **pseudo-en-tÃªte** construit Ã  partir de l'en-tÃªte IP. Ce n'est pas transmis sur le rÃ©seau, mais utilisÃ© uniquement pour le calcul du checksum.

#### Pseudo-en-tÃªte IPv4 (12 octets)

```
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Adresse IP Source                       |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                    Adresse IP Destination                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|     ZÃ©ros     |   Protocole   |          Longueur UDP         |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

**Champs** :
- **Adresse IP source** : 4 octets
- **Adresse IP destination** : 4 octets
- **ZÃ©ros** : 1 octet (toujours 0x00)
- **Protocole** : 1 octet (0x11 pour UDP)
- **Longueur UDP** : 2 octets

#### Pseudo-en-tÃªte IPv6 (40 octets)

```
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                       Adresse IPv6 Source                     |
|                         (16 octets)                           |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
|                    Adresse IPv6 Destination                   |
|                         (16 octets)                           |
|                                                               |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                       Longueur UDP                            |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                   ZÃ©ros                   |  Next Header (UDP)|
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
```

### Algorithme de calcul du checksum

Le checksum UDP utilise l'algorithme du **complÃ©ment Ã  1** :

```
1. Construire le pseudo-en-tÃªte
2. ConcatÃ©ner : pseudo-en-tÃªte + en-tÃªte UDP + donnÃ©es
3. Si la longueur est impaire, ajouter un octet de padding (0x00) Ã  la fin
4. DÃ©couper en mots de 16 bits
5. Additionner tous les mots en complÃ©ment Ã  1
6. Prendre le complÃ©ment Ã  1 du rÃ©sultat
7. Si le rÃ©sultat est 0x0000 :
   - IPv4 : laisser 0x0000 (checksum dÃ©sactivÃ©)
   - IPv6 : utiliser 0xFFFF
```

### Exemple de calcul dÃ©taillÃ©

**ScÃ©nario** : RequÃªte DNS simple

```
IP Source : 192.168.1.100 (0xC0A80164)
IP Dest   : 8.8.8.8        (0x08080808)
Port Src  : 54231          (0xD3D7)
Port Dest : 53             (0x0035)
DonnÃ©es   : "DNS query"    (10 octets de donnÃ©es exemple)
```

#### Ã‰tape 1 : Construire le pseudo-en-tÃªte

```
Pseudo-en-tÃªte (12 octets) :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0xC0 0xA8 0x01 0x64  (IP src)          â”‚
â”‚ 0x08 0x08 0x08 0x08  (IP dest)         â”‚
â”‚ 0x00 0x11            (ZÃ©ros + Proto)   â”‚
â”‚ 0x00 0x12            (Longueur UDP: 18)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Ã‰tape 2 : En-tÃªte UDP (checksum = 0 temporairement)

```
En-tÃªte UDP (8 octets) :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0xD3 0xD7            (Port src)        â”‚
â”‚ 0x00 0x35            (Port dest)       â”‚
â”‚ 0x00 0x12            (Longueur)        â”‚
â”‚ 0x00 0x00            (Checksum = 0)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Ã‰tape 3 : DonnÃ©es

```
DonnÃ©es (10 octets) :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 0x44 0x4E 0x53 0x20 0x71 0x75 0x65 ... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Ã‰tape 4 : DÃ©couper en mots de 16 bits et additionner

```
Pseudo-en-tÃªte :
  0xC0A8 + 0x0164 + 0x0808 + 0x0808 + 0x0011 + 0x0012

En-tÃªte UDP :
  0xD3D7 + 0x0035 + 0x0012 + 0x0000

DonnÃ©es (par mots de 16 bits) :
  0x444E + 0x5320 + 0x7175 + 0x6572 + 0x79...

Somme totale (avec gestion des retenues) = 0xABCD (exemple)
```

#### Ã‰tape 5 : ComplÃ©ment Ã  1

```
Checksum = ~0xABCD = 0x5432
```

Ce checksum est alors placÃ© dans le champ checksum de l'en-tÃªte UDP.

### VÃ©rification du checksum (rÃ©cepteur)

Le rÃ©cepteur effectue le mÃªme calcul :

```
1. Extraire le checksum reÃ§u
2. Remettre le champ checksum Ã  0x0000
3. Recalculer le checksum
4. Comparer avec le checksum reÃ§u

Si Ã©gaux : Datagramme OK
Si diffÃ©rents : Datagramme corrompu â†’ REJETÃ‰ (silencieusement)
```

**Important** : Si le checksum est invalide, UDP **rejette silencieusement** le datagramme. Aucune notification d'erreur n'est envoyÃ©e.

## Exemple complet : Datagramme UDP rÃ©el

Analysons un vÃ©ritable datagramme UDP capturÃ© avec Wireshark : une requÃªte DNS.

### Contexte

```
Client     : 192.168.1.100:54231
Serveur DNS : 8.8.8.8:53
RequÃªte    : "Quelle est l'IP de google.com ?"
```

### Capture hexadÃ©cimale complÃ¨te

```
En-tÃªte IP (20 octets) :
45 00 00 46 1C 46 00 00 40 11 A6 EC C0 A8 01 64 08 08 08 08

En-tÃªte UDP (8 octets) :
D3 D7 00 35 00 32 8F 4A

DonnÃ©es DNS (42 octets) :
AB CD 01 00 00 01 00 00 00 00 00 00 06 67 6F 6F
67 6C 65 03 63 6F 6D 00 00 01 00 01 ...
```

### DÃ©codage de l'en-tÃªte UDP

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DÃ‰CODAGE EN-TÃŠTE UDP                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Octets 0-1       â”‚ D3 D7 = 0xD3D7 = 54231               â”‚
â”‚ (Port source)    â”‚ Port Ã©phÃ©mÃ¨re du client              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Octets 2-3       â”‚ 00 35 = 0x0035 = 53                  â”‚
â”‚ (Port dest)      â”‚ Port DNS standard                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Octets 4-5       â”‚ 00 32 = 0x0032 = 50                  â”‚
â”‚ (Longueur)       â”‚ 8 octets (en-tÃªte) + 42 (donnÃ©es)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Octets 6-7       â”‚ 8F 4A = 0x8F4A                       â”‚
â”‚ (Checksum)       â”‚ Checksum calculÃ© et vÃ©rifiÃ© âœ“        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Visualisation complÃ¨te

```
DATAGRAMME UDP COMPLET (50 octets)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Offset   Hex                                      ASCII
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0x0000   D3 D7 00 35 00 32 8F 4A AB CD 01 00     ......J....
0x000C   00 01 00 00 00 00 00 00 06 67 6F 6F     .........goo
0x0018   67 6C 65 03 63 6F 6D 00 00 01 00 01     gle.com.....
0x0024   ...

DÃ©tail :
â”€â”€â”€â”€â”€â”€â”€
â”‚
â”œâ”€ D3 D7           : Port source (54231)
â”œâ”€ 00 35           : Port destination (53 = DNS)
â”œâ”€ 00 32           : Longueur (50 octets)
â”œâ”€ 8F 4A           : Checksum
â”‚
â””â”€ AB CD 01 00 ... : DonnÃ©es (requÃªte DNS pour google.com)
```

## Comparaison avec TCP

Pour apprÃ©cier la simplicitÃ© d'UDP, comparons ses 8 octets d'en-tÃªte avec les 20 octets minimum de TCP :

```
EN-TÃŠTE UDP (8 octets)           EN-TÃŠTE TCP (20 octets minimum)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Port source (2)  â”‚             â”‚ Port source (2)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Port dest (2)    â”‚             â”‚ Port dest (2)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Longueur (2)     â”‚             â”‚ Seq number (4)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Checksum (2)     â”‚             â”‚ Ack number (4)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                 â”‚ Offset/Flags (2) â”‚
    8 octets                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                 â”‚ Window (2)       â”‚
                                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                 â”‚ Checksum (2)     â”‚
                                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                                 â”‚ Urgent ptr (2)   â”‚
                                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                     20 octets
                                 (+ options jusqu'Ã  40)
```

**Observations** :
- UDP : **4 champs**, rÃ´les simples
- TCP : **10+ champs**, mÃ©canismes complexes

## Encapsulation dans IP

Voyons comment UDP s'insÃ¨re dans un paquet IP complet.

### Structure d'encapsulation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     TRAME ETHERNET                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              EN-TÃŠTE ETHERNET (14 octets)             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               EN-TÃŠTE IP (20-60 octets)               â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â€¢ Version, Longueur, TTL, Protocole (0x11 = UDP)     â”‚  â”‚
â”‚  â”‚  â€¢ IP Source, IP Destination                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               EN-TÃŠTE UDP (8 octets)                  â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚  â€¢ Port source, Port destination                      â”‚  â”‚
â”‚  â”‚  â€¢ Longueur, Checksum                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               DONNÃ‰ES APPLICATION                     â”‚  â”‚
â”‚  â”‚               (0-65507 octets)                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚               FCS ETHERNET (4 octets)                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Identification UDP dans l'en-tÃªte IP

L'en-tÃªte IP contient un champ **Protocole** (1 octet) qui indique le protocole de la couche supÃ©rieure :

```
Valeurs courantes :
â€¢ 0x01 (1)  : ICMP
â€¢ 0x06 (6)  : TCP
â€¢ 0x11 (17) : UDP â† C'est ici !
â€¢ 0x58 (88) : EIGRP
```

Quand IP voit Protocole = 0x11, il sait que les donnÃ©es qui suivent son en-tÃªte sont un datagramme UDP.

### Exemple complet de capture

```
PAQUET IP/UDP COMPLET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

EN-TÃŠTE IP (20 octets) :
45 00 00 3C 1C 46 40 00 40 11 A6 EC C0 A8 01 64 08 08 08 08
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”˜
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚      â”‚         â”‚
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚      â”‚         â””â”€ IP dest (8.8.8.8)
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ IP src (192.168.1.100)
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Checksum IP
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Protocole (0x11 = UDP)
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TTL (64)
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Flags/Fragment
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Identification
â”‚  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Longueur totale (60 octets)
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Type of Service
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Header length (5 = 20 octets)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Version (4 = IPv4)

EN-TÃŠTE UDP (8 octets) :
D3 D7 00 35 00 28 8F 4A
â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚
â””â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”´â”€â”€â”€ DÃ©taillÃ© plus haut

DONNÃ‰ES (32 octets) :
RequÃªte DNS ou autres donnÃ©es application...
```

## Cas particuliers et variations

### UDP sans donnÃ©es

Un datagramme UDP peut Ãªtre vide (sans donnÃ©es), contenant uniquement l'en-tÃªte de 8 octets.

```
En-tÃªte UDP seul :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Port source   : 0x1234          â”‚
â”‚ Port dest     : 0x0035          â”‚
â”‚ Longueur      : 0x0008 (8)      â”‚
â”‚ Checksum      : 0xXXXX          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Aucune donnÃ©e
```

**UtilitÃ©** :
- Keepalive (maintenir un NAT ouvert)
- DÃ©tection de connectivitÃ© (ping applicatif)
- Synchronisation

### UDP avec checksum dÃ©sactivÃ© (IPv4)

```
En-tÃªte UDP avec checksum = 0 :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Port source   : 0xD3D7             â”‚
â”‚ Port dest     : 0x0035             â”‚
â”‚ Longueur      : 0x0032 (50)        â”‚
â”‚ Checksum      : 0x0000 â† DÃ©sactivÃ© â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Signification : Pas de vÃ©rification d'intÃ©gritÃ©
```

**Quand l'utiliser** :
- RÃ©seau local trÃ¨s fiable
- Performance critique
- Application fait sa propre vÃ©rification

**Risques** :
- Corruption non dÃ©tectÃ©e
- Livraison Ã  la mauvaise application (si routage corrompu)

### Datagramme UDP maximum thÃ©orique

```
Longueur maximale UDP : 65535 octets

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ En-tÃªte UDP : 8 octets                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ DonnÃ©es : 65527 octets                    â”‚
â”‚                                           â”‚
â”‚ (NÃ©cessiterait ~44 fragments IP           â”‚
â”‚  avec MTU 1500)                           â”‚
â”‚                                           â”‚
â”‚ NON RECOMMANDÃ‰ EN PRATIQUE !              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Datagramme UDP recommandÃ© (Ethernet)

```
Taille recommandÃ©e : â‰¤ 1472 octets de donnÃ©es

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Trame Ethernet : 1500 octets (MTU)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ En-tÃªte IP : 20 octets              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ En-tÃªte UDP : 8 octets              â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ DonnÃ©es : 1472 octets               â”‚  â”‚
â”‚  â”‚                                     â”‚  â”‚
â”‚  â”‚ PAS DE FRAGMENTATION                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Manipulation programmatique

### Construction manuelle d'un en-tÃªte UDP en Python

```python
import struct
import socket

def create_udp_header(src_port, dst_port, data):
    """
    Construit un en-tÃªte UDP complet
    """
    # Longueur = en-tÃªte (8) + donnÃ©es
    length = 8 + len(data)

    # Checksum = 0 pour l'instant (sera calculÃ© aprÃ¨s)
    checksum = 0

    # Construire l'en-tÃªte (format big-endian)
    header = struct.pack('>HHHH',
                        src_port,    # Port source
                        dst_port,    # Port destination
                        length,      # Longueur
                        checksum)    # Checksum

    return header

# Exemple d'utilisation
data = b"Hello, UDP!"
header = create_udp_header(54231, 53, data)

print("En-tÃªte UDP (hex):", header.hex())
# Sortie : d3d70035001b0000
#          â”‚  â”‚ â”‚  â”‚ â”‚  â”‚
#          â”‚  â”‚ â”‚  â”‚ â”‚  â””â”€ Checksum (0)
#          â”‚  â”‚ â”‚  â”‚ â””â”€â”€â”€â”€ Longueur (27 = 0x001B)
#          â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€ Port dest (53 = 0x0035)
#          â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Port source (54231 = 0xD3D7)
```

### Calcul du checksum UDP

```python
def calculate_udp_checksum(src_ip, dst_ip, udp_header, udp_data):
    """
    Calcule le checksum UDP incluant le pseudo-en-tÃªte
    """
    # Construire le pseudo-en-tÃªte IPv4
    src_ip_bytes = socket.inet_aton(src_ip)
    dst_ip_bytes = socket.inet_aton(dst_ip)

    pseudo_header = struct.pack('>4s4sBBH',
                               src_ip_bytes,  # IP source
                               dst_ip_bytes,  # IP destination
                               0,             # ZÃ©ros
                               socket.IPPROTO_UDP,  # Protocole (17)
                               len(udp_header) + len(udp_data))  # Longueur UDP

    # ConcatÃ©ner : pseudo-en-tÃªte + en-tÃªte UDP + donnÃ©es
    checksum_data = pseudo_header + udp_header + udp_data

    # Si longueur impaire, ajouter padding
    if len(checksum_data) % 2 == 1:
        checksum_data += b'\x00'

    # Calculer le checksum
    total = 0
    for i in range(0, len(checksum_data), 2):
        word = (checksum_data[i] << 8) + checksum_data[i + 1]
        total += word
        # GÃ©rer les retenues
        total = (total & 0xFFFF) + (total >> 16)

    # ComplÃ©ment Ã  1
    checksum = ~total & 0xFFFF

    # Si 0, utiliser 0xFFFF pour IPv6 (ou laisser 0 pour IPv4)
    if checksum == 0:
        checksum = 0xFFFF

    return checksum

# Exemple
src_ip = "192.168.1.100"
dst_ip = "8.8.8.8"
data = b"Hello, UDP!"

header = create_udp_header(54231, 53, data)
checksum = calculate_udp_checksum(src_ip, dst_ip, header, data)

print(f"Checksum calculÃ© : 0x{checksum:04X}")
```

### Analyse d'un datagramme UDP reÃ§u

```python
def parse_udp_header(udp_packet):
    """
    Parse un datagramme UDP complet
    """
    # Extraire l'en-tÃªte (8 premiers octets)
    header = udp_packet[:8]
    data = udp_packet[8:]

    # DÃ©coder les champs
    src_port, dst_port, length, checksum = struct.unpack('>HHHH', header)

    return {
        'src_port': src_port,
        'dst_port': dst_port,
        'length': length,
        'checksum': checksum,
        'data': data,
        'data_length': len(data)
    }

# Exemple avec donnÃ©es binaires
udp_packet = bytes.fromhex('d3d70035001b8f4a48656c6c6f2c20554450 21')

info = parse_udp_header(udp_packet)
print(f"Port source      : {info['src_port']}")
print(f"Port destination : {info['dst_port']}")
print(f"Longueur         : {info['length']}")
print(f"Checksum         : 0x{info['checksum']:04X}")
print(f"DonnÃ©es          : {info['data']}")
```

## Optimisations et considÃ©rations

### Alignement mÃ©moire

Sur certaines architectures, l'accÃ¨s Ã  des donnÃ©es mal alignÃ©es peut Ãªtre lent ou causer des erreurs. L'en-tÃªte UDP Ã©tant de 8 octets, il est naturellement alignÃ© sur 32 bits et 64 bits.

```
Adresse mÃ©moire alignÃ©e (optimal) :
0x1000 : [Port src ][Port dst ]  â† AlignÃ© 32 bits
0x1004 : [Longueur ][Checksum]   â† AlignÃ© 32 bits
0x1008 : [DonnÃ©es...         ]   â† AlignÃ©
```

### Zero-copy et offload matÃ©riel

Les cartes rÃ©seau modernes peuvent calculer le checksum UDP en matÃ©riel (UDP checksum offload), Ã©conomisant du CPU.

```python
# Activer l'offload (Linux)
import fcntl
import struct

# SOCK_DGRAM = UDP
sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

# Demander Ã  la carte rÃ©seau de calculer le checksum
# (nÃ©cessite support matÃ©riel)
sock.setsockopt(socket.SOL_SOCKET, socket.SO_NO_CHECK, 1)
```

## RÃ©sumÃ© visuel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             EN-TÃŠTE UDP : 8 OCTETS                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Champ       â”‚ Description                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Port source â”‚ â€¢ 16 bits (0-65535)                          â”‚
â”‚ (0-1)       â”‚ â€¢ Application Ã©mettrice                      â”‚
â”‚             â”‚ â€¢ Peut Ãªtre 0 si pas de rÃ©ponse attendue     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Port dest   â”‚ â€¢ 16 bits (0-65535)                          â”‚
â”‚ (2-3)       â”‚ â€¢ Application rÃ©ceptrice                     â”‚
â”‚             â”‚ â€¢ Obligatoire                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Longueur    â”‚ â€¢ 16 bits (8-65535)                          â”‚
â”‚ (4-5)       â”‚ â€¢ Taille totale (en-tÃªte + donnÃ©es)          â”‚
â”‚             â”‚ â€¢ Minimum 8 octets                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Checksum    â”‚ â€¢ 16 bits                                    â”‚
â”‚ (6-7)       â”‚ â€¢ Optionnel en IPv4 (peut Ãªtre 0x0000)       â”‚
â”‚             â”‚ â€¢ Obligatoire en IPv6                        â”‚
â”‚             â”‚ â€¢ Couvre pseudo-en-tÃªte + UDP + donnÃ©es      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         SUIVI DE

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DONNÃ‰ES (0-65527 octets)                â”‚
â”‚                                                            â”‚
â”‚  Payload de l'application                                  â”‚
â”‚  (requÃªte DNS, donnÃ©es de jeu, audio/vidÃ©o, etc.)          â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Conclusion

Le format du datagramme UDP illustre parfaitement la philosophie du protocole : **simplicitÃ© maximale**.

**Points clÃ©s** :
- **8 octets d'en-tÃªte seulement** : Le plus compact des protocoles de transport
- **4 champs essentiels** : Ports (multiplexage), longueur, checksum (intÃ©gritÃ©)
- **Checksum optionnel** en IPv4, obligatoire en IPv6
- **Pseudo-en-tÃªte** : Emprunte des informations Ã  IP pour vÃ©rifier l'intÃ©gritÃ©
- **Pas de numÃ©rotation** : Contrairement Ã  TCP, pas de mÃ©canisme de sÃ©quenÃ§age
- **Pas de drapeaux** : Pas d'Ã©tat de connexion Ã  gÃ©rer

Cette simplicitÃ© fait la force d'UDP :
- Overhead minimal (2.5Ã— plus petit que TCP)
- Traitement rapide (moins de champs Ã  gÃ©rer)
- FlexibilitÃ© (l'application contrÃ´le tout)

Dans la section suivante, nous explorerons les avantages et limitations d'UDP de maniÃ¨re systÃ©matique, et fournirons des critÃ¨res de dÃ©cision clairs pour choisir entre UDP et TCP selon les besoins applicatifs.

---

**Ã€ retenir** :

- âœ… **En-tÃªte UDP** : 8 octets (4 champs de 16 bits chacun)
- âœ… **Port source** : 0-65535, peut Ãªtre 0 si pas de rÃ©ponse attendue
- âœ… **Port destination** : 0-65535, identifie l'application rÃ©ceptrice
- âœ… **Longueur** : Taille totale (en-tÃªte + donnÃ©es), minimum 8 octets
- âœ… **Checksum** : Optionnel IPv4, obligatoire IPv6, couvre pseudo-en-tÃªte
- âœ… **Pseudo-en-tÃªte** : Emprunte IP source/dest pour calcul checksum
- âœ… **DonnÃ©es max thÃ©oriques** : 65527 octets (65535 - 8)
- âœ… **DonnÃ©es max pratiques** : 1472 octets (Ã©viter fragmentation)
- âœ… **ComparÃ© Ã  TCP** : 2.5Ã— plus compact (8 vs 20 octets minimum)

â­ï¸ [Avantages et limitations](/04-couche-transport/04.3-udp-avantages-limitations.md)
