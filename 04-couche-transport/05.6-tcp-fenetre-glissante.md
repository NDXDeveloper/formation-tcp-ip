ğŸ” Retour au [Sommaire](/SOMMAIRE.md)

# 4.5.6 FenÃªtre glissante (sliding window)

## Introduction

La **fenÃªtre glissante** (sliding window) est le mÃ©canisme qui permet Ã  TCP d'atteindre des performances Ã©levÃ©es tout en garantissant la fiabilitÃ©. Sans ce mÃ©canisme, TCP serait extrÃªmement lent, limitÃ© par le dÃ©lai aller-retour (RTT) pour chaque segment envoyÃ©.

Le principe est simple mais puissant : **permettre l'envoi de plusieurs segments avant d'attendre les acquittements**, tout en maintenant un contrÃ´le sur la quantitÃ© de donnÃ©es en transit.

```
Sans fenÃªtre glissante :      Avec fenÃªtre glissante :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Envoi 1 â†’ Attente ACK         Envoi 1 2 3 4 5 â†’
Envoi 2 â†’ Attente ACK         Attente ACK groupÃ©s
Envoi 3 â†’ Attente ACK         â† ACK 1 2 3 4 5
...                           Envoi 6 7 8 9 10 â†’

DÃ©bit : 1 segment/RTT         DÃ©bit : N segments/RTT
        LENT âŒ                      RAPIDE âœ“
```

## Le problÃ¨me : Stop-and-Wait

### Principe du Stop-and-Wait

L'approche naÃ¯ve consiste Ã  envoyer un segment et attendre son acquittement avant d'envoyer le suivant.

```
Ã‰metteur                                RÃ©cepteur
   â”‚                                        â”‚
T=0â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ Segment 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                        â”‚
   â”‚ Attente...                             â”‚
   â”‚                                        â”‚
T=50ms                                      â”‚
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                                        â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ Segment 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                        â”‚
   â”‚ Attente...                             â”‚
   â”‚                                        â”‚
T=100ms                                     â”‚
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
```

**RÃ©sultat catastrophique** :

```
DonnÃ©es Ã  transmettre : 1 Mo
Taille des segments : 1460 octets (1 Ko environ)
Nombre de segments : 1000

RTT : 50 ms

Temps total avec Stop-and-Wait :
= 1000 segments Ã— 50 ms
= 50 000 ms
= 50 secondes pour 1 Mo ! ğŸ’€

DÃ©bit effectif :
= 1 Mo / 50s
= 20 Ko/s
= 160 Kbps

Sur une liaison 1 Gbps !
Utilisation : 0.016% ğŸ˜±
```

### Analyse du problÃ¨me

Le goulot d'Ã©tranglement n'est pas la bande passante mais le **RTT**.

```
Bande passante disponible : 1 Gbps
Bande passante utilisÃ©e : 160 Kbps
Gaspillage : 99.984%

Cause : Le canal reste VIDE pendant le RTT
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Segment en transit (temps de prop.)    â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                   â”‚
â”‚                                         â”‚
â”‚  Canal vide (attente ACK)               â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       Gaspillage de capacitÃ© ! âŒ
```

## La solution : FenÃªtre glissante

### Principe fondamental

**Permettre plusieurs segments "en vol" simultanÃ©ment** sans attendre l'acquittement de chacun.

```
FenÃªtre = 4 segments

Ã‰metteur                                RÃ©cepteur
   â”‚                                        â”‚
T=0â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ Seg 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ Seg 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ Seg 3 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ Seg 4 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                        â”‚
   â”‚ Canal saturÃ© ! âœ“                       â”‚
   â”‚                                        â”‚
T=50ms                                      â”‚
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK 1-4 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚                                        â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ Seg 5 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ Seg 6 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ Seg 7 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€ Seg 8 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚

DÃ©bit : 4 segments / RTT
       4Ã— plus rapide ! âœ“
```

### Calcul du gain de performance

```
Avec fenÃªtre de taille W :

DonnÃ©es : 1 Mo
Segments : 1000 (de 1 Ko chacun)
RTT : 50 ms
FenÃªtre : W = 20 segments

Temps total :
= (1000 segments / 20) Ã— RTT
= 50 cycles Ã— 50 ms
= 2500 ms
= 2.5 secondes pour 1 Mo

DÃ©bit effectif :
= 1 Mo / 2.5s
= 400 Ko/s
= 3.2 Mbps

Gain : 20Ã— plus rapide qu'en Stop-and-Wait âœ“
```

## Structure de la fenÃªtre glissante

### Les quatre catÃ©gories d'octets

Ã€ tout moment, la fenÃªtre d'envoi divise l'espace des numÃ©ros de sÃ©quence en quatre catÃ©gories :

```
NumÃ©ros de sÃ©quence :
0    1000   2000   3000   4000   5000   6000   7000
â”‚â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€>
     â”‚      â”‚             â”‚             â”‚
     â”‚      â”‚             â”‚             â”‚
     â–¼      â–¼             â–¼             â–¼
   [â”€1â”€][â”€â”€2â”€â”€][â”€â”€â”€â”€3â”€â”€â”€â”€][â”€â”€â”€â”€â”€4â”€â”€â”€â”€â”€]

1. EnvoyÃ©s et acquittÃ©s (0-1999)
   âœ“ Transmission rÃ©ussie
   âœ“ LibÃ©rÃ©s du buffer

2. EnvoyÃ©s mais non acquittÃ©s (2000-2999)
   â³ En attente d'ACK
   âš ï¸ Peuvent nÃ©cessiter retransmission

3. PrÃªts Ã  envoyer (3000-3999)
   ğŸ“¤ Dans la fenÃªtre
   âœ“ Autorisation d'envoi

4. Pas encore autorisÃ©s (4000+)
   ğŸš« Hors de la fenÃªtre
   âŒ Doivent attendre
```

### ReprÃ©sentation visuelle dÃ©taillÃ©e

```
Buffer d'envoi :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ][â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ][â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘][        ][        ]     â”‚
â”‚  CatÃ©g.1   CatÃ©g.2   CatÃ©g.3   CatÃ©g.4                 â”‚
â”‚  ACK âœ“     En vol    AutorisÃ©  BloquÃ©                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â”‚â—„â”€â”€â”€â”€ FenÃªtre â”€â”€â”€â”€â”€â”€â–ºâ”‚
         â”‚                     â”‚
    SND.UNA              SND.UNA + SND.WND

Variables TCP importantes :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SND.UNA (Unacknowledged) : Premier octet non acquittÃ©
SND.NXT (Next)           : Prochain octet Ã  envoyer
SND.WND (Window)         : Taille de la fenÃªtre

Relation :
â”€â”€â”€â”€â”€â”€â”€â”€â”€
Octets envoyables = SND.UNA + SND.WND - SND.NXT
```

### Exemple concret avec nombres

```
Ã‰tat initial :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SND.UNA = 1000  (dernier octet acquittÃ© = 999)
SND.NXT = 1500  (octets 1000-1499 dÃ©jÃ  envoyÃ©s)
SND.WND = 2000  (fenÃªtre de 2000 octets)

Limite de fenÃªtre : 1000 + 2000 = 3000

Visualisation :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [AcquittÃ©s]  [En vol]    [AutorisÃ©s]    [BloquÃ©s]      â”‚
â”‚   0-999    â”‚ 1000-1499 â”‚ 1500-2999  â”‚ 3000+             â”‚
â”‚     âœ“      â”‚    â³     â”‚    ğŸ“¤      â”‚    ğŸš«            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–²           â–²            â–²
          SND.UNA     SND.NXT    SND.UNA+SND.WND
           1000        1500         3000

Peut envoyer : 3000 - 1500 = 1500 octets
```

## DÃ©placement de la fenÃªtre (sliding)

### Glissement vers la droite

Quand un acquittement arrive, la fenÃªtre **glisse vers la droite** (d'oÃ¹ le nom "sliding window").

```
Ã‰tat initial :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [âœ“âœ“âœ“âœ“][â³â³][â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘][                ]             â”‚
â”‚  0-999  1000 1500  2999  3000+                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–²           â–²            â–²
      SND.UNA    SND.NXT    SND.UNA+WND
       1000       1500         3000


ACK=2000 reÃ§u (octets 1000-1999 acquittÃ©s) :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [âœ“âœ“âœ“âœ“âœ“âœ“âœ“âœ“][â³][â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘][            ]           â”‚
â”‚  0-1999   2000 2500    3999     4000+                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â–²           â–²            â–²
             SND.UNA    SND.NXT    SND.UNA+WND
              2000       2500         4000

La fenÃªtre a glissÃ© de 1000 octets vers la droite ! â†’
Peut maintenant envoyer 1500 octets supplÃ©mentaires
```

### Animation du glissement

```
SÃ©quence d'Ã©vÃ©nements :

T=0 : FenÃªtre initiale
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â³â³â³][â–‘â–‘â–‘â–‘â–‘â–‘][      ]
â”‚ 1000   2000  3000  4000        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T=1 : Envoi de 1000 octets supplÃ©mentaires
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â³â³â³â³â³â³][      ]
â”‚ 1000      3000  4000           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T=2 : ACK=2500 reÃ§u
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“âœ“âœ“][â³â³â³][â–‘â–‘â–‘â–‘â–‘â–‘][    ]      FenÃªtre glisse â†’
â”‚      2500 3000   4500 5500     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T=3 : Envoi de nouveaux segments
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“âœ“âœ“][â³â³â³â³â³â³][    ]      â”‚
â”‚      2500      4500 5500       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

T=4 : ACK=4000 reÃ§u
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“âœ“âœ“âœ“âœ“âœ“][â³â³][â–‘â–‘â–‘â–‘][    ]     â”‚  FenÃªtre glisse â†’
â”‚          4000 4500  6000 7000  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Taille de la fenÃªtre

### DÃ©termination de la taille

La taille effective de la fenÃªtre est le **minimum** de deux valeurs :

```
FenÃªtre effective = min(rwnd, cwnd)

rwnd (Receive Window) :
â””â”€ AnnoncÃ©e par le rÃ©cepteur
   â””â”€ BasÃ©e sur son buffer disponible
      â””â”€ ContrÃ´le de flux

cwnd (Congestion Window) :
â””â”€ CalculÃ©e par l'Ã©metteur
   â””â”€ BasÃ©e sur l'Ã©tat du rÃ©seau
      â””â”€ ContrÃ´le de congestion
```

### Exemple de calcul

```
Situation 1 : RÃ©cepteur limitant
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
rwnd = 32768 octets (32 Ko, buffer petit)
cwnd = 262144 octets (256 Ko, rÃ©seau OK)

FenÃªtre = min(32768, 262144) = 32768 octets
â†’ LimitÃ© par le rÃ©cepteur

Peut envoyer : 32 Ko sans attendre ACK
Avec MSS=1460 : environ 22 segments


Situation 2 : RÃ©seau limitant
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
rwnd = 262144 octets (256 Ko, buffer grand)
cwnd = 8760 octets (congestion dÃ©tectÃ©e)

FenÃªtre = min(262144, 8760) = 8760 octets
â†’ LimitÃ© par le rÃ©seau

Peut envoyer : ~8.5 Ko sans attendre ACK
Avec MSS=1460 : environ 6 segments


Situation 3 : Ã‰quilibrÃ©
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
rwnd = 65536 octets (64 Ko)
cwnd = 65536 octets (64 Ko)

FenÃªtre = min(65536, 65536) = 65536 octets
â†’ Ã‰quilibre parfait âœ“

Utilisation optimale des deux cÃ´tÃ©s
```

### Relation avec le Bandwidth-Delay Product

```
BDP (Bandwidth-Delay Product) :
= Bande passante Ã— RTT

Exemple :
â”€â”€â”€â”€â”€â”€â”€â”€â”€
Liaison : 100 Mbps
RTT : 50 ms

BDP = 100 Mbps Ã— 0.05s
    = 5 Mb
    = 625 Ko

Pour saturer la liaison, la fenÃªtre doit Ãªtre :
FenÃªtre â‰¥ BDP = 625 Ko

Si fenÃªtre = 64 Ko seulement :
Utilisation = 64 Ko / 625 Ko = 10.2%
DÃ©bit max = 100 Mbps Ã— 10.2% = 10.2 Mbps

Goulot : FenÃªtre trop petite ! âš ï¸
```

## Exemple complet de transmission

### ScÃ©nario : Transfert avec fenÃªtre de 4 segments

```
Configuration :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MSS = 100 octets (simplifiÃ©)
FenÃªtre = 400 octets (4 segments)
RTT = 100 ms
ISN = 1000


Chronologie dÃ©taillÃ©e :
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

T=0ms : Ã‰tat initial
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SND.UNA = 1000
SND.NXT = 1000
SND.WND = 400

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘][        ]
â”‚ 1000        1400 1400+         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Peut envoyer : 400 octets (4 segments)


T=0ms : Envoi initial (rafale)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Ã‰metteur                        RÃ©cepteur
   â”‚                                â”‚
   â”‚ â‘  SEQ=1000, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ â‘¡ SEQ=1100, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ â‘¢ SEQ=1200, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ â‘£ SEQ=1300, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                â”‚

SND.NXT = 1400 (fenÃªtre pleine)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â³â³â³â³â³â³â³â³][        ]
â”‚ 1000            1400 1400+     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

En vol : 400 octets
Peut envoyer : 0 octets (fenÃªtre pleine)


T=50ms : Premier ACK arrive
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK=1200 â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
   â”‚                                â”‚

Octets 1000-1199 acquittÃ©s (200 octets)

SND.UNA = 1200 (glissement de 200)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“âœ“âœ“âœ“][â³â³][â–‘â–‘â–‘â–‘][        ]
â”‚       1200 1400  1600  1600+   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

En vol : 200 octets (segments â‘¢ et â‘£)
Peut envoyer : 200 octets (fenÃªtre s'est ouverte)


T=51ms : Envoi de nouveaux segments
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚ â‘¤ SEQ=1400, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚ â‘¥ SEQ=1500, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                â”‚

SND.NXT = 1600 (fenÃªtre Ã  nouveau pleine)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“âœ“âœ“âœ“][â³â³â³â³â³â³][        ]
â”‚       1200      1600  1600+    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

En vol : 400 octets
Peut envoyer : 0 octets


T=100ms : DeuxiÃ¨me ACK arrive
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK=1600 â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
   â”‚                                â”‚

Octets 1200-1599 acquittÃ©s (400 octets)

SND.UNA = 1600 (glissement de 400)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“âœ“âœ“âœ“âœ“âœ“âœ“âœ“][â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘][        ]
â”‚             1600    2000 2000+  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

En vol : 0 octets
Peut envoyer : 400 octets

Et le cycle continue...
```

### Analyse de performance

```
Sans fenÃªtre glissante (Stop-and-Wait) :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T=0    : Envoi segment 1
T=100  : ACK 1, envoi segment 2
T=200  : ACK 2, envoi segment 3
T=300  : ACK 3, envoi segment 4

Temps pour 400 octets : 400ms
DÃ©bit : 400 octets / 0.4s = 1000 octets/s


Avec fenÃªtre glissante (W=4) :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T=0    : Envoi segments 1-4 (rafale)
T=100  : Tous acquittÃ©s, envoi 5-8

Temps pour 400 octets : 100ms
DÃ©bit : 400 octets / 0.1s = 4000 octets/s

Gain : 4Ã— plus rapide ! âœ“
```

## FenÃªtre nulle (Zero Window)

### ProblÃ¨me : Buffer du rÃ©cepteur plein

Quand le rÃ©cepteur ne peut plus accepter de donnÃ©es, il annonce une fenÃªtre de taille **zÃ©ro**.

```
RÃ©cepteur                       Ã‰metteur
   â”‚                                â”‚
   â”‚ Buffer plein (100%)            â”‚
   â”‚ Pas d'espace libre             â”‚
   â”‚                                â”‚
   â”‚ â”€â”€â”€â”€ ACK=5000, WIN=0 â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                â”‚
   â”‚                                â”‚ ğŸ›‘ STOP !
   â”‚                                â”‚ FenÃªtre = 0
   â”‚                                â”‚ Ne peut rien envoyer
```

### Zero Window Probe

L'Ã©metteur envoie pÃ©riodiquement des **sondes** (1 octet) pour vÃ©rifier si la fenÃªtre s'est rouverte.

```
T=0 : FenÃªtre nulle annoncÃ©e
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RÃ©cepteur                       Ã‰metteur
   â”‚ ACK=5000, WIN=0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                â”‚ DÃ©marre timer ZWP

T=5s : Zero Window Probe
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚                                â”‚
   â”‚ <â”€â”€â”€â”€ SEQ=5000, 1 octet â”€â”€â”€â”€â”€â”€â”€â”‚ Sonde
   â”‚                                â”‚
   â”‚ Buffer toujours plein          â”‚
   â”‚ ACK=5000, WIN=0 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                â”‚ Prochain probe dans 10s

T=15s : Zero Window Probe
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚ <â”€â”€â”€â”€ SEQ=5000, 1 octet â”€â”€â”€â”€â”€â”€â”€â”‚ Sonde
   â”‚                                â”‚
   â”‚ Application a lu des donnÃ©es ! â”‚
   â”‚ Buffer : 32 Ko libre           â”‚
   â”‚ ACK=5000, WIN=32768 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚ âœ“ FenÃªtre rouverte
   â”‚                                â”‚
   â”‚ <â”€â”€â”€â”€ DonnÃ©es normales â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Reprise

Intervalle ZWP :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1er probe : 5s
2e probe  : 10s
3e probe  : 20s
...
Max       : 60s
```

### Silly Window Syndrome

ProblÃ¨me d'efficacitÃ© quand la fenÃªtre devient trÃ¨s petite.

```
ScÃ©nario problÃ©matique :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
RÃ©cepteur annonce WIN=50 octets seulement

Ã‰metteur envoie :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IP header  : 20 octets         â”‚
â”‚ TCP header : 20 octets         â”‚
â”‚ DonnÃ©es    : 50 octets         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Total : 90 octets sur le rÃ©seau

Overhead : 40/90 = 44% ! ğŸ’€
TrÃ¨s inefficace


Solution : Clark's Algorithm
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Le rÃ©cepteur n'annonce WIN > 0 que si :
- WIN â‰¥ min(MSS, 50% du buffer)

Exemple :
Buffer = 64 Ko, MSS = 1460
Seuil = min(1460, 32768) = 1460

Attendre d'avoir au moins 1460 octets libres
avant d'annoncer WIN > 0
```

### Nagle's Algorithm

L'Ã©metteur groupe les petites Ã©critures pour Ã©viter d'envoyer de nombreux petits segments.

```
Sans Nagle :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Application Ã©crit 1 octet â†’ Segment de 41 octets
Application Ã©crit 1 octet â†’ Segment de 41 octets
Application Ã©crit 1 octet â†’ Segment de 41 octets
...
Inefficace ! 40 octets d'overhead par octet utile


Avec Nagle :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Application Ã©crit 1 octet â†’ StockÃ©
Application Ã©crit 1 octet â†’ StockÃ©
Application Ã©crit 1 octet â†’ StockÃ©
...
100 octets accumulÃ©s â†’ Segment de 140 octets

Ou ACK reÃ§u â†’ Envoie ce qui est accumulÃ©

RÃ¨gle Nagle :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Envoyer immÃ©diatement SI :
- Segment plein (â‰¥ MSS)
- Ou pas de donnÃ©es en vol (tous les ACK reÃ§us)

Sinon : Accumuler jusqu'Ã  remplir MSS ou recevoir ACK
```

**DÃ©sactiver Nagle** (pour applications temps rÃ©el) :

```c
// Code C
int flag = 1;
setsockopt(sock, IPPROTO_TCP, TCP_NODELAY, &flag, sizeof(int));

// Utile pour : SSH, jeux en ligne, trading haute frÃ©quence
// OÃ¹ la latence prime sur l'efficacitÃ©
```

## FenÃªtre et retransmissions

### Impact des pertes sur la fenÃªtre

```
Transmission avec perte :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

T=0 : Envoi de 4 segments (fenÃªtre = 400)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Ã‰metteur                        RÃ©cepteur
   â”‚                                 â”‚
   â”‚ â‘  SEQ=1000, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚ âœ“
   â”‚ â‘¡ SEQ=1100, 100 octets â”€â”€â”€X    â”‚ âŒ Perdu
   â”‚ â‘¢ SEQ=1200, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚ âœ“ (en attente)
   â”‚ â‘£ SEQ=1300, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚ âœ“ (en attente)
   â”‚                                 â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [â³â³â³â³â³â³â³â³][        ]
â”‚ 1000            1400 1400+     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


T=50ms : ACK reÃ§u
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK=1100 â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ (pour â‘ )
   â”‚                                â”‚

SND.UNA = 1100 (glisse de 100)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“][â³â³â³â³â³â³][â–‘â–‘][        ]
â”‚   1100      1400  1500 1500+   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Peut envoyer 100 octets supplÃ©mentaires


T=51ms : Envoi segment 5
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚ â‘¤ SEQ=1400, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚
   â”‚                                â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“][â³â³â³â³â³â³â³â³][        ]
â”‚   1100          1500  1500+    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


T=100ms : ACK dupliquÃ©s
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK=1100 â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ (dup 1)
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK=1100 â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ (dup 2)
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK=1100 â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ (dup 3)
   â”‚                                â”‚
   â”‚ âš ï¸ 3 dup ACK â†’ Perte dÃ©tectÃ©e  â”‚
   â”‚                                â”‚

La fenÃªtre NE GLISSE PAS (bloquÃ©e Ã  1100)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“][â³â³â³â³â³â³â³â³][        ]
â”‚   1100          1500  1500+    â”‚  â† BloquÃ© ici
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tous les segments suivants sont en attente !


T=101ms : Fast Retransmit
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚ â‘¡ SEQ=1100, 100 octets â”€â”€â”€â”€â”€â”€â”€>â”‚ Retransmis
   â”‚                                 â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“][â³â³â³â³â³â³â³â³][        ]
â”‚   1100          1500  1500+    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


T=150ms : ACK global
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ACK=1500 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Tout reÃ§u !
   â”‚                               â”‚

SND.UNA = 1500 (glisse enfin de 400)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [âœ“âœ“âœ“âœ“âœ“âœ“âœ“âœ“âœ“âœ“][â–‘â–‘â–‘â–‘][        ]
â”‚             1500  1900 1900+   â”‚  DÃ©blocage ! âœ“
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

La fenÃªtre peut Ã  nouveau glisser normalement
```

## Optimisations et tuning

### Calcul de la fenÃªtre optimale

```
Pour saturer une liaison :

FenÃªtre optimale = Bande passante Ã— RTT

Exemples :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Liaison LAN (1 Gbps, RTT 1ms) :
   FenÃªtre = 1 Gbps Ã— 0.001s = 1 Mb = 125 Ko

2. Liaison WAN (100 Mbps, RTT 50ms) :
   FenÃªtre = 100 Mbps Ã— 0.05s = 5 Mb = 625 Ko

3. Liaison satellite (10 Mbps, RTT 600ms) :
   FenÃªtre = 10 Mbps Ã— 0.6s = 6 Mb = 750 Ko

Plus le RTT est Ã©levÃ©, plus la fenÃªtre doit Ãªtre grande !
```

### Window Scale Option

Pour des fenÃªtres > 64 Ko, l'option **Window Scale** est nÃ©cessaire.

```
ProblÃ¨me :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Champ Window dans TCP : 16 bits
Maximum : 65535 octets = 64 Ko
Insuffisant pour liaisons haute performance !

Solution : Window Scale
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Multiplie la fenÃªtre par 2^scale

NÃ©gociation dans SYN :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Option : Window Scale = 7  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

FenÃªtre effective :
Window field Ã— 2^7
65535 Ã— 128 = 8 388 480 octets â‰ˆ 8 Mo âœ“

Valeurs :
â”€â”€â”€â”€â”€â”€â”€â”€â”€
Scale = 0  : Pas de multiplication (Ã—1)
Scale = 7  : Ã—128
Scale = 14 : Ã—16384 (max pratique)

FenÃªtre max avec scale=14 :
65535 Ã— 16384 = 1 073 725 440 octets â‰ˆ 1 Go !
```

### Configuration Linux

```bash
# Voir la configuration actuelle
sysctl net.ipv4.tcp_window_scaling
net.ipv4.tcp_window_scaling = 1  # ActivÃ©

# Taille des buffers TCP
sysctl net.ipv4.tcp_rmem
net.ipv4.tcp_rmem = 4096 131072 6291456
#                   min  default  max
#                   (octets)

sysctl net.ipv4.tcp_wmem
net.ipv4.tcp_wmem = 4096 16384 4194304
#                   min  default  max

# Explication :
# min     : Taille minimale (4 Ko)
# default : Taille initiale (16-128 Ko)
# max     : Taille maximale (4-6 Mo)

# Auto-tuning (ajustement automatique)
sysctl net.ipv4.tcp_moderate_rcvbuf
net.ipv4.tcp_moderate_rcvbuf = 1  # ActivÃ©

# Le kernel ajuste automatiquement la fenÃªtre
# selon les conditions du rÃ©seau
```

### Tuning pour haute performance

```bash
# Configuration optimisÃ©e pour 10 Gbps, RTT 50ms
# BDP = 10 Gbps Ã— 0.05s = 500 Mb = 62.5 Mo

# Augmenter les buffers max
sysctl -w net.ipv4.tcp_rmem="4096 87380 67108864"  # 64 Mo
sysctl -w net.ipv4.tcp_wmem="4096 65536 67108864"  # 64 Mo

# Augmenter les buffers rÃ©seau gÃ©nÃ©raux
sysctl -w net.core.rmem_max=67108864  # 64 Mo
sysctl -w net.core.wmem_max=67108864  # 64 Mo
sysctl -w net.core.rmem_default=31457280  # 30 Mo
sysctl -w net.core.wmem_default=31457280  # 30 Mo

# Activer Window Scaling
sysctl -w net.ipv4.tcp_window_scaling=1

# Activer SACK
sysctl -w net.ipv4.tcp_sack=1

# Activer timestamps (pour PAWS)
sysctl -w net.ipv4.tcp_timestamps=1
```

## Analyse avec Wireshark

### Visualisation de la fenÃªtre

```
Capture Wireshark :
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Frame 100: Client â†’ Serveur [PSH, ACK]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TCP Analysis:
    Sequence number: 1000 (relative)
    Next sequence number: 2460
    Acknowledgment number: 5000
    Window size value: 65535
    Calculated window size: 8388480  â† Avec scale=7
    Bytes in flight: 1460
    Bytes sent since last PSH: 1460

[SEQ/ACK analysis]
    This is a data segment
    [Bytes in flight: 1460]
    [Bytes remaining in window: 8387020]


Frame 101: Client â†’ Serveur [PSH, ACK]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TCP Analysis:
    Sequence number: 2460
    Next sequence number: 3920
    Window size value: 65535
    [Bytes in flight: 2920]  â† Cumul
    [Bytes remaining in window: 8385560]


Frame 102: Serveur â†’ Client [ACK]
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
TCP Analysis:
    Acknowledgment number: 3920
    Window size value: 65535
    [Bytes in flight: 0]  â† FenÃªtre libÃ©rÃ©e
```

### Graphique I/O de Wireshark

```
Statistics â†’ TCP Stream Graphs â†’ Time-Sequence (Stevens)

Visualisation :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SEQ Number
    â”‚
    â”‚    â•±â•±â•±â•±  â† Pente = dÃ©bit
    â”‚   â•±â•±â•±
    â”‚  â•±â•±
    â”‚ â•±        Paliers = attente ACK
    â”‚â•±         Pente raide = bon dÃ©bit
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Temps

FenÃªtre visible :
- Distance verticale entre donnÃ©es envoyÃ©es et ACK
- Si distance constante = fenÃªtre saturÃ©e
- Si distance varie = fenÃªtre s'adapte
```

### DÃ©tection de problÃ¨mes

```
SymptÃ´mes dans Wireshark :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Window Full
   [TCP Window Full]
   â†’ FenÃªtre saturÃ©e, attente ACK
   â†’ Normal si temporaire
   â†’ ProblÃ¨me si frÃ©quent

2. Zero Window
   [TCP Zero Window]
   â†’ RÃ©cepteur saturÃ©
   â†’ VÃ©rifier performances application

3. Zero Window Probe
   [TCP Zero Window Probe]
   â†’ Ã‰metteur teste si fenÃªtre rouverte
   â†’ Normal aprÃ¨s Zero Window

4. Window Update
   [TCP Window Update]
   â†’ RÃ©cepteur annonce nouvelle fenÃªtre
   â†’ LibÃ©ration d'espace buffer
```

## Cas d'Ã©tude : TÃ©lÃ©chargement HTTP

### ScÃ©nario rÃ©el

```
TÃ©lÃ©chargement d'un fichier de 10 Mo
Liaison : 100 Mbps
RTT : 50 ms

Calcul thÃ©orique :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
BDP = 100 Mbps Ã— 0.05s = 500 Ko
FenÃªtre optimale : ~500 Ko

Configuration rÃ©elle :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Client : Window = 524280 (512 Ko avec scale)
Serveur : Window = 524280

DÃ©roulement :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
T=0 : Handshake (50 ms)

T=50ms : Client envoie GET
         FenÃªtre serveur = 512 Ko

T=100ms : Serveur commence envoi
          Envoi rafale de 350 segments (512 Ko)
          Temps d'envoi : ~40 ms Ã  100 Mbps

T=140ms : FenÃªtre pleine
          Attente ACK

T=190ms : ACK reÃ§u pour ~256 Ko
          FenÃªtre se rouvre Ã  256 Ko
          Envoi de 175 nouveaux segments

T=230ms : FenÃªtre pleine
          Attente ACK

[Cycle continue...]

T=850ms : Dernier octet acquittÃ©
          10 Mo transfÃ©rÃ©s en 800 ms

DÃ©bit effectif :
= 10 Mo / 0.8s
= 12.5 Mo/s
= 100 Mbps âœ“

Utilisation : 100% de la bande passante
GrÃ¢ce Ã  la fenÃªtre glissante ! âœ“
```

## ProblÃ¨mes courants et solutions

### ProblÃ¨me 1 : FenÃªtre trop petite

```
SymptÃ´me :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
DÃ©bit limitÃ© malgrÃ© bonne liaison

Diagnostic :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ss -tin
# tcp ESTAB
#     ...
#     send 10.5Mbps rcv_space:29200 rcv_ssthresh:29200
#
# rcv_space faible = fenÃªtre limitÃ©e

Solution :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Augmenter les buffers
sysctl -w net.ipv4.tcp_rmem="4096 87380 16777216"
```

### ProblÃ¨me 2 : Silly Window Syndrome

```
SymptÃ´me :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Beaucoup de petits segments (< 100 octets)

Diagnostic :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Wireshark : Filter "tcp.len < 100"
â†’ Nombreux segments

Solution :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Activer Nagle (par dÃ©faut)
2. Ajuster tcp_notsent_lowat :
   sysctl -w net.ipv4.tcp_notsent_lowat=16384
```

### ProblÃ¨me 3 : Bufferbloat

```
SymptÃ´me :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Latence Ã©levÃ©e, fenÃªtre grande

Diagnostic :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ping pendant transfert :
RTT passe de 50ms Ã  500ms ! ğŸ’€

Cause :
â”€â”€â”€â”€â”€â”€â”€
Buffers trop grands dans les routeurs
Les paquets s'accumulent

Solution :
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. RÃ©duire les buffers TCP (contre-intuitif)
2. Activer ECN :
   sysctl -w net.ipv4.tcp_ecn=1
3. Utiliser BBR congestion control
```

## RÃ©sumÃ© des mÃ©canismes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FENÃŠTRE GLISSANTE TCP                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  Fonction : Permettre envoi multiple sans attendre ACK  â”‚
â”‚                                                         â”‚
â”‚  Taille : min(rwnd, cwnd)                               â”‚
â”‚                                                         â”‚
â”‚  CatÃ©gories d'octets :                                  â”‚
â”‚    1. EnvoyÃ©s et acquittÃ©s (libÃ©rÃ©s)                    â”‚
â”‚    2. EnvoyÃ©s non acquittÃ©s (en vol)                    â”‚
â”‚    3. PrÃªts Ã  envoyer (autorisÃ©s)                       â”‚
â”‚    4. Pas encore autorisÃ©s (bloquÃ©s)                    â”‚
â”‚                                                         â”‚
â”‚  Glissement : Quand ACK reÃ§u, fenÃªtre glisse â†’          â”‚
â”‚                                                         â”‚
â”‚  ProblÃ¨mes spÃ©ciaux :                                   â”‚
â”‚    â€¢ Zero Window : Buffer rÃ©cepteur plein               â”‚
â”‚    â€¢ Window Full : FenÃªtre saturÃ©e                      â”‚
â”‚    â€¢ Silly Window : FenÃªtre trop petite                 â”‚
â”‚                                                         â”‚
â”‚  Optimisations :                                        â”‚
â”‚    â€¢ Window Scale (>64 Ko)                              â”‚
â”‚    â€¢ Nagle's Algorithm (grouper petits segments)        â”‚
â”‚    â€¢ Delayed ACK (rÃ©duire trafic ACK)                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Conclusion

La fenÃªtre glissante est le mÃ©canisme qui transforme TCP d'un protocole lent en un protocole performant capable de saturer des liaisons Ã  trÃ¨s haut dÃ©bit.

**Points clÃ©s Ã  retenir** :

1. **Sans fenÃªtre** : 1 segment/RTT â†’ ExtrÃªmement lent
2. **Avec fenÃªtre** : N segments/RTT â†’ Performance optimale
3. **Taille optimale** : Bande passante Ã— RTT (BDP)
4. **Deux limites** : rwnd (rÃ©cepteur) et cwnd (rÃ©seau)
5. **Glissement** : La fenÃªtre avance quand ACK reÃ§us
6. **Zero Window** : MÃ©canisme de protection du rÃ©cepteur
7. **Window Scale** : NÃ©cessaire pour > 64 Ko

**Impact pratique** :

```
Performance thÃ©orique maximale :
= FenÃªtre / RTT

Exemple : Window=524280, RTT=50ms
= 524280 / 0.05
= 10 485 600 octets/s
â‰ˆ 84 Mbps

Pour 1 Gbps avec RTT=50ms :
FenÃªtre requise = 6.25 Mo !
```

La maÃ®trise de la fenÃªtre glissante est essentielle pour :
- ğŸ“Š Comprendre les performances TCP
- âš¡ Optimiser les transferts
- ğŸ”§ Diagnostiquer les goulots d'Ã©tranglement
- ğŸ—ï¸ Dimensionner correctement les systÃ¨mes

Dans la prochaine section, nous explorerons le **contrÃ´le de flux**, qui dÃ©termine comment la fenÃªtre de rÃ©ception (rwnd) est ajustÃ©e dynamiquement pour protÃ©ger le rÃ©cepteur.

---

**Prochaine section** : 4.5.7 ContrÃ´le de flux

â­ï¸ [ContrÃ´le de flux](/04-couche-transport/05.7-tcp-controle-flux.md)
