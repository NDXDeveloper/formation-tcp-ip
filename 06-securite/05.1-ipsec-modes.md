ğŸ” Retour au [Sommaire](/SOMMAIRE.md)

# 6.5.1 Modes transport et tunnel

## Introduction

IPsec propose **deux modes d'opÃ©ration** fondamentalement diffÃ©rents qui dÃ©terminent comment les paquets IP sont protÃ©gÃ©s et encapsulÃ©s. Le choix du mode a des implications majeures sur :

- La structure des paquets
- Les performances (overhead)
- Les cas d'usage possibles
- La compatibilitÃ© avec NAT
- La visibilitÃ© des adresses IP

Ces deux modes sont :

**Mode Transport** : ProtÃ¨ge uniquement le payload (donnÃ©es) du paquet IP original
**Mode Tunnel** : Encapsule complÃ¨tement le paquet IP original dans un nouveau paquet IP

```
Analogie du monde rÃ©el :

Mode Transport = Enveloppe scellÃ©e pour une lettre :
- L'enveloppe originale reste visible
- Seul le contenu est protÃ©gÃ©
- L'adresse de destination reste lisible
- On voit d'oÃ¹ Ã§a vient et oÃ¹ Ã§a va

Mode Tunnel = Colis blindÃ© contenant l'enveloppe :
- L'enveloppe originale est cachÃ©e dans le colis
- Nouvelle adresse sur le colis blindÃ©
- Impossible de voir l'enveloppe originale sans ouvrir
- Double couche de protection
```

## Mode Transport

### Principe de fonctionnement

Le **mode transport** protÃ¨ge uniquement la charge utile (payload) du paquet IP tout en conservant l'en-tÃªte IP original.

```
Paquet IP original (avant IPsec) :

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IP Header                               â”‚
â”‚ Src: 192.168.1.10                       â”‚
â”‚ Dst: 192.168.1.20                       â”‚
â”‚ Protocol: TCP (6)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TCP Header                              â”‚
â”‚ Src Port: 45678                         â”‚
â”‚ Dst Port: 443                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Application Data                        â”‚
â”‚ (HTTPS request)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Paquet avec ESP en mode Transport :

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ IP Header (MODIFIÃ‰)                     â”‚
â”‚ Src: 192.168.1.10                       â”‚ â† MÃªme adresse
â”‚ Dst: 192.168.1.20                       â”‚ â† MÃªme adresse
â”‚ Protocol: ESP (50)                      â”‚ â† ChangÃ© !
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ESP Header                              â”‚
â”‚ SPI: 0x12345678                         â”‚
â”‚ Sequence: 42                            â”‚
â”œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¤ â”€â”
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚  â”‚
â”‚ â•‘ TCP Header (chiffrÃ©)              â•‘   â”‚  â”‚
â”‚ â•‘ Src Port: 45678                   â•‘   â”‚  â”‚ ChiffrÃ©
â”‚ â•‘ Dst Port: 443                     â•‘   â”‚  â”‚
â”‚ â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£   â”‚  â”‚
â”‚ â•‘ Application Data (chiffrÃ©)        â•‘   â”‚  â”‚
â”‚ â•‘ (HTTPS request)                   â•‘   â”‚  â”‚
â”‚ â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£   â”‚  â”‚
â”‚ â•‘ Padding                           â•‘   â”‚  â”‚
â”‚ â•‘ Pad Length + Next Header          â•‘   â”‚  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚  â”‚
â”œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¤ â”€â”˜
â”‚ ESP Trailer / ICV                       â”‚
â”‚ (Integrity Check Value - 16 bytes)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CaractÃ©ristiques :
âœ“ IP Header original conservÃ© (adresses visibles)
âœ— Protocol changÃ© en ESP (50)
âœ“ TCP/UDP header chiffrÃ©
âœ“ Application data chiffrÃ©
âœ“ Overhead minimal
```

### Structure dÃ©taillÃ©e en mode Transport

#### Avec ESP (Encapsulating Security Payload)

```
Encapsulation ESP Transport :

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Original IP Header (lÃ©gÃ¨rement modifiÃ©)                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Version: 4                                           â”‚ â”‚
â”‚ â”‚ IHL: 5 (20 bytes)                                    â”‚ â”‚
â”‚ â”‚ Type of Service: 0                                   â”‚ â”‚
â”‚ â”‚ Total Length: 120 (original data + ESP overhead)     â”‚ â”‚
â”‚ â”‚ Identification: 54321                                â”‚ â”‚
â”‚ â”‚ Flags/Fragment Offset: 0                             â”‚ â”‚
â”‚ â”‚ TTL: 64                                              â”‚ â”‚
â”‚ â”‚ Protocol: 50 (ESP) â† CHANGÃ‰ de TCP(6) Ã  ESP(50)      â”‚ â”‚
â”‚ â”‚ Header Checksum: recalculÃ©                           â”‚ â”‚
â”‚ â”‚ Source Address: 192.168.1.10                         â”‚ â”‚
â”‚ â”‚ Destination Address: 192.168.1.20                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ESP Header (8 bytes - NON chiffrÃ©)                       â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ SPI (Security Parameter Index): 4 bytes              â”‚ â”‚
â”‚ â”‚   0x12345678                                         â”‚ â”‚
â”‚ â”‚ Sequence Number: 4 bytes                             â”‚ â”‚
â”‚ â”‚   0x0000002A (42 en dÃ©cimal)                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¤
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚ â•‘ PAYLOAD CHIFFRÃ‰                                    â•‘   â”‚
â”‚ â•‘                                                    â•‘   â”‚
â”‚ â•‘ TCP/UDP Header (20 bytes pour TCP)                 â•‘   â”‚
â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘   â”‚
â”‚ â•‘ â”‚ Source Port: 45678                             â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Destination Port: 443                          â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Sequence Number: 1000                          â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Acknowledgment Number: 2000                    â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Flags: PSH, ACK                                â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Window: 65535                                  â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Checksum: 0xABCD                               â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Urgent Pointer: 0                              â”‚ â•‘   â”‚
â”‚ â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘   â”‚
â”‚ â•‘                                                    â•‘   â”‚
â”‚ â•‘ Application Data (variable)                        â•‘   â”‚
â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘   â”‚
â”‚ â•‘ â”‚ GET /secure/data HTTP/1.1                      â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Host: example.com                              â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Authorization: Bearer eyJ0eXAi...              â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ ...                                            â”‚ â•‘   â”‚
â”‚ â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘   â”‚
â”‚ â•‘                                                    â•‘   â”‚
â”‚ â•‘ ESP Trailer (dans la partie chiffrÃ©e)              â•‘   â”‚
â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘   â”‚
â”‚ â•‘ â”‚ Padding (0-255 bytes)                          â”‚ â•‘   â”‚
â”‚ â•‘ â”‚   0x00 0x00 0x00 0x00                          â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Pad Length (1 byte): 4                         â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Next Header (1 byte): TCP (6)                  â”‚ â•‘   â”‚
â”‚ â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘   â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ICV - Integrity Check Value (NON chiffrÃ©)                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Authentication Data (12-16 bytes pour GCM)           â”‚ â”‚
â”‚ â”‚   a3 f5 c8 d9 e1 b4 a7 c2 f8 d3 e9 b1 2c 4f 6a 8d    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Taille totale :
- IP Header: 20 bytes
- ESP Header: 8 bytes
- Payload original: variable (ex: 60 bytes)
- Padding: 0-255 bytes (ex: 4 bytes)
- ESP Trailer: 2 bytes
- ICV: 16 bytes (AES-GCM)

Overhead ESP Transport â‰ˆ 30-50 bytes
```

#### Avec AH (Authentication Header)

```
Encapsulation AH Transport (RARE) :

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Original IP Header (partiellement couvert par ICV)       â”‚
â”‚ Src: 192.168.1.10                                        â”‚
â”‚ Dst: 192.168.1.20                                        â”‚
â”‚ Protocol: 51 (AH) â† CHANGÃ‰                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AH Header                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Next Header: TCP (6)                                 â”‚ â”‚
â”‚ â”‚ Payload Length: 4 (en mots de 32 bits - 8 bytes)     â”‚ â”‚
â”‚ â”‚ Reserved: 0                                          â”‚ â”‚
â”‚ â”‚ SPI: 0xABCDEF12                                      â”‚ â”‚
â”‚ â”‚ Sequence Number: 0x0000001A                          â”‚ â”‚
â”‚ â”‚ ICV (Integrity Check Value):                         â”‚ â”‚
â”‚ â”‚   HMAC-SHA256(IP header + AH + TCP + Data)           â”‚ â”‚
â”‚ â”‚   (12 bytes ou plus)                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TCP Header (NON chiffrÃ© - visible)                       â”‚
â”‚ Src Port: 45678                                          â”‚
â”‚ Dst Port: 443                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Application Data (NON chiffrÃ© - visible)                 â”‚
â”‚ GET /data HTTP/1.1                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CaractÃ©ristiques AH :
âœ“ IntÃ©gritÃ© de tout le paquet (y compris IP header)
âœ“ Authentification origine
âœ— AUCUN chiffrement (donnÃ©es en clair)
âœ— ProblÃ©matique avec NAT (IP header modifiÃ©)

Overhead AH Transport â‰ˆ 24 bytes
```

### Cas d'usage du mode Transport

**1. Communication host-to-host directe**

```
ScÃ©nario : Deux serveurs qui communiquent directement

Server A (192.168.1.10) â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Server B (192.168.1.20)
         â†‘                                    â†‘
    IPsec capable                       IPsec capable

Configuration :
- Mode: Transport
- Protocol: ESP
- Traffic: 192.168.1.10 â†” 192.168.1.20

Avantages :
âœ“ Overhead minimal (pas de nouvel IP header)
âœ“ Performance optimale
âœ“ Adresses IP vraies conservÃ©es (routing simple)

Usage typique :
- Cluster database (rÃ©plication chiffrÃ©e)
- Application servers communication
- Storage area network (SAN)
```

**2. L2TP over IPsec (mode transport)**

```
Architecture VPN L2TP/IPsec :

Client â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ VPN Server
       IPsec Transport
          (ESP)
            â†“
      ProtÃ¨ge L2TP
            â†“
       L2TP Tunnel
            â†“
      PPP session

Flux :
IP â†’ ESP â†’ L2TP â†’ PPP â†’ IP (tunnel) â†’ Application Data

Mode Transport car :
- Communication directe client â†” serveur
- L2TP crÃ©e lui-mÃªme un tunnel (couche L2)
- IPsec protÃ¨ge juste le trafic L2TP

UtilisÃ© par :
- Windows VPN natif (historiquement)
- Certains VPN mobiles (iOS, Android)
```

**3. End-to-end encryption entre applications**

```
Application A          Application B
    (Host 1)              (Host 2)
       â†“                     â†“
  [IPsec stack]        [IPsec stack]
       â†“                     â†“
  192.168.1.10 â†â”€â”€â”€â”€â”€â”€â†’ 192.168.1.20
                Transport Mode

Exemple : SSH over IPsec Transport
- SSH dÃ©jÃ  chiffrÃ©
- IPsec ajoute couche additionnelle
- Defense in depth
- Mode transport car communication directe
```

### Avantages et inconvÃ©nients du mode Transport

**Avantages** :

```
âœ“ Overhead minimal :
  - Pas de nouvel IP header (20 bytes Ã©conomisÃ©s)
  - Seulement ESP/AH header ajoutÃ©
  - Meilleure performance (moins de donnÃ©es Ã  traiter)

âœ“ MTU prÃ©servÃ© :
  - Moins de problÃ¨mes de fragmentation
  - Meilleur pour applications sensibles (VoIP, streaming)

âœ“ Adresses IP conservÃ©es :
  - Routing transparent
  - QoS basÃ©e sur IP fonctionne
  - Inspection rÃ©seau possible (IP level)

âœ“ SimplicitÃ© conceptuelle :
  - Protection directe du payload
  - Pas de double encapsulation

Exemple performance :
Payload original : 1400 bytes
Mode Transport : 1400 + 50 (ESP) = 1450 bytes
Mode Tunnel : 1400 + 50 (ESP) + 20 (IP) = 1470 bytes
â†’ 20 bytes Ã©conomisÃ©s par paquet
â†’ Sur 1 Gbps : ~1.4% de bande passante Ã©conomisÃ©e
```

**InconvÃ©nients** :

```
âœ— LimitÃ© Ã  host-to-host :
  - Pas de protection de rÃ©seaux entiers
  - Chaque machine doit supporter IPsec
  - Configuration sur chaque endpoint

âœ— Adresses IP visibles :
  - Topologie rÃ©seau interne exposÃ©e
  - MÃ©tadonnÃ©es non protÃ©gÃ©es
  - Impossible de masquer infrastructure

âœ— Incompatible avec NAT standard :
  - IP header dans ICV (AH)
  - ESP change le protocol field
  - NAT-T nÃ©cessaire mais complexe

âœ— Pas de routage via gateway :
  - Impossible de centraliser protection
  - Pas de point de contrÃ´le unique
  - Gestion distribuÃ©e complexe

âœ— Requirements endpoints :
  - Les deux hÃ´tes doivent supporter IPsec
  - Configuration identique requise
  - Legacy systems problÃ©matiques

Exemple problÃ©matique :
PC Windows â†’ NAT â†’ Internet â†’ Server
Mode Transport avec AH : Ã‰CHEC
â†’ NAT modifie IP header
â†’ ICV invalide Ã  rÃ©ception
â†’ Paquet rejetÃ©
```

## Mode Tunnel

### Principe de fonctionnement

Le **mode tunnel** encapsule complÃ¨tement le paquet IP original dans un nouveau paquet IP avec de nouveaux en-tÃªtes.

```
Paquet IP original (avant IPsec) :

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Original IP Header                      â”‚
â”‚ Src: 10.1.0.5 (rÃ©seau privÃ© Paris)      â”‚
â”‚ Dst: 10.2.0.10 (rÃ©seau privÃ© Lyon)      â”‚
â”‚ Protocol: TCP (6)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TCP Header                              â”‚
â”‚ Src Port: 45678                         â”‚
â”‚ Dst Port: 443                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Application Data                        â”‚
â”‚ (donnÃ©es applicatives)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Paquet avec ESP en mode Tunnel :

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NEW IP Header                           â”‚
â”‚ Src: 203.0.113.10 (Gateway Paris)       â”‚ â† Nouvelle adresse
â”‚ Dst: 198.51.100.20 (Gateway Lyon)       â”‚ â† Nouvelle adresse
â”‚ Protocol: ESP (50)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ESP Header                              â”‚
â”‚ SPI: 0xABCDEF00                         â”‚
â”‚ Sequence: 123                           â”‚
â”œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¤ â”€â”
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚  â”‚
â”‚ â•‘ PAQUET ORIGINAL COMPLET (chiffrÃ©) â•‘   â”‚  â”‚
â”‚ â•‘                                   â•‘   â”‚  â”‚
â”‚ â•‘ Original IP Header                â•‘   â”‚  â”‚
â”‚ â•‘ Src: 10.1.0.5                     â•‘   â”‚  â”‚ Tout
â”‚ â•‘ Dst: 10.2.0.10                    â•‘   â”‚  â”‚ chiffrÃ©
â”‚ â•‘ Protocol: TCP (6)                 â•‘   â”‚  â”‚
â”‚ â•‘                                   â•‘   â”‚  â”‚
â”‚ â•‘ TCP Header                        â•‘   â”‚  â”‚
â”‚ â•‘ Src Port: 45678                   â•‘   â”‚  â”‚
â”‚ â•‘ Dst Port: 443                     â•‘   â”‚  â”‚
â”‚ â•‘                                   â•‘   â”‚  â”‚
â”‚ â•‘ Application Data                  â•‘   â”‚  â”‚
â”‚ â•‘ (donnÃ©es applicatives)            â•‘   â”‚  â”‚
â”‚ â•‘                                   â•‘   â”‚  â”‚
â”‚ â•‘ Padding                           â•‘   â”‚  â”‚
â”‚ â•‘ Pad Length + Next Header (IPv4)   â•‘   â”‚  â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚  â”‚
â”œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¤ â”€â”˜
â”‚ ESP Trailer / ICV                       â”‚
â”‚ (Integrity Check Value)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CaractÃ©ristiques :
âœ“ Paquet original COMPLÃˆTEMENT encapsulÃ©
âœ“ Nouvelles adresses IP (gateways)
âœ“ Adresses originales cachÃ©es
âœ“ Topologie interne invisible
âœ— Overhead supplÃ©mentaire (nouvel IP header)
```

### Structure dÃ©taillÃ©e en mode Tunnel

```
Encapsulation ESP Tunnel complÃ¨te :

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ NEW IP Header (20 bytes)                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Version: 4                                             â”‚ â”‚
â”‚ â”‚ IHL: 5                                                 â”‚ â”‚
â”‚ â”‚ Type of Service: 0x00                                  â”‚ â”‚
â”‚ â”‚ Total Length: 160 (paquet complet aprÃ¨s encapsulation) â”‚ â”‚
â”‚ â”‚ Identification: 12345                                  â”‚ â”‚
â”‚ â”‚ Flags: Don't Fragment (DF)                             â”‚ â”‚
â”‚ â”‚ Fragment Offset: 0                                     â”‚ â”‚
â”‚ â”‚ TTL: 64                                                â”‚ â”‚
â”‚ â”‚ Protocol: 50 (ESP)                                     â”‚ â”‚
â”‚ â”‚ Header Checksum: 0x3F2A                                â”‚ â”‚
â”‚ â”‚ Source Address: 203.0.113.10 (Paris Gateway)           â”‚ â”‚
â”‚ â”‚ Destination Address: 198.51.100.20 (Lyon Gateway)      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ESP Header (8 bytes - NON chiffrÃ©)                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ SPI: 0xABCDEF00 (identifie la SA)                      â”‚ â”‚
â”‚ â”‚ Sequence Number: 0x0000007B (123)                      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¤
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚ â•‘ PAYLOAD CHIFFRÃ‰ (paquet IP original complet)         â•‘   â”‚
â”‚ â•‘                                                      â•‘   â”‚
â”‚ â•‘ Original IP Header (20 bytes)                        â•‘   â”‚
â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘   â”‚
â”‚ â•‘ â”‚ Version: 4                                       â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ IHL: 5                                           â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Type of Service: 0x00                            â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Total Length: 80 (paquet original)               â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Identification: 54321                            â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Flags/Fragment: 0                                â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ TTL: 64                                          â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Protocol: 6 (TCP)                                â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Header Checksum: 0xABCD                          â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Source: 10.1.0.5                                 â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Destination: 10.2.0.10                           â”‚ â•‘   â”‚
â”‚ â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘   â”‚
â”‚ â•‘                                                      â•‘   â”‚
â”‚ â•‘ TCP Header (20 bytes)                                â•‘   â”‚
â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘   â”‚
â”‚ â•‘ â”‚ Source Port: 45678                               â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Destination Port: 443                            â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Sequence Number: 1000                            â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Ack Number: 2000                                 â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Flags: PSH, ACK                                  â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Window: 65535                                    â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Checksum: 0x1234                                 â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Urgent: 0                                        â”‚ â•‘   â”‚
â”‚ â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘   â”‚
â”‚ â•‘                                                      â•‘   â”‚
â”‚ â•‘ Application Data (40 bytes)                          â•‘   â”‚
â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘   â”‚
â”‚ â•‘ â”‚ GET /api/data HTTP/1.1                           â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Host: internal.example.com                       â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ ...                                              â”‚ â•‘   â”‚
â”‚ â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘   â”‚
â”‚ â•‘                                                      â•‘   â”‚
â”‚ â•‘ ESP Trailer (dans partie chiffrÃ©e)                   â•‘   â”‚
â”‚ â•‘ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘   â”‚
â”‚ â•‘ â”‚ Padding (variable, ex: 6 bytes)                  â”‚ â•‘   â”‚
â”‚ â•‘ â”‚   0x01 0x02 0x03 0x04 0x05 0x06                  â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Pad Length: 6                                    â”‚ â•‘   â”‚
â”‚ â•‘ â”‚ Next Header: IPv4 (4)                            â”‚ â•‘   â”‚
â”‚ â•‘ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘   â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ICV - Integrity Check Value (16 bytes pour AES-GCM)        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ b2 e7 d3 f9 a8 c6 5b 4d 1e 0f 2a 3c 8d 9e 4f 6a        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Taille totale :
- New IP Header: 20 bytes
- ESP Header: 8 bytes
- Original IP packet: 80 bytes (20 IP + 20 TCP + 40 data)
- Padding: 6 bytes
- ESP Trailer: 2 bytes
- ICV: 16 bytes

Total : 132 bytes (paquet original 80 bytes)
Overhead mode Tunnel â‰ˆ 52 bytes (65% overhead !)
```

### Processus d'encapsulation et dÃ©capsulation

**Encapsulation (Ã©mission)** :

```
Ã‰tapes Ã  l'Ã©mission (Gateway Paris) :

1. RÃ©ception paquet original :
   IP: 10.1.0.5 â†’ 10.2.0.10
   TCP: port 45678 â†’ port 443
   Data: 40 bytes

2. Matching SA (Security Association) :
   Traffic Selector : 10.1.0.0/24 â†” 10.2.0.0/24
   â†’ Paquet matche
   â†’ Appliquer SA tunnel vers Lyon

3. PrÃ©paration pour chiffrement :
   - Prendre paquet IP complet
   - Ajouter padding si nÃ©cessaire (bloc cipher)
   - Ajouter ESP Trailer (Pad Length + Next Header)

4. Chiffrement :
   Algorithm : AES-256-GCM
   Key : (dÃ©rivÃ©e de IKE)
   IV/Nonce : (combinaison fixe + sequence number)
   AAD : ESP Header + New IP Header

   Encrypt(
       plaintext = Original IP packet + Padding + Trailer,
       key = session_key,
       nonce = nonce,
       aad = ESP_header
   ) â†’ ciphertext + ICV

5. Construction nouveau paquet :
   - CrÃ©er nouveau IP header :
     Src: 203.0.113.10 (IP publique gateway Paris)
     Dst: 198.51.100.20 (IP publique gateway Lyon)
     Protocol: ESP (50)

   - Ajouter ESP header :
     SPI: identifie la SA
     Sequence: numÃ©ro anti-replay

   - Ajouter payload chiffrÃ©
   - Ajouter ICV

6. Transmission :
   Envoyer paquet sur interface publique
   Destination : 198.51.100.20 (Internet routing)
```

**DÃ©capsulation (rÃ©ception)** :

```
Ã‰tapes Ã  la rÃ©ception (Gateway Lyon) :

1. RÃ©ception paquet ESP :
   IP: 203.0.113.10 â†’ 198.51.100.20
   Protocol: ESP (50)

2. Identification SA :
   - Lire SPI dans ESP Header : 0xABCDEF00
   - Lookup dans SAD (Security Association Database)
   - Retrouver clÃ©s, algorithmes, etc.

3. VÃ©rifications anti-replay :
   - Lire Sequence Number : 123
   - VÃ©rifier que pas dÃ©jÃ  reÃ§u
   - VÃ©rifier dans fenÃªtre acceptable
   - Si OK : mettre Ã  jour sliding window

4. VÃ©rification intÃ©gritÃ© :
   Calculate_ICV(
       New IP Header + ESP Header + Encrypted Payload,
       integrity_key
   )

   Compare avec ICV reÃ§u
   If differ : DROP packet (attaque dÃ©tectÃ©e)

5. DÃ©chiffrement :
   Decrypt(
       ciphertext = encrypted payload,
       key = session_key,
       nonce = derived from sequence,
       aad = ESP_header,
       tag = ICV
   ) â†’ plaintext

   Result : Original IP packet + Padding + Trailer

6. Extraction paquet original :
   - Lire Next Header dans ESP Trailer : IPv4 (4)
   - Retirer padding
   - Extraire paquet IP original :
     IP: 10.1.0.5 â†’ 10.2.0.10
     TCP: 45678 â†’ 443

7. Routage interne :
   - Lookup table de routage : 10.2.0.10
   - Interface : LAN Lyon
   - Forward vers 10.2.0.10

8. DÃ©livrance :
   Machine 10.2.0.10 reÃ§oit paquet
   Comme si communication directe avec 10.1.0.5
   Transparent pour les applications
```

### Cas d'usage du mode Tunnel

**1. Site-to-Site VPN (le plus courant)**

```
ScÃ©nario : Connecter deux bureaux distants

Bureau Paris              Internet            Bureau Lyon
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10.1.0.0/24  â”‚                          â”‚ 10.2.0.0/24  â”‚
â”‚              â”‚                          â”‚              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”     â”‚                          â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ PC   â”‚     â”‚                          â”‚   â”‚ PC   â”‚   â”‚
â”‚ â”‚10.1.0.5    â”‚                          â”‚   â”‚10.2.0.10 â”‚
â”‚ â””â”€â”€â”¬â”€â”€â”€â”˜     â”‚                          â”‚   â””â”€â”€â”€â”¬â”€â”€â”˜   â”‚
â”‚    â”‚         â”‚                          â”‚       â”‚      â”‚
â”‚ â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”‚                          â”‚ â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”  â”‚
â”‚ â”‚ Gateway â”‚ â—„â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–ºâ”‚ Gateway â”‚  â”‚
â”‚ â”‚203.0.113â”‚  â”‚    IPsec Tunnel          â”‚ â”‚198.51.  â”‚  â”‚
â”‚ â”‚    .10  â”‚  â”‚    Mode Tunnel           â”‚ â”‚  100.20 â”‚  â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                          â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Configuration Gateway Paris :
tunnel source: 203.0.113.10
tunnel destination: 198.51.100.20
local subnet: 10.1.0.0/24
remote subnet: 10.2.0.0/24
mode: tunnel

Flux :
PC Paris (10.1.0.5) â†’ Gateway Paris
â†’ Encapsulation ESP tunnel
â†’ Internet (203.0.113.10 â†’ 198.51.100.20)
â†’ Gateway Lyon
â†’ DÃ©capsulation
â†’ PC Lyon (10.2.0.10)

Avantages :
âœ“ Transparent pour utilisateurs
âœ“ Tous les protocoles supportÃ©s
âœ“ Gestion centralisÃ©e (gateways)
âœ“ SÃ©curitÃ© complÃ¨te rÃ©seau Ã  rÃ©seau
```

**2. Remote Access VPN (Road Warrior)**

```
ScÃ©nario : EmployÃ© distant accÃ¨de rÃ©seau entreprise

Laptop distant         Internet          Entreprise
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Client VPN  â”‚                       â”‚ VPN Gateway  â”‚
â”‚ 203.0.113.50â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ 198.51.100.10â”‚
â”‚             â”‚   IPsec Tunnel        â”‚              â”‚
â”‚ IP virtuelleâ”‚   Mode Tunnel         â”‚              â”‚
â”‚ 172.16.100.5â”‚                       â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚RÃ©seau interneâ”‚
                                      â”‚ 10.0.0.0/8   â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Process :
1. Laptop Ã©tablit tunnel IPsec
2. ReÃ§oit IP virtuelle : 172.16.100.5
3. Routes vers 10.0.0.0/8 via tunnel

Application sur laptop :
â†’ Destination: 10.1.0.50 (serveur interne)
â†’ Source: 172.16.100.5 (IP virtuelle)
â†’ Encapsulation tunnel :
  Outer IP: 203.0.113.50 â†’ 198.51.100.10
  Inner IP: 172.16.100.5 â†’ 10.1.0.50
â†’ Gateway dÃ©capsule et route

Avantages :
âœ“ AccÃ¨s complet rÃ©seau comme au bureau
âœ“ SÃ©curitÃ© sur Wi-Fi public
âœ“ Support tous protocoles (SMB, RDP, etc.)
```

**3. Cloud Interconnection**

```
ScÃ©nario : Connecter datacenter on-premise Ã  AWS VPC

Datacenter              Internet            AWS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 192.168.0.0/ â”‚                       â”‚ 10.0.0.0/16  â”‚
â”‚      16      â”‚                       â”‚  VPC         â”‚
â”‚              â”‚                       â”‚              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                       â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Firewall â”‚â—„â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–ºâ”‚Virtual   â”‚ â”‚
â”‚ â”‚with IPsecâ”‚ â”‚   IPsec Tunnel        â”‚ â”‚Private   â”‚ â”‚
â”‚ â”‚203.0.113 â”‚ â”‚   Mode Tunnel         â”‚ â”‚Gateway   â”‚ â”‚
â”‚ â”‚    .100  â”‚ â”‚   (redundant)         â”‚ â”‚          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                       â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Configuration :
- Dual tunnel pour redondance
- BGP pour routage dynamique
- Mode tunnel obligatoire

Trafic :
Server on-premise (192.168.1.50)
â†’ Route vers 10.0.0.0/16
â†’ Gateway encapsule en tunnel
â†’ AWS VPC gateway dÃ©capsule
â†’ EC2 instance (10.0.1.20)

Cas d'usage :
âœ“ Hybrid cloud
âœ“ Backup vers cloud
âœ“ Burst capacity
âœ“ Migration progressive
```

**4. Protection d'un subnet complet**

```
ScÃ©nario : SÃ©curiser communication entre datacenters

Datacenter A         Internet         Datacenter B
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DMZ Public   â”‚                     â”‚ Backend      â”‚
â”‚ 172.16.0.0/24â”‚                     â”‚ 10.50.0.0/16 â”‚
â”‚              â”‚                     â”‚              â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚                     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Web      â”‚ â”‚                     â”‚ â”‚ Database â”‚ â”‚
â”‚ â”‚ Servers  â”‚ â”‚                     â”‚ â”‚ Cluster  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚                     â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚
â”‚      â”‚       â”‚                     â”‚      â”‚       â”‚
â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”‚                     â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Gateway  â”‚â—„â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â–ºâ”‚ Gateway  â”‚ â”‚
â”‚ â”‚          â”‚ â”‚  IPsec Tunnel       â”‚ â”‚          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  Mode Tunnel        â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Protection :
- Toute communication DMZ â†’ Backend chiffrÃ©e
- Serveurs web n'ont pas besoin IPsec natif
- Chiffrement transparent
- Gateway gÃ¨re tout

Exemple requÃªte :
Web server (172.16.0.10)
â†’ Query database (10.50.0.20:3306)
â†’ Gateway A encapsule
â†’ Tunnel sÃ©curisÃ©
â†’ Gateway B dÃ©capsule
â†’ Database reÃ§oit requÃªte de 172.16.0.10
```

### Avantages et inconvÃ©nients du mode Tunnel

**Avantages** :

```
âœ“ Protection rÃ©seau complÃ¨te :
  - SÃ©curise des rÃ©seaux entiers (pas juste des hÃ´tes)
  - Tous les appareils protÃ©gÃ©s (mÃªme sans IPsec natif)
  - Gestion centralisÃ©e sur gateways

âœ“ Masquage topologie :
  - Adresses internes invisibles de l'extÃ©rieur
  - SÃ©curitÃ© par obscuritÃ© additionnelle
  - Protection mÃ©tadonnÃ©es rÃ©seau

âœ“ FlexibilitÃ© routing :
  - Peut router via Internet entre rÃ©seaux privÃ©s
  - Overlapping IP spaces possible (avec NAT)
  - Topologies complexes supportÃ©es

âœ“ Pas de requirement sur endpoints :
  - Machines finales ignorent IPsec
  - Applications legacy supportÃ©es
  - Aucune modification nÃ©cessaire

âœ“ Point de contrÃ´le centralisÃ© :
  - Monitoring centralisÃ©
  - Politique de sÃ©curitÃ© unique
  - Audit facilitÃ©

âœ“ ScalabilitÃ© :
  - Un tunnel protÃ¨ge des milliers de machines
  - Pas de configuration individuelle
  - Gestion simplifiÃ©e

Exemple :
1000 PCs dans bureau A
1000 PCs dans bureau B
â†’ 1 seul tunnel IPsec
â†’ 2 points de configuration (2 gateways)
Alternative sans tunnel :
â†’ 1000 Ã— 1000 = 1 million de configurations !
```

**InconvÃ©nients** :

```
âœ— Overhead supplÃ©mentaire :
  - Nouvel IP header : +20 bytes
  - ESP header/trailer : +30 bytes
  - Total overhead : ~50-70 bytes
  - Sur petits paquets : impact significatif

âœ— MTU rÃ©duit :
  - MTU Internet : 1500 bytes
  - AprÃ¨s encapsulation : ~1400 bytes utilisables
  - Fragmentation possible
  - Impact VoIP, gaming, streaming

âœ— Performance :
  - Double traitement IP (original + outer)
  - Plus de CPU pour encryption/decryption
  - Latence additionnelle (minime mais prÃ©sente)

âœ— ComplexitÃ© NAT :
  - NAT-T obligatoire si NAT dans le chemin
  - Double NAT problÃ©matique
  - Configuration plus complexe

âœ— Troubleshooting difficile :
  - Payload chiffrÃ© invisible
  - Adresses originales cachÃ©es
  - Debug rÃ©seau complexe
  - Traceroute limitÃ©

âœ— Point de dÃ©faillance :
  - Si gateway down : tout le trafic coupÃ©
  - SPOF (Single Point of Failure)
  - NÃ©cessite haute disponibilitÃ©

Exemple overhead :
VoIP packet : 200 bytes (IP + UDP + RTP + audio)
Mode Transport : 200 + 50 = 250 bytes (25% overhead)
Mode Tunnel : 200 + 70 = 270 bytes (35% overhead)

Sur 1000 paquets/seconde VoIP :
Mode Transport : 250 KB/s
Mode Tunnel : 270 KB/s
â†’ 20 KB/s additionnel (8% bande passante perdue)
```

## Comparaison dÃ©taillÃ©e Transport vs Tunnel

### Tableau comparatif complet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CaractÃ©ristique   â”‚   Mode Transport  â”‚   Mode Tunnel     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Protection          â”‚ Payload seulement â”‚ Paquet complet    â”‚
â”‚                     â”‚ (TCP/UDP + data)  â”‚ (IP + tout)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IP Header original  â”‚ ConservÃ©, visible â”‚ ChiffrÃ©, cachÃ©    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Adresses IP visiblesâ”‚ Oui (source/dest) â”‚ Non (gateways)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nouvel IP Header    â”‚ Non               â”‚ Oui (+20 bytes)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Overhead typique    â”‚ ~30-50 bytes      â”‚ ~50-70 bytes      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MTU impact          â”‚ Faible (~50 bytes)â”‚ Moyen (~70 bytes) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Topologie           â”‚ Host-to-host      â”‚ Network-to-networkâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Endpoints IPsec     â”‚ Obligatoire       â”‚ Pas nÃ©cessaire    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Configuration       â”‚ Sur chaque hÃ´te   â”‚ Sur gateways      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ScalabilitÃ©         â”‚ LimitÃ©e           â”‚ Excellente        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ NAT traversal       â”‚ TrÃ¨s difficile    â”‚ Possible (NAT-T)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Use case principal  â”‚ Server-to-server  â”‚ Site-to-site VPN  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ VisibilitÃ© rÃ©seau   â”‚ IP visible        â”‚ IP masquÃ©e        â”‚
â”‚ (admin)             â”‚ (inspection OK)   â”‚ (inspection NON)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Performance         â”‚ Meilleure         â”‚ Bonne             â”‚
â”‚                     â”‚ (moins overhead)  â”‚ (overhead moyen)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ComplexitÃ©          â”‚ Moyenne           â”‚ Moyenne-Ã‰levÃ©e    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Protection mÃ©tadata â”‚ Non (IP visible)  â”‚ Oui (IP cachÃ©)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Routing             â”‚ Direct            â”‚ Via gateways      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Choix du mode selon le contexte

**Utilisez Mode Transport quand** :

```
âœ“ Communication directe entre deux serveurs :
  Example: Database replication cluster
  Server A â†â”€â”€â”€â”€â”€â”€â†’ Server B
  Les deux supportent IPsec nativement

âœ“ Overhead critique :
  Example: High-frequency trading
  Latence microseconde importante
  Chaque byte compte

âœ“ L2TP/IPsec VPN :
  L2TP crÃ©e dÃ©jÃ  un tunnel
  IPsec en transport protÃ¨ge L2TP
  Ã‰vite double encapsulation

âœ“ End-to-end encryption requise :
  Application spÃ©cifique entre hÃ´tes
  Pas de gateway intermÃ©diaire
  SÃ©curitÃ© maximale endpoint-to-endpoint

âœ“ QoS basÃ©e sur IP originales :
  Ã‰quipements rÃ©seau doivent voir vraies IPs
  Prioritization basÃ©e sur source/destination
  Mode transport conserve adresses

Exemple : Cluster Kubernetes
Node 1 (10.0.1.10) â†â”€ IPsec Transport â”€â†’ Node 2 (10.0.1.20)
Communication pod-to-pod chiffrÃ©e
Performances critiques
Adresses IP significatives pour monitoring
```

**Utilisez Mode Tunnel quand** :

```
âœ“ Site-to-Site VPN (99% des cas) :
  Bureau A â†â”€â”€â”€â”€â”€â”€â†’ Bureau B
  RÃ©seaux complets protÃ©gÃ©s
  Configuration centralisÃ©e

âœ“ Remote Access VPN :
  EmployÃ©s distants â†’ Entreprise
  AccÃ¨s rÃ©seau complet
  Client VPN standard

âœ“ Cloud interconnection :
  On-premise â†â”€â”€â”€â”€â”€â”€â†’ AWS/Azure/GCP
  Hybrid cloud
  Standard du cloud

âœ“ Protection rÃ©seau legacy :
  Applications anciennes
  Pas de support IPsec natif
  Gateway protÃ¨ge tout

âœ“ Masquage topologie requis :
  SÃ©curitÃ© par obscuritÃ©
  Adresses internes confidentielles
  Compliance (PCI-DSS, etc.)

âœ“ NAT nÃ©cessaire :
  Overlapping IP spaces
  Multiple rÃ©seaux vers Internet
  FlexibilitÃ© routing

âœ“ Centralisation gestion :
  Une Ã©quipe rÃ©seau gÃ¨re tout
  Pas de configuration endpoints
  Monitoring centralisÃ©

Exemple : Multi-site retail
HQ â†â”€â”¬â”€â†’ Store 1
     â”œâ”€â†’ Store 2
     â”œâ”€â†’ Store 3
     â””â”€â†’ Store N (100+ stores)
Mode tunnel sur tous
Gestion centralisÃ©e HQ
Stores : zÃ©ro configuration
```

## ProblÃ©matiques MTU et fragmentation

### Impact de l'encapsulation sur MTU

```
MTU (Maximum Transmission Unit) problÃ©matique :

RÃ©seau standard :
MTU Ethernet : 1500 bytes
IP Header : 20 bytes
TCP Header : 20 bytes
â†’ MSS (Max Segment Size) : 1460 bytes

Avec IPsec Mode Transport :
MTU : 1500 bytes
IP Header : 20 bytes
ESP Header + Trailer : ~30 bytes
TCP Header : 20 bytes (chiffrÃ©)
â†’ MSS effectif : 1430 bytes

Avec IPsec Mode Tunnel :
MTU : 1500 bytes
Outer IP Header : 20 bytes
ESP Header + Trailer : ~30 bytes
Inner IP Header : 20 bytes (chiffrÃ©)
TCP Header : 20 bytes (chiffrÃ©)
â†’ MSS effectif : 1410 bytes

ProblÃ¨me :
Application gÃ©nÃ¨re segment TCP de 1460 bytes
+ IP header : 1480 bytes
+ Encapsulation IPsec tunnel : 1550 bytes
â†’ DÃ©passe MTU 1500 bytes
â†’ Fragmentation nÃ©cessaire
```

### ConsÃ©quences de la fragmentation

```
Fragmentation IP :

Paquet trop grand (1550 bytes) fragmentÃ© :

Fragment 1 : 1500 bytes
  - Outer IP header (20b)
  - ESP header (8b)
  - Partie du payload chiffrÃ© (1472b)

Fragment 2 : 50 bytes
  - Outer IP header (20b)
  - Reste du payload (14b)
  - ICV (16b)

ProblÃ¨mes :

1. Performance :
   âœ— Deux paquets au lieu d'un
   âœ— Overhead double (2 Ã— IP headers)
   âœ— Processing double

2. FiabilitÃ© :
   âœ— Si fragment perdu â†’ tout le paquet perdu
   âœ— Retransmission complÃ¨te nÃ©cessaire
   âœ— Taux de perte augmentÃ©

3. NAT :
   âœ— Certains NAT mal gÃ¨rent fragments
   âœ— Fragments peuvent Ãªtre droppÃ©s
   âœ— Connexion instable

4. Firewall :
   âœ— Stateful inspection complexe
   âœ— Fragments peuvent Ãªtre bloquÃ©s
   âœ— RÃ¨gles de sÃ©curitÃ© compliquÃ©es

5. Performance rÃ©seau :
   âœ— Routeurs doivent rÃ©assembler
   âœ— CPU overhead
   âœ— Latence accrue
```

### Solutions MTU

**Solution 1 : Path MTU Discovery (PMTUD)**

```
MÃ©canisme :

1. Host envoie paquet avec DF (Don't Fragment) flag
2. Si trop grand pour MTU intermÃ©diaire :
   Router retourne ICMP "Fragmentation Needed" (Type 3, Code 4)
   Includes MTU of next hop
3. Host rÃ©duit MSS et retransmit
4. Process rÃ©pÃ©tÃ© jusqu'Ã  trouver MTU optimal

Example :
Host â†’ Packet 1500 bytes, DF set
Router with MTU 1400 â†’ ICMP "Frag needed, MTU=1400"
Host â†’ Packet 1400 bytes, DF set
â†’ Success !

ProblÃ¨me :
âœ— Certains firewall bloquent ICMP
âœ— PMTUD Ã©choue
âœ— Black hole situation

Protection :
Activer "ICMP Type 3 Code 4" sur firewall
```

**Solution 2 : MSS Clamping (recommandÃ©)**

```
Configuration sur gateway IPsec :

iptables -A FORWARD -p tcp --tcp-flags SYN,RST SYN \
    -j TCPMSS --set-mss 1360

Effet :
- Intercepte paquets TCP SYN
- RÃ©duit MSS annoncÃ© Ã  1360 bytes
- PrÃ©vient gÃ©nÃ©ration segments trop grands

Calcul MSS :
MTU : 1500 bytes
- Outer IP : 20 bytes
- ESP : 50 bytes (pessimiste)
- Inner IP : 20 bytes
- TCP : 20 bytes
= 1390 bytes disponibles
â†’ MSS sÃ©cure : 1360 bytes (marge)

Avantages :
âœ“ Transparent pour applications
âœ“ Pas de fragmentation
âœ“ Fonctionne mÃªme si ICMP bloquÃ©
âœ“ Performance optimale
```

**Solution 3 : Augmenter MTU (si possible)**

```
Jumbo Frames sur LAN :

RÃ©seau interne : MTU 9000 bytes
Gateway IPsec : Interface LAN MTU 9000, WAN MTU 1500

Configuration :
# Interface interne
ip link set eth0 mtu 9000

# Permet paquets jusqu'Ã  9000 bytes en interne
# Gateway fragmente/rÃ©duit pour Internet

Avantages :
âœ“ Performance interne maximale
âœ“ Moins de overhead (moins de paquets)
âœ“ Bon pour transferts gros volumes

Limitations :
âœ— NÃ©cessite support sur tout le LAN
âœ— Switches, NICs doivent supporter
âœ— N'aide pas pour trafic Internet
```

## Configurations pratiques

### Configuration strongSwan (mode tunnel)

```bash
# /etc/ipsec.conf

config setup
    charondebug="ike 2, knl 2, cfg 2"
    uniqueids=no

conn site-to-site
    # Mode tunnel
    type=tunnel

    # Left (local) - Paris
    left=203.0.113.10
    leftsubnet=10.1.0.0/24
    leftid=@paris.company.com
    leftauth=psk

    # Right (remote) - Lyon
    right=198.51.100.20
    rightsubnet=10.2.0.0/24
    rightid=@lyon.company.com
    rightauth=psk

    # IKE/ESP parameters
    ike=aes256-sha256-modp2048!
    esp=aes256-sha256!

    # Lifetime
    ikelifetime=28800s  # 8 hours
    lifetime=3600s      # 1 hour

    # DPD (Dead Peer Detection)
    dpdaction=restart
    dpddelay=30s
    dpdtimeout=120s

    # Automatic start
    auto=start

    # MSS clamping
    mtu=1400

# /etc/ipsec.secrets
203.0.113.10 198.51.100.20 : PSK "SuperSecretSharedKey123!"
```

### Configuration strongSwan (mode transport)

```bash
# /etc/ipsec.conf

conn server-to-server
    # Mode transport
    type=transport

    # Left (Server A)
    left=192.168.1.10
    leftid=@server-a.internal
    leftauth=pubkey
    leftcert=server-a.pem

    # Right (Server B)
    right=192.168.1.20
    rightid=@server-b.internal
    rightauth=pubkey
    rightcert=server-b.pem

    # IKE/ESP
    ike=aes256-sha256-modp2048!
    esp=aes256-sha256!

    # Lifetime
    ikelifetime=86400s  # 24 hours
    lifetime=3600s      # 1 hour

    # Auto-start
    auto=route  # Start on traffic
```

### Configuration Cisco (mode tunnel)

```cisco
! Configuration IPsec site-to-site Cisco

crypto isakmp policy 10
 encryption aes 256
 hash sha256
 authentication pre-share
 group 14
 lifetime 28800

crypto isakmp key SuperSecretKey123! address 198.51.100.20

crypto ipsec transform-set STRONG esp-aes 256 esp-sha256-hmac
 mode tunnel

crypto map VPN-MAP 10 ipsec-isakmp
 set peer 198.51.100.20
 set transform-set STRONG
 match address VPN-TRAFFIC

access-list VPN-TRAFFIC permit ip 10.1.0.0 0.0.0.255 10.2.0.0 0.0.0.255

interface GigabitEthernet0/0
 description WAN Interface
 ip address 203.0.113.10 255.255.255.0
 crypto map VPN-MAP

! MTU adjustment
interface GigabitEthernet0/1
 description LAN Interface
 ip address 10.1.0.1 255.255.255.0
 ip tcp adjust-mss 1360
```

## ScÃ©narios avancÃ©s

### Tunnel dans tunnel

```
ScÃ©nario : Double encapsulation pour sÃ©curitÃ© renforcÃ©e

Level 1 : IPsec Tunnel (Site-to-Site VPN)
Bureau A â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Bureau B

Level 2 : IPsec Transport (application spÃ©cifique)
Server A â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ Server B
     (au sein du tunnel site-to-site)

Structure paquet :

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Outer IP Header (Site-to-Site)       â”‚
â”‚ 203.0.113.10 â†’ 198.51.100.20         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ESP Header (Tunnel)                  â”‚
â”œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”¤
â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚ â•‘ Inner IP (Site-to-Site)        â•‘   â”‚
â”‚ â•‘ 10.1.0.5 â†’ 10.2.0.10           â•‘   â”‚
â”‚ â•‘                                â•‘   â”‚
â”‚ â•‘ ESP Header (Transport)         â•‘   â”‚
â”‚ â•‘ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â•‘   â”‚
â”‚ â•‘ â•‘ TCP + Application Data     â•‘ â•‘   â”‚
â”‚ â•‘ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â•‘   â”‚
â”‚ â•‘ ICV (Transport)                â•‘   â”‚
â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ICV (Tunnel)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Usage :
âœ“ Defense in depth
âœ“ DonnÃ©es ultra-sensibles
âœ“ Compliance stricte
âœ— Overhead double (~100 bytes)
âœ— Performance impact
```

### Split Tunneling

```
Concept : Seulement le trafic vers rÃ©seau d'entreprise via VPN

EmployÃ© distant avec VPN IPsec :

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Laptop avec VPN                        â”‚
â”‚                                        â”‚
â”‚ Trafic vers 10.0.0.0/8 (Entreprise)    â”‚
â”‚     â†’ Via tunnel IPsec â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                                â”‚       â”‚
â”‚ Trafic vers Internet           â”‚       â”‚
â”‚     â†’ Direct (pas de VPN) â”€â”   â”‚       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚   â”‚
                             â–¼   â–¼
                        Internet  Entreprise

Configuration :
# Routes spÃ©cifiques via tunnel
ip route 10.0.0.0/8 via tunnel1
ip route 172.16.0.0/12 via tunnel1

# Route par dÃ©faut directe
ip route 0.0.0.0/0 via eth0

Avantages :
âœ“ Performance (trafic Internet direct)
âœ“ Moins de charge sur VPN gateway
âœ“ Meilleure expÃ©rience utilisateur

Risques :
âœ— Traffic Internet non protÃ©gÃ©
âœ— Possible exfiltration de donnÃ©es
âœ— Malware peut contourner protections
```

### Tunnel redondant (High Availability)

```
Configuration : Dual tunnel pour haute disponibilitÃ©

Bureau A            Internet         Bureau B
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gateway A1â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤Gateway B1 â”‚
â”‚ Primary   â”‚ Tunnel 1  â”‚          â”‚ Primary   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     /  \
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       /    \         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gateway A2â”œâ”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¤Gateway B2 â”‚
â”‚ Secondary â”‚ Tunnel 2             â”‚ Secondary â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MÃ©canismes HA :

1. Active-Active :
   - Les deux tunnels actifs
   - Load balancing du trafic
   - ECMP (Equal Cost Multi-Path)

2. Active-Standby :
   - Tunnel primaire actif
   - Tunnel secondaire en veille
   - Failover automatique (DPD)

3. avec VRRP/HSRP :
   - IP virtuelle partagÃ©e
   - Failover transparent
   - Ã‰tat maintenu

Dead Peer Detection (DPD) :
- Keepalive toutes les 30s
- Si 3 Ã©checs : peer considÃ©rÃ© down
- Bascule automatique sur tunnel backup
- Timeout 90-120 secondes
```

## Conclusion

Les modes Transport et Tunnel d'IPsec offrent des approches fondamentalement diffÃ©rentes pour sÃ©curiser les communications IP, chacune adaptÃ©e Ã  des contextes spÃ©cifiques.

**Points clÃ©s Ã  retenir** :

```
Mode Transport :
âœ“ ProtÃ¨ge payload uniquement
âœ“ Conserve IP header original
âœ“ Overhead minimal (~30-50 bytes)
âœ“ Usage : Host-to-host direct
âœ“ Performance maximale
âœ— LimitÃ© en scalabilitÃ©
âœ— Endpoints doivent supporter IPsec

Mode Tunnel :
âœ“ Encapsule paquet complet
âœ“ Masque adresses originales
âœ“ Usage : Network-to-network (VPN)
âœ“ ScalabilitÃ© excellente
âœ“ Transparent pour endpoints
âœ— Overhead plus important (~50-70 bytes)
âœ— MTU challenges

Choix du mode :
â†’ Transport : Serveurs qui communiquent directement
â†’ Tunnel : VPN site-to-site (99% des cas)
â†’ Tunnel : Remote access VPN
â†’ Tunnel : Cloud interconnection

ProblÃ©matiques communes :
- MTU et fragmentation
- Performance overhead
- NAT traversal (NAT-T)
- Configuration complexitÃ©

Solutions :
âœ“ MSS clamping (1360 bytes)
âœ“ PMTUD activÃ©
âœ“ Hardware acceleration
âœ“ Monitoring et tuning
```

**RÃ¨gle d'or** :

```
Si vous hÃ©sitez entre Transport et Tunnel :
â†’ Choisissez Tunnel

Raisons :
- Plus flexible
- Plus courant (mieux documentÃ©)
- Support universel
- Moins de surprises
- Standard de l'industrie pour VPN
```

Dans la section suivante (6.5.2), nous approfondirons les protocoles AH et ESP : leurs formats dÃ©taillÃ©s, algorithmes cryptographiques, et considÃ©rations de sÃ©curitÃ© spÃ©cifiques.

â­ï¸ [AH et ESP](/06-securite/05.2-ipsec-ah-esp.md)
