ğŸ” Retour au [Sommaire](/SOMMAIRE.md)

# 6.4.2 Certificats et PKI

## Introduction

Les **certificats numÃ©riques** sont les documents d'identitÃ© d'Internet. Tout comme votre passeport prouve votre identitÃ© dans le monde physique, un certificat numÃ©rique prouve l'identitÃ© d'un serveur (ou d'un client) dans le monde numÃ©rique.

La **PKI** (Public Key Infrastructure - Infrastructure Ã  ClÃ©s Publiques) est l'Ã©cosystÃ¨me complet qui permet la crÃ©ation, la distribution, la gestion et la rÃ©vocation de ces certificats. C'est une infrastructure critique qui sous-tend la sÃ©curitÃ© de pratiquement toutes les communications Internet modernes.

**Pourquoi les certificats sont-ils essentiels ?**

Sans certificats, TLS ne pourrait pas garantir l'authenticitÃ© :

```
ScÃ©nario sans certificats :

Client se connecte Ã  "www.banque.fr"
â†’ Ã‰tablit une connexion TLS chiffrÃ©e
â†’ Mais avec qui ?
   - Vraiment avec www.banque.fr ?
   - Ou avec un attaquant MITM ?
â†’ Impossible de savoir !

ScÃ©nario avec certificats :

Client se connecte Ã  "www.banque.fr"
â†’ Serveur prÃ©sente certificat
â†’ Certificat signÃ© par une CA de confiance
â†’ Certificat indique : "Je suis www.banque.fr"
â†’ Client vÃ©rifie la signature de la CA
â†’ Client vÃ©rifie que le domaine correspond
â†’ âœ“ Confiance Ã©tablie : c'est bien la vraie banque
```

**Analogie du monde rÃ©el** :

```
Obtenir un passeport :
1. Vous allez Ã  la prÃ©fecture avec vos documents
2. L'Ã‰tat vÃ©rifie votre identitÃ©
3. L'Ã‰tat vous dÃ©livre un passeport signÃ©/tamponnÃ©
4. Le passeport contient vos infos + signature de l'Ã‰tat
5. Ã€ la frontiÃ¨re, le douanier :
   - VÃ©rifie que le passeport n'est pas expirÃ©
   - VÃ©rifie que c'est bien vous (photo)
   - Fait confiance Ã  la signature de l'Ã‰tat Ã©metteur

Obtenir un certificat SSL :
1. Vous demandez un certificat Ã  une CA
2. La CA vÃ©rifie que vous contrÃ´lez le domaine
3. La CA vous dÃ©livre un certificat signÃ©
4. Le certificat contient domaine + clÃ© publique + signature CA
5. Lors d'une connexion, le client :
   - VÃ©rifie que le certificat n'est pas expirÃ©
   - VÃ©rifie que le domaine correspond
   - Fait confiance Ã  la signature de la CA
```

## Structure d'un certificat X.509

### Standard X.509

**X.509** est le standard international (ITU-T) dÃ©finissant le format des certificats de clÃ©s publiques. La version actuelle est **X.509 v3**, qui ajoute des extensions cruciales Ã  la version de base.

```
Format : ASN.1 (Abstract Syntax Notation One)
Encodage : DER (Distinguished Encoding Rules)
          ou PEM (Privacy Enhanced Mail - base64 du DER)
```

### Format PEM vs DER

**PEM** (le plus courant) :

```
-----BEGIN CERTIFICATE-----
MIIFXzCCBEegAwIBAgISA5JKGrNfj4CjcqzxPbUJzwgiMA0GCSqGSIb3DQEBCwUA
MDIxCzAJBgNVBAYTAlVTMRYwFAYDVQQKEw1MZXQncyBFbmNyeXB0MQswCQYDVQQD
EwJSMzAeFw0yNDEwMDExMjAwMDBaFw0yNDEyMzAxMTU5NTlaMBkxFzAVBgNVBAMT
Dnd3dy5leGFtcGxlLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB
... (beaucoup plus de lignes)
-----END CERTIFICATE-----

CaractÃ©ristiques :
- Texte lisible (base64)
- DÃ©limiteurs BEGIN/END
- UtilisÃ© par Apache, Nginx, OpenSSL
- Extension : .pem, .crt, .cer
```

**DER** (binaire) :

```
30 82 05 5F 30 82 04 47 A0 03 02 01 02 02 12 03 92 4A 1A B3 5F 8F 80 A3 ...

CaractÃ©ristiques :
- Format binaire
- Plus compact
- UtilisÃ© par Java, Windows
- Extension : .der, .cer
```

**Conversion** :

```bash
# PEM â†’ DER
openssl x509 -in cert.pem -outform DER -out cert.der

# DER â†’ PEM
openssl x509 -in cert.der -inform DER -outform PEM -out cert.pem
```

### Anatomie complÃ¨te d'un certificat

```
Certificate (X.509 v3) {
    Version                    : 3 (0x2)
    Serial Number              : 03:92:4a:1a:b3:5f:8f:80:a3:72:ac:f1:3d:b5:09:cf:08:22
    Signature Algorithm        : sha256WithRSAEncryption

    Issuer (Ã‰metteur - la CA)  :
        Country (C)            : US
        Organization (O)       : Let's Encrypt
        Common Name (CN)       : R3

    Validity (PÃ©riode de validitÃ©) :
        Not Before             : 2024-10-01 12:00:00 GMT
        Not After              : 2024-12-30 11:59:59 GMT

    Subject (Sujet - l'entitÃ© certifiÃ©e) :
        Common Name (CN)       : www.example.com

    Subject Public Key Info (ClÃ© publique) :
        Public Key Algorithm   : rsaEncryption
        RSA Public Key         : 2048 bits
            Modulus (n)        :
                00:c7:45:89:ab:cd:ef:12:34:56:78:9a:bc:de:f0:
                ... (256 bytes)
            Exponent (e)       : 65537 (0x010001)

    X509v3 Extensions (Extensions) :
        X509v3 Key Usage       : critical
            Digital Signature, Key Encipherment

        X509v3 Extended Key Usage :
            TLS Web Server Authentication

        X509v3 Basic Constraints : critical
            CA:FALSE

        X509v3 Subject Alternative Name :
            DNS:www.example.com
            DNS:example.com

        X509v3 Subject Key Identifier :
            A3:5F:7C:8D:9E:2B:4F:6A:1C:3D:5E:8F:B2:C4:D6:7A:9B:E3:F1:2C

        X509v3 Authority Key Identifier :
            keyid:14:2E:B3:17:B7:58:56:CB:AE:50:09:40:E6:1F:AF:9D:8B:14:C2:C6

        Authority Information Access :
            OCSP - URI:http://r3.o.lencr.org
            CA Issuers - URI:http://r3.i.lencr.org/

        X509v3 Certificate Policies :
            Policy: 2.23.140.1.2.1

        CT Precertificate SCTs :
            Signed Certificate Timestamp:
                Version   : v1 (0x0)
                Log ID    : 3F:17:4B:4F:D7:22:47:58:94:1D:65:1C:84:BE:0D:12:...
                Timestamp : Oct  1 13:00:00.123 2024 GMT
                Extensions: none
                Signature : ecdsa-with-SHA256
                            30:45:02:21:00:A3:...

    Signature Algorithm        : sha256WithRSAEncryption
    Signature Value            :
        3a:5f:7c:8d:9e:2b:4f:6a:1c:3d:5e:8f:b2:c4:d6:7a:9b:e3:
        ... (256 bytes)
}
```

### Champs principaux expliquÃ©s

#### Version

```
Version: 3 (0x2)

Versions :
- v1 (0x0) : Format de base (1988) - obsolÃ¨te
- v2 (0x1) : Ajout d'identifiants uniques (rare)
- v3 (0x2) : Ajout d'extensions - standard actuel

Quasiment tous les certificats modernes sont v3
```

#### Serial Number (NumÃ©ro de sÃ©rie)

```
Serial Number: 03:92:4a:1a:b3:5f:8f:80:a3:72:ac:f1:3d:b5:09:cf:08:22

PropriÃ©tÃ©s :
- Unique par CA (thÃ©oriquement)
- Jusqu'Ã  20 octets
- UtilisÃ© pour identifier le certificat
- NÃ©cessaire pour la rÃ©vocation (CRL, OCSP)

Exemple d'utilisation :
"RÃ©voquer le certificat sÃ©rie 0x03924a1ab35f..."
```

#### Signature Algorithm

```
Signature Algorithm: sha256WithRSAEncryption

Format : <hash>With<signature>

Algorithmes courants :
âœ“ sha256WithRSAEncryption (standard actuel)
âœ“ ecdsa-with-SHA256 (moderne, plus compact)
âœ“ ecdsa-with-SHA384
âœ“ sha384WithRSAEncryption

DÃ©prÃ©ciÃ© :
âœ— sha1WithRSAEncryption (SHA-1 cassÃ© depuis 2017)
âœ— md5WithRSAEncryption (MD5 cassÃ©)

Le mÃªme algorithme apparaÃ®t deux fois :
1. Dans l'en-tÃªte (annoncÃ©)
2. Ã€ la fin (signature rÃ©elle)
```

#### Issuer (Ã‰metteur)

```
Issuer: C=US, O=Let's Encrypt, CN=R3

Distinguished Name (DN) composÃ© de :
- C (Country) : Code pays ISO 3166
- O (Organization) : Nom de l'organisation
- OU (Organizational Unit) : DÃ©partement (optionnel)
- CN (Common Name) : Nom de la CA

Exemples de CA courantes :
- CN=DigiCert Global Root CA, O=DigiCert Inc, C=US
- CN=Let's Encrypt Authority X3, O=Let's Encrypt, C=US
- CN=GlobalSign Root CA, OU=Root CA, O=GlobalSign nv-sa, C=BE
```

#### Validity (PÃ©riode de validitÃ©)

```
Validity:
    Not Before: Oct  1 12:00:00 2024 GMT
    Not After : Dec 30 11:59:59 2024 GMT

RÃ¨gles :
- Certificat invalide AVANT "Not Before"
- Certificat invalide APRÃˆS "Not After"
- VÃ©rification Ã  chaque connexion

DurÃ©es maximales (2024) :
- DV/OV/EV : 398 jours (environ 13 mois)
- Anciennes rÃ¨gles : jusqu'Ã  5 ans
- Let's Encrypt : 90 jours (encourage automatisation)

ProblÃ¨me d'horloge :
Si l'horloge systÃ¨me est incorrecte :
â†’ Certificat peut sembler expirÃ© ou pas encore valide
â†’ Erreur de validation
```

#### Subject (Sujet)

```
Subject: CN=www.example.com

Identifie l'entitÃ© certifiÃ©e :
- Pour serveurs web : gÃ©nÃ©ralement juste CN=domaine
- Pour organisations : C, O, OU, CN complets

Exemples :
Serveur web simple :
  CN=www.example.com

Organisation :
  C=FR, ST=Ile-de-France, L=Paris, O=Example SAS, CN=www.example.com

Important :
Le CN est de moins en moins utilisÃ© pour la validation
â†’ Subject Alternative Name (SAN) dans extensions est prÃ©fÃ©rÃ©
```

#### Subject Public Key Info

```
Subject Public Key Info:
    Public Key Algorithm: rsaEncryption
    RSA Public Key: (2048 bit)
        Modulus:
            00:c7:45:89:ab:cd:ef:12:34:56:78:9a:bc:de:f0:
            12:23:34:45:56:67:78:89:9a:ab:bc:cd:de:ef:f0:
            ... (256 bytes total pour RSA 2048)
        Exponent: 65537 (0x10001)

La clÃ© publique du serveur !
â†’ UtilisÃ©e pour :
  - VÃ©rifier signatures (si certificat de signature)
  - Chiffrer (si RSA key exchange)
  - ECDH (si certificat ECDSA)

Algorithmes :
RSA :
  - Tailles : 2048 bits (minimum), 3072, 4096
  - Exposant : presque toujours 65537

ECDSA :
  - Courbes : P-256, P-384
  - ClÃ© : point sur courbe elliptique
  - Plus compact : 256 bits ECDSA â‰ˆ sÃ©curitÃ© RSA 3072 bits

EdDSA :
  - Ed25519, Ed448
  - Moderne, rapide
```

### Extensions X.509v3

Les extensions sont la partie la plus riche et la plus importante d'un certificat moderne.

#### Subject Alternative Name (SAN)

**L'extension la plus importante pour les certificats web.**

```
X509v3 Subject Alternative Name:
    DNS:www.example.com
    DNS:example.com
    DNS:*.example.com
    DNS:api.example.com
    IP Address:203.0.113.45
    Email:admin@example.com

UtilitÃ© :
- Permet un certificat pour MULTIPLES domaines
- Remplace le CN pour la validation de domaine
- Obligatoire depuis 2017 (browsers ignorent CN)

Types de SAN :
- DNS: Nom de domaine (le plus courant)
- IP Address: Adresse IP (rare, dÃ©conseillÃ©)
- Email: Adresse email (S/MIME)
- URI: URI gÃ©nÃ©rique

Wildcards :
*.example.com couvre :
  âœ“ www.example.com
  âœ“ api.example.com
  âœ“ mail.example.com
Mais PAS :
  âœ— example.com (domaine racine)
  âœ— sub.api.example.com (sous-sous-domaine)
```

**Exemple concret** :

```
Certificat pour un site avec plusieurs domaines :

SAN:
    DNS:example.com
    DNS:www.example.com
    DNS:shop.example.com
    DNS:blog.example.com

Un seul certificat couvre tous ces domaines !
Alternative : 4 certificats sÃ©parÃ©s (complexe Ã  gÃ©rer)
```

#### Key Usage

```
X509v3 Key Usage: critical
    Digital Signature, Key Encipherment

DÃ©finit l'usage autorisÃ© de la clÃ© :

Digital Signature :
  - Signer des donnÃ©es
  - Authentification serveur/client
  - NÃ©cessaire pour ECDHE

Key Encipherment :
  - Chiffrer des clÃ©s symÃ©triques
  - NÃ©cessaire pour RSA key exchange
  - Moins utilisÃ© avec TLS 1.3

Key Agreement :
  - Ã‰change de clÃ©s (DH, ECDH)

Certificate Sign :
  - Signer d'autres certificats
  - RÃ©servÃ© aux CA

CRL Sign :
  - Signer des listes de rÃ©vocation
  - RÃ©servÃ© aux CA

critical :
  - Extension critique = DOIT Ãªtre comprise
  - Si client ne comprend pas â†’ REJETER certificat
```

#### Extended Key Usage

```
X509v3 Extended Key Usage:
    TLS Web Server Authentication
    TLS Web Client Authentication

Usage applicatif spÃ©cifique :

TLS Web Server Authentication (1.3.6.1.5.5.7.3.1) :
  - Authentification serveur TLS/SSL
  - Certificat serveur web standard

TLS Web Client Authentication (1.3.6.1.5.5.7.3.2) :
  - Authentification client (client certificates)
  - Moins courant

Code Signing (1.3.6.1.5.5.7.3.3) :
  - Signature de code
  - Applications, drivers

Email Protection (1.3.6.1.5.5.7.3.4) :
  - S/MIME
  - Chiffrement email

Time Stamping (1.3.6.1.5.5.7.3.8) :
  - Horodatage cryptographique

OCSP Signing (1.3.6.1.5.5.7.3.9) :
  - RÃ©ponses OCSP
```

#### Basic Constraints

```
X509v3 Basic Constraints: critical
    CA:FALSE

Indique si le certificat est une CA :

CA:TRUE :
  - Certificat de CA
  - Peut signer d'autres certificats
  - Peut avoir pathlen (profondeur chaÃ®ne)

CA:FALSE :
  - Certificat end-entity (serveur/client)
  - NE PEUT PAS signer d'autres certificats
  - Certificat terminal

Exemple CA avec limite :
CA:TRUE, pathlen:0
â†’ Peut signer des certificats end-entity
â†’ Mais pas crÃ©er de CA intermÃ©diaires

critical :
â†’ Extension critique
â†’ EmpÃªche usage malveillant du certificat
```

#### Authority Information Access (AIA)

```
Authority Information Access:
    OCSP - URI:http://r3.o.lencr.org
    CA Issuers - URI:http://r3.i.lencr.org/

OCSP (Online Certificate Status Protocol) :
  - URL pour vÃ©rifier si certificat rÃ©voquÃ©
  - Client peut interroger en temps rÃ©el
  - Exemple :
    GET http://r3.o.lencr.org
    Certificat serial: 0x03924a...
    â†’ Response: Good / Revoked / Unknown

CA Issuers :
  - URL pour tÃ©lÃ©charger certificat de la CA Ã©mettrice
  - Utile si chaÃ®ne de certification incomplÃ¨te
  - Client peut rÃ©cupÃ©rer certificats intermÃ©diaires

Exemple d'utilisation :
curl -I http://r3.i.lencr.org/
â†’ TÃ©lÃ©charge certificat R3 (Let's Encrypt intermediate)
```

#### CRL Distribution Points

```
X509v3 CRL Distribution Points:
    Full Name:
      URI:http://crl3.digicert.com/DigiCertGlobalRootCA.crl

CRL (Certificate Revocation List) :
  - Liste de certificats rÃ©voquÃ©s
  - PubliÃ©e par la CA pÃ©riodiquement
  - Format : liste de numÃ©ros de sÃ©rie + dates

TÃ©lÃ©chargement :
wget http://crl3.digicert.com/DigiCertGlobalRootCA.crl

Analyse :
openssl crl -in DigiCertGlobalRootCA.crl -inform DER -text

Contenu :
Certificate Revocation List (CRL):
    Version 2 (0x1)
    Signature Algorithm: sha256WithRSAEncryption
    Issuer: CN=DigiCert Global Root CA
    Last Update: Nov 15 12:00:00 2024 GMT
    Next Update: Dec 15 12:00:00 2024 GMT
    Revoked Certificates:
        Serial Number: 03924A1AB35F8F80A372ACF13DB509CF0822
            Revocation Date: Oct 15 14:23:45 2024 GMT
        Serial Number: 0F3C84D567E291A2B4C73FE8901DA65C
            Revocation Date: Nov 01 09:12:33 2024 GMT
        ...

ProblÃ¨mes :
âœ— Taille croissante (peut atteindre plusieurs MB)
âœ— Mise Ã  jour pÃ©riodique (pas en temps rÃ©el)
âœ— TÃ©lÃ©chargement peut Ãªtre lent
â†’ OCSP prÃ©fÃ©rÃ©
```

#### Certificate Transparency (CT)

```
CT Precertificate SCTs:
    Signed Certificate Timestamp:
        Version   : v1 (0x0)
        Log ID    : 3F:17:4B:4F:D7:22:47:58:94:1D:65:1C:84:BE:0D:12:...
        Timestamp : Oct  1 13:00:00.123 2024 GMT
        Extensions: none
        Signature : ecdsa-with-SHA256
                    30:45:02:21:00:A3:5F:7C:8D:...

Certificate Transparency (RFC 6962) :
- Logs publics de TOUS les certificats Ã©mis
- Objectif : dÃ©tecter Ã©missions frauduleuses
- Obligatoire pour certificats publics (navigateurs)

Fonctionnement :
1. CA soumet certificat Ã  logs CT (publics)
2. Log retourne SCT (Signed Certificate Timestamp)
3. CA inclut SCT dans certificat
4. Navigateur vÃ©rifie prÃ©sence de SCTs
5. Si absent â†’ Avertissement (Chrome, Safari)

Logs CT publics :
- Google (Argon, Xenon, etc.)
- Cloudflare
- DigiCert
- Let's Encrypt

UtilitÃ© :
- DÃ©tection rapide de certificats malveillants
- Surveillance de domaine
- Exemple : Certificate Transparency monitoring
  â†’ Alerte si certificat Ã©mis pour mon domaine
  â†’ DÃ©tection de phishing/typosquatting

Rechercher :
https://crt.sh/?q=example.com
â†’ Tous les certificats publics pour example.com
```

## La PKI (Public Key Infrastructure)

### Composants de la PKI

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Root CA    â”‚
                    â”‚ (Racine)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Signe
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚Intermediate â”‚
                    â”‚     CA      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Signe
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ End-Entity  â”‚
                    â”‚Certificate  â”‚
                    â”‚(www.ex.com) â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Autres composants :

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Registration  â”‚       â”‚ Validation   â”‚
â”‚  Authority    â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚  Authority   â”‚
â”‚     (RA)      â”‚       â”‚     (VA)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Certificate  â”‚
            â”‚  Repository   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Root CA (AutoritÃ© Racine)

```
RÃ´le :
- Sommet de la hiÃ©rarchie de confiance
- Signe les certificats intermÃ©diaires
- ClÃ© privÃ©e extrÃªmement protÃ©gÃ©e

CaractÃ©ristiques :
- Certificat auto-signÃ© (Issuer = Subject)
- ValiditÃ© trÃ¨s longue (10-30 ans)
- Hors ligne (air-gapped) pour sÃ©curitÃ©
- UtilisÃ© rarement (signatures intermÃ©diaires)

Exemple - DigiCert Global Root CA :
Subject: CN=DigiCert Global Root CA, OU=www.digicert.com, O=DigiCert Inc, C=US
Issuer: CN=DigiCert Global Root CA, ... (mÃªme que Subject)
Validity: Not Before: Nov 10 00:00:00 2006 GMT
          Not After : Nov 10 00:00:00 2031 GMT (25 ans !)

SÃ©curitÃ© :
- ClÃ© privÃ©e dans HSM (Hardware Security Module)
- AccÃ¨s physique ultra-restreint
- CÃ©rÃ©monie de signature (multiples personnes)
- Si compromise â†’ CATASTROPHE
  â†’ Tous les certificats dÃ©rivÃ©s invalides
  â†’ Retrait du trust store des navigateurs
```

#### Intermediate CA (AutoritÃ© IntermÃ©diaire)

```
RÃ´le :
- Signe les certificats end-entity
- ProtÃ¨ge la Root CA (isolation)
- Peut Ãªtre rÃ©voquÃ©e sans affecter Root

Avantages :
- Si compromise â†’ RÃ©vocation de l'intermediate seulement
- Root CA reste intacte
- Nouvelle intermediate peut Ãªtre Ã©mise

Exemple - Let's Encrypt R3 :
Subject: CN=R3, O=Let's Encrypt, C=US
Issuer: CN=ISRG Root X1, O=Internet Security Research Group, C=US
Validity: Not After: Sep 15 16:00:00 2025 GMT (durÃ©e ~5 ans)

ChaÃ®ne typique :
DigiCert Global Root CA
  â””â”€ DigiCert SHA2 Secure Server CA
      â””â”€ www.example.com

Let's Encrypt :
ISRG Root X1
  â””â”€ R3
      â””â”€ www.example.com
```

#### Registration Authority (RA)

```
RÃ´le :
- Interface entre utilisateurs et CA
- VÃ©rifie identitÃ© des demandeurs
- Valide les demandes de certificats
- Ne signe PAS les certificats (dÃ©lÃ¨gue Ã  CA)

Processus :
1. Utilisateur soumet demande (CSR)
2. RA vÃ©rifie identitÃ©
   - DV : ContrÃ´le domaine (email, DNS, HTTP)
   - OV : VÃ©rif organisation (documents, DUNS)
   - EV : VÃ©rif approfondie (juridique, physique)
3. RA approuve ou rejette
4. Si approuvÃ© â†’ Transmis Ã  CA
5. CA signe et Ã©met certificat

Exemples :
- Revendeurs de certificats (Sectigo resellers)
- DÃ©partements IT internes (PKI d'entreprise)
```

#### Validation Authority (VA)

```
RÃ´le :
- VÃ©rifie le statut de rÃ©vocation des certificats
- RÃ©pond aux requÃªtes OCSP
- Maintient les CRL

Services fournis :
OCSP Responder :
  Client â†’ "Certificat sÃ©rie 0x123 rÃ©voquÃ© ?"
  VA â†’ "Good" / "Revoked" / "Unknown"

CRL Distribution :
  VA â†’ Publie CRL mis Ã  jour
  Client â†’ TÃ©lÃ©charge CRL pÃ©riodiquement
```

### HiÃ©rarchies de certification

#### HiÃ©rarchie simple (2 niveaux)

```
Root CA
  â””â”€ End-Entity Certificates

Avantages :
+ Simple
+ Moins de latence de validation

InconvÃ©nients :
- Root CA doit Ãªtre en ligne (risque)
- Pas d'isolation en cas de compromission
- Rarement utilisÃ© en production
```

#### HiÃ©rarchie Ã  3 niveaux (standard)

```
Root CA (offline)
  â””â”€ Intermediate CA (online)
      â””â”€ End-Entity Certificates

Avantages :
+ Root CA protÃ©gÃ©e (offline)
+ Intermediate rÃ©vocable sans affecter Root
+ Ã‰quilibre sÃ©curitÃ©/praticitÃ©

Standard pour :
- Let's Encrypt
- DigiCert
- GlobalSign
- Sectigo
```

#### HiÃ©rarchie Ã  4+ niveaux (entreprise)

```
Root CA (offline, 30 ans)
  â””â”€ Policy CA (offline, 15 ans)
      â””â”€ Issuing CA (online, 5 ans)
          â””â”€ End-Entity (1-2 ans)

UtilisÃ© par :
- Grandes entreprises
- Gouvernements
- Infrastructures critiques

Permet :
- SÃ©paration par politique (OV, EV)
- SÃ©paration gÃ©ographique
- SÃ©paration par usage (serveur, client, code signing)
```

#### Cross-signing

```
Root CA A                    Root CA B
    â”‚                            â”‚
    â”‚ Signe                      â”‚ Signe
    â†“                            â†“
Intermediate CA C â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ Signe
    â†“
End-Entity Certificate

L'intermediate est signÃ© par DEUX root CAs !

UtilitÃ© :
- CompatibilitÃ© avec anciens systÃ¨mes
- Migration vers nouvelle root CA
- Redondance

Exemple rÃ©el - Let's Encrypt :
IdenTrust Root (largement installÃ©)
  â””â”€ Let's Encrypt X3
      â””â”€ www.example.com

ISRG Root X1 (nouveau)
  â””â”€ Let's Encrypt X3 (mÃªme intermediate !)
      â””â”€ www.example.com

RÃ©sultat :
- Appareils rÃ©cents : valident via ISRG Root X1
- Appareils anciens : valident via IdenTrust Root
â†’ CompatibilitÃ© maximale
```

## AutoritÃ©s de Certification majeures

### CAs publiques de confiance

#### Let's Encrypt

```
Fondation : 2016
Organisation : Internet Security Research Group (ISRG)
Philosophie : HTTPS gratuit pour tous

Statistiques (2024) :
- >500 millions de certificats actifs
- ~90% des nouveaux certificats web
- Gratuit et automatisÃ© (ACME)

CaractÃ©ristiques :
âœ“ DV uniquement (pas OV/EV)
âœ“ ValiditÃ© 90 jours (encourage automatisation)
âœ“ Limite : 50 certificats/domaine/semaine
âœ“ Wildcards supportÃ©s
âœ“ ACME protocol (RFC 8555)

Root/Intermediate :
ISRG Root X1 (RSA 4096)
  â””â”€ R3 (RSA 2048)
  â””â”€ R4 (RSA 2048)

ISRG Root X2 (ECDSA P-384)
  â””â”€ E1 (ECDSA P-384)
  â””â”€ E2 (ECDSA P-384)

Impact :
- A rÃ©volutionnÃ© l'industrie SSL/TLS
- Adoption HTTPS passÃ©e de 40% Ã  95%+
- ForcÃ© CAs commerciales Ã  amÃ©liorer offres
```

#### DigiCert

```
Fondation : 2003
Position : Leader commercial

Offres :
- DV, OV, EV
- Wildcards
- Multi-domain (SAN)
- Code signing
- S/MIME
- IoT

Prix :
- DV : ~200-300â‚¬/an
- OV : ~500-800â‚¬/an
- EV : ~1000-2000â‚¬/an

Services :
+ Support 24/7
+ Garantie financiÃ¨re ($1M-$1.75M)
+ Outils de gestion centralisÃ©e
+ API d'automatisation

Clients :
- Entreprises
- Gouvernements
- Finance/Banques
```

#### Sectigo (ex-Comodo)

```
Fondation : 1998 (Comodo), renommÃ© Sectigo 2018
Part de marchÃ© : ~35% des certificats SSL

Offres :
- Large gamme DV/OV/EV
- Prix compÃ©titifs
- Revente autorisÃ©e

Prix :
- DV : ~50-150â‚¬/an
- OV : ~200-400â‚¬/an
- EV : ~300-800â‚¬/an

Connu pour :
- Volume Ã©levÃ©
- Programme revendeurs actif
- Automatisation (ACME supportÃ©)
```

#### GlobalSign

```
Fondation : 1996
Position : CA europÃ©enne Ã©tablie

SpÃ©cialitÃ©s :
- IoT (certificats pour appareils)
- PKI managed services
- Support enterprise

Services uniques :
- GlobalSign Atlas (plateforme IoT)
- Automated Certificate Management
- Cloud-based PKI
```

### CAs privÃ©es (entreprise)

```
PKI interne d'entreprise :

Exemple - Microsoft Active Directory Certificate Services :

Root CA (offline)
  DC=com, DC=example, CN=Example Root CA

Intermediate CA (online)
  CN=Example Issuing CA

Usage :
- Certificats serveurs internes
- Authentification utilisateurs
- Signature de code interne
- Chiffrement email

Avantages :
+ ContrÃ´le total
+ Gratuit (aprÃ¨s infrastructure)
+ IntÃ©gration AD

InconvÃ©nients :
- Non reconnu publiquement
- NÃ©cessite distribution trust store
- Maintenance complexe
```

## Types de validation de certificats

### Domain Validation (DV)

**Validation** : ContrÃ´le du domaine uniquement.

```
Processus de validation :

MÃ©thode 1 - Email :
1. CA envoie email Ã  :
   - admin@example.com
   - webmaster@example.com
   - hostmaster@example.com
   - postmaster@example.com
2. Email contient lien de validation
3. Clic sur lien â†’ domaine validÃ©

MÃ©thode 2 - HTTP :
1. CA gÃ©nÃ¨re token alÃ©atoire
2. Demandeur place fichier :
   http://example.com/.well-known/acme-challenge/<token>
3. CA vÃ©rifie prÃ©sence du fichier
4. â†’ Domaine validÃ©

MÃ©thode 3 - DNS :
1. CA gÃ©nÃ¨re token
2. Demandeur crÃ©e record DNS :
   _acme-challenge.example.com. TXT "<token>"
3. CA interroge DNS
4. â†’ Domaine validÃ©

Temps : Quelques minutes (automatisÃ©)
CoÃ»t : Gratuit (Let's Encrypt) Ã  ~50â‚¬
Affichage : Cadenas standard
```

**Certificat DV** :

```
Subject: CN=www.example.com

Extensions :
  X509v3 Extended Key Usage:
    TLS Web Server Authentication
  X509v3 Subject Alternative Name:
    DNS:www.example.com, DNS:example.com

Certificat indique :
âœ“ Le demandeur contrÃ´le le domaine
âœ— Rien sur l'identitÃ© de l'organisation
âœ— Pas de vÃ©rification lÃ©gale/physique
```

**Usage recommandÃ©** :

```
âœ“ Sites personnels
âœ“ Blogs
âœ“ Applications web
âœ“ APIs
âœ“ Services internes

Limite :
- Pas d'info sur l'organisation
- Phishing possible (attaquant peut obtenir DV)
  Exemple : www.paypaI.com (I majuscule au lieu de l)
```

### Organization Validation (OV)

**Validation** : Domaine + IdentitÃ© de l'organisation.

```
Processus :

1. Validation du domaine (comme DV)

2. Validation de l'organisation :
   - Nom lÃ©gal de l'entreprise
   - Adresse physique
   - Existence juridique vÃ©rifiÃ©e
   - NumÃ©ro d'enregistrement (DUNS, SIRET, etc.)

3. VÃ©rification par CA :
   - Bases de donnÃ©es publiques
   - Registres commerciaux
   - Appel tÃ©lÃ©phonique au numÃ©ro public
   - Documents officiels

Temps : 1-3 jours ouvrÃ©s
CoÃ»t : 200-800â‚¬/an
```

**Certificat OV** :

```
Subject:
    CN=www.example.com
    O=Example Inc
    L=San Francisco
    ST=California
    C=US

Informations incluses :
âœ“ Nom de l'organisation
âœ“ Localisation (ville, Ã©tat, pays)
âœ“ Domaine validÃ©

Affichage navigateur :
- Clic sur cadenas â†’ Info organisation visible
- Pas de diffÃ©rence visuelle vs DV (barre verte supprimÃ©e)
```

**Usage recommandÃ©** :

```
âœ“ Sites d'entreprise
âœ“ E-commerce
âœ“ Services B2B
âœ“ Intranets d'entreprise

Avantages vs DV :
+ IdentitÃ© vÃ©rifiÃ©e
+ Plus de confiance pour utilisateurs avertis
+ Protection contre certains phishing
```

### Extended Validation (EV)

**Validation** : VÃ©rification juridique et opÃ©rationnelle approfondie.

```
Processus (Guidelines CA/Browser Forum) :

1. Validation du domaine

2. Validation de l'organisation :
   - Existence lÃ©gale (registre commerce)
   - Statut actif (pas en faillite, dissolution)
   - Adresse physique opÃ©rationnelle
   - NumÃ©ro de tÃ©lÃ©phone vÃ©rifiÃ©

3. Validation de l'autoritÃ© :
   - Personne autorisÃ©e Ã  demander certificat
   - VÃ©rification identitÃ© individu
   - Accord contract signing

4. Documents requis :
   - Extrait Kbis (France) / Articles of Incorporation
   - Justificatif d'adresse
   - Pouvoir de signature
   - ID du signataire

Temps : 1-2 semaines
CoÃ»t : 500-2000â‚¬/an
```

**Certificat EV** :

```
Subject:
    serialNumber=5299537-6
    businessCategory=Private Organization
    jurisdictionC=US
    jurisdictionST=Delaware
    CN=www.example.com
    O=Example Inc
    L=San Francisco
    ST=California
    C=US

Extensions additionnelles :
  Subject Directory Attributes:
    1.3.6.1.4.1.311.60.2.1.1: Delaware (jurisdiction)
    1.3.6.1.4.1.311.60.2.1.2: US
    1.3.6.1.4.1.311.60.2.1.3: Private Organization
```

**Affichage historique** :

```
Avant 2019 :
- Barre d'adresse VERTE
- Nom de l'organisation affichÃ©
- Haute visibilitÃ©

Depuis 2019 (Chrome, Firefox, Safari) :
- Plus de barre verte
- Clic sur cadenas â†’ Infos organisation
- Pas de diffÃ©rence visuelle vs DV/OV

Raison du changement :
- Ã‰tudes : utilisateurs ne remarquaient pas
- CoÃ»t Ã©levÃ© pour bÃ©nÃ©fice limitÃ©
- Phishing restait possible (autres domaines)
```

**Usage actuel** :

```
DÃ©clin de l'EV :
- Beaucoup d'entreprises migrent vers OV ou DV
- CoÃ»t/bÃ©nÃ©fice dÃ©favorable
- Navigateurs ne le valorisent plus

Encore utilisÃ© par :
- Banques (politique de sÃ©curitÃ©)
- Grandes entreprises (compliance)
- Sites haute sÃ©curitÃ©

Avenir incertain :
- Peut-Ãªtre obsolÃ¨te dans quelques annÃ©es
- Focus sur autres indicateurs de confiance
```

### Comparaison des types de validation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚CritÃ¨re       â”‚   DV    â”‚   OV   â”‚   EV   â”‚Wildcard        â”‚SAN     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Validation    â”‚Domaine  â”‚Domaine â”‚Domaine â”‚Domaine         â”‚Domaine â”‚
â”‚              â”‚         â”‚+Org    â”‚+Org    â”‚                â”‚(Ã—N)    â”‚
â”‚              â”‚         â”‚        â”‚+LÃ©gal  â”‚                â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Temps         â”‚Minutes  â”‚1-3 j   â”‚1-2 sem â”‚Selon DV/OV/EV  â”‚Selon   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚CoÃ»t          â”‚Gratuit  â”‚200-800â‚¬â”‚500-2kâ‚¬ â”‚Ã—1.5-2 prix baseâ”‚Variableâ”‚
â”‚(annuel)      â”‚-50â‚¬     â”‚        â”‚        â”‚                â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Info          â”‚Domaine  â”‚+Org    â”‚+LÃ©gal  â”‚*.domain        â”‚Multi   â”‚
â”‚certificat    â”‚         â”‚+Lieu   â”‚+Serial â”‚                â”‚domainesâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Affichage     â”‚Cadenas  â”‚Cadenas â”‚Cadenas â”‚Cadenas         â”‚Cadenas â”‚
â”‚navigateur    â”‚         â”‚        â”‚(ex-vertâ”‚                â”‚        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Usage         â”‚Sites    â”‚Entre-  â”‚Banques â”‚Sous-domaines   â”‚Multi-  â”‚
â”‚recommandÃ©    â”‚standard â”‚prises  â”‚Finance â”‚multiples       â”‚domainesâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Protection    â”‚Base     â”‚Bonne   â”‚Maximaleâ”‚Selon type      â”‚Selon   â”‚
â”‚phishing      â”‚         â”‚        â”‚        â”‚                â”‚type    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## RÃ©vocation de certificats

### Raisons de rÃ©vocation

```
Motifs de rÃ©vocation (RFC 5280) :

unspecified (0) :
  - Raison non spÃ©cifiÃ©e

keyCompromise (1) :
  - ClÃ© privÃ©e compromise
  - URGENT - rÃ©vocation immÃ©diate

cACompromise (2) :
  - CA compromise
  - CRITIQUE - tous certificats affectÃ©s

affiliationChanged (3) :
  - Organisation a changÃ©
  - EmployÃ© a quittÃ© l'entreprise

superseded (4) :
  - RemplacÃ© par nouveau certificat
  - Mise Ã  jour normale

cessationOfOperation (5) :
  - Service arrÃªtÃ©
  - Domaine abandonnÃ©

certificateHold (6) :
  - Suspension temporaire
  - Peut Ãªtre rÃ©voquÃ©e (removeFromCRL)

removeFromCRL (8) :
  - Retrait de suspension (certificateHold)

privilegeWithdrawn (9) :
  - PrivilÃ¨ges retirÃ©s

aACompromise (10) :
  - Attribute Authority compromise
```

### CRL (Certificate Revocation List)

**Format et structure** :

```
Certificate Revocation List (CRL):
    Version: 2 (0x1)
    Signature Algorithm: sha256WithRSAEncryption
    Issuer: CN=Example CA
    Last Update: Dec 6 12:00:00 2024 GMT
    Next Update: Dec 13 12:00:00 2024 GMT
    CRL extensions:
        X509v3 Authority Key Identifier:
            keyid:14:2E:B3:17:...
        X509v3 CRL Number:
            1234
    Revoked Certificates:
        Serial Number: 03924A1AB35F8F80A372ACF13DB509CF0822
            Revocation Date: Dec 1 14:23:45 2024 GMT
            CRL entry extensions:
                X509v3 CRL Reason Code:
                    Key Compromise
        Serial Number: 0F3C84D567E291A2B4C73FE8901DA65C
            Revocation Date: Nov 25 09:12:33 2024 GMT
        Serial Number: 7B2D9A1F3C8E4B6D5A7C8D9EAFC5B3D4
            Revocation Date: Nov 30 16:45:12 2024 GMT
    Signature Algorithm: sha256WithRSAEncryption
         3a:5f:7c:8d:9e:2b:...
```

**TÃ©lÃ©chargement et vÃ©rification** :

```bash
# TÃ©lÃ©charger CRL
wget http://crl.example.com/example-ca.crl

# Convertir DER â†’ PEM
openssl crl -inform DER -in example-ca.crl -outform PEM -out example-ca-crl.pem

# Afficher contenu
openssl crl -in example-ca-crl.pem -text -noout

# VÃ©rifier si certificat rÃ©voquÃ©
openssl verify -crl_check -CRLfile example-ca-crl.pem certificate.pem
```

**ProblÃ¨mes avec CRL** :

```
Limitations :

1. Taille croissante :
   - Grande CA : CRL de plusieurs MB
   - Millions de certificats rÃ©voquÃ©s
   - TÃ©lÃ©chargement lent

2. Mise Ã  jour pÃ©riodique :
   - Next Update : 7 jours typiquement
   - Certificat rÃ©voquÃ© reste "valide" jusqu'Ã  prochaine CRL
   - FenÃªtre de vulnÃ©rabilitÃ©

3. Charge rÃ©seau :
   - Chaque client tÃ©lÃ©charge CRL complÃ¨te
   - Bande passante significative pour CA

4. Cache :
   - Clients cachent CRL (Next Update)
   - RÃ©vocation urgente pas visible immÃ©diatement

5. Privacy :
   - Client rÃ©vÃ¨le quels certificats il vÃ©rifie
   - IP client exposÃ©e Ã  la CA

Exemple problÃ©matique :
Compromission clÃ© privÃ©e : 1er dÃ©cembre
Prochaine CRL : 7 dÃ©cembre
â†’ 6 jours de fenÃªtre d'exploitation !
```

### OCSP (Online Certificate Status Protocol)

**Principe** :

```
Au lieu de tÃ©lÃ©charger liste complÃ¨te :
â†’ Demander statut d'UN certificat spÃ©cifique

OCSP Request:
    Cert ID:
        Hash Algorithm: SHA1
        Issuer Name Hash: a3f5c8d9e1b4...
        Issuer Key Hash: b2e7d3f9a8c6...
        Serial Number: 0x03924a1ab35f8f80a372acf13db509cf0822

OCSP Response:
    Response Status: successful
    Response Type: Basic OCSP Response
    Version: 1 (0x0)
    Responder ID: CN=Example OCSP Responder
    Produced At: Dec 6 14:30:45 2024 GMT
    Responses:
        Certificate ID:
            Serial Number: 0x03924a1ab35f8f80a372acf13db509cf0822
        Cert Status: good
        This Update: Dec 6 14:30:00 2024 GMT
        Next Update: Dec 6 15:30:00 2024 GMT
    Signature Algorithm: sha256WithRSAEncryption
```

**RequÃªte OCSP** :

```bash
# Extraire URL OCSP du certificat
openssl x509 -in cert.pem -noout -ocsp_uri
# Output: http://ocsp.example.com

# Faire requÃªte OCSP
openssl ocsp \
    -issuer issuer.pem \
    -cert cert.pem \
    -url http://ocsp.example.com \
    -CAfile root.pem

# RÃ©sultat :
# Response verify OK
# cert.pem: good
# This Update: Dec 6 14:30:00 2024 GMT
# Next Update: Dec 6 15:30:00 2024 GMT
```

**Statuts OCSP** :

```
good (0) :
  - Certificat valide
  - Pas rÃ©voquÃ©

revoked (1) :
  - Certificat rÃ©voquÃ©
  - Raison et date incluses

unknown (2) :
  - Statut inconnu
  - OCSP responder ne connaÃ®t pas ce certificat
  - ProblÃ¨me : client doit dÃ©cider quoi faire
```

**ProblÃ¨mes OCSP** :

```
Limitations :

1. Latence :
   - RequÃªte rÃ©seau supplÃ©mentaire Ã  chaque connexion
   - 50-500ms de dÃ©lai
   - Impact UX significatif

2. Privacy :
   - CA sait quels sites vous visitez
   - IP client exposÃ©e
   - Tracking potentiel

3. DisponibilitÃ© :
   - Si OCSP responder down : quoi faire ?
     a) Soft-fail : Continuer (par dÃ©faut navigateurs) âœ— Risque
     b) Hard-fail : Refuser connexion âœ“ SÃ©curisÃ© mais UX mauvais

4. Charge serveur :
   - CA doit maintenir OCSP responders haute disponibilitÃ©
   - RequÃªte pour chaque connexion TLS
   - CoÃ»t infrastructure

Exemple problÃ¨me disponibilitÃ© :
2019 : OCSP responder Let's Encrypt down 4 heures
â†’ Pas d'impact majeur (soft-fail)
â†’ Mais certificats rÃ©voquÃ©s restaient "valides"
```

### OCSP Stapling

**Solution Ã©lÃ©gante** : Le serveur obtient la rÃ©ponse OCSP et l'inclut dans le handshake TLS.

```
Sans stapling :

Client â†’ ServerHello, Certificate
Client â†’ RequÃªte OCSP vers CA
CA â†’ RÃ©ponse OCSP
Client â†’ VÃ©rifie rÃ©ponse, continue handshake
â†’ 1 RTT supplÃ©mentaire

Avec stapling :

Serveur (pÃ©riodiquement) :
  â†’ RequÃªte OCSP pour son propre certificat
  â† RÃ©ponse OCSP signÃ©e par CA
  â†’ Cache rÃ©ponse OCSP

Client â†’ ServerHello, Certificate + OCSP Response stapled
Client â†’ VÃ©rifie rÃ©ponse OCSP incluse, continue
â†’ 0 RTT supplÃ©mentaire !
```

**Configuration** :

```nginx
# Nginx
ssl_stapling on;
ssl_stapling_verify on;
ssl_trusted_certificate /path/to/chain.pem;

# Resolver pour requÃªtes DNS (trouver OCSP responder)
resolver 8.8.8.8 8.8.4.4 valid=300s;
resolver_timeout 5s;

# VÃ©rifier stapling actif
echo | openssl s_client -connect example.com:443 -status
# Doit afficher "OCSP Response Status: successful"
```

**Avantages OCSP Stapling** :

```
Pour le client :
âœ“ Pas de requÃªte OCSP (latence rÃ©duite)
âœ“ Pas de rÃ©vÃ©lation de sites visitÃ©s (privacy)
âœ“ Fonctionne mÃªme si OCSP responder down

Pour le serveur :
âœ“ ContrÃ´le sur timing des requÃªtes OCSP
âœ“ Cache des rÃ©ponses OCSP (rÃ©duit charge CA)
âœ“ Meilleure UX (plus rapide)

Pour la CA :
âœ“ Moins de charge (serveurs font requÃªtes, pas chaque client)
âœ“ Bande passante rÃ©duite

Adoption (2024) :
- ~70% des sites majeurs
- SupportÃ© par tous navigateurs modernes
- RecommandÃ© par toutes best practices
```

### Certificate Transparency et rÃ©vocation

```
CT n'est PAS un mÃ©canisme de rÃ©vocation
MAIS aide Ã  dÃ©tecter rapidement certificats malveillants

Workflow :

1. Surveillance :
   - Entreprise monitore logs CT pour son domaine
   - Alerte si certificat Ã©mis

2. DÃ©tection :
   - Certificat non autorisÃ© dÃ©tectÃ©
   - Exemple : phishing site obtient certificat

3. Action :
   - Contacte CA pour rÃ©vocation urgente
   - CA rÃ©voque en quelques heures

4. Propagation :
   - CRL/OCSP mis Ã  jour
   - Certificat malveillant rÃ©voquÃ©

Outils de monitoring :
- crt.sh (gratuit)
- Facebook Certificate Transparency Monitoring
- SSLMate Cert Spotter
- Services commerciaux (DigiCert, Sectigo)
```

## Let's Encrypt et ACME

### Protocole ACME (RFC 8555)

**ACME** = Automatic Certificate Management Environment

```
Philosophie :
- Automatisation complÃ¨te
- Zero-touch certificate lifecycle
- Pas d'intervention humaine

Workflow ACME :

1. Account Creation :
   Client â†’ POST /acme/new-account
          {email, termsOfServiceAgreed: true}
   ACME Server â†’ Account URL + account key

2. Order Creation :
   Client â†’ POST /acme/new-order
          {identifiers: [{type: "dns", value: "example.com"}]}
   ACME Server â†’ Order object + authorizations

3. Authorization :
   Pour chaque domaine :
   Client â†’ GET /acme/authz/<id>
   ACME Server â†’ Challenges disponibles

   Challenges types :
   - http-01 : Fichier HTTP
   - dns-01 : Record DNS TXT
   - tls-alpn-01 : TLS extension

4. Challenge Completion :
   Client â†’ DÃ©ploie challenge (fichier, DNS record, etc.)
   Client â†’ POST /acme/challenge/<id> {}
   ACME Server â†’ VÃ©rifie challenge
   ACME Server â†’ Authorization status: valid

5. Finalize Order :
   Client â†’ GÃ©nÃ¨re CSR
   Client â†’ POST /acme/order/<id>/finalize {csr: "..."}
   ACME Server â†’ Ã‰met certificat

6. Download Certificate :
   Client â†’ GET /acme/cert/<id>
   ACME Server â†’ Certificat PEM

Temps total : Quelques secondes Ã  quelques minutes
```

### Challenges ACME

#### HTTP-01 Challenge

```
Principe : Prouver contrÃ´le du serveur web sur port 80.

1. ACME Server gÃ©nÃ¨re token :
   token = "LoqXcYV8q5ONbJQxbmR7SCTNo3tiAXDfowyjxAjEuX0"

2. Client calcule key authorization :
   key_authz = token + "." + base64url(SHA256(account_key))
   = "LoqXcYV8...EuX0.9jg46WB3rR_AHD-EBXdN7cBkH1WOu0tA3M9fm21mqTI"

3. Client place fichier :
   http://example.com/.well-known/acme-challenge/LoqXcYV8...EuX0
   Contenu : 9jg46WB3rR_AHD-EBXdN7cBkH1WOu0tA3M9fm21mqTI

4. ACME Server vÃ©rifie :
   GET http://example.com/.well-known/acme-challenge/<token>
   VÃ©rifie contenu = key_authz calculÃ©

5. Si OK â†’ Authorization valid

Avantages :
+ Simple
+ Pas besoin accÃ¨s DNS

InconvÃ©nients :
- NÃ©cessite port 80 accessible
- Pas de wildcards
- ProblÃ©matique si load balancer/CDN
```

#### DNS-01 Challenge

```
Principe : Prouver contrÃ´le du DNS du domaine.

1. ACME Server gÃ©nÃ¨re token

2. Client calcule :
   key_authz = token + "." + thumbprint(account_key)
   digest = base64url(SHA256(key_authz))

3. Client crÃ©e record DNS :
   _acme-challenge.example.com. 300 IN TXT "digest"

4. ACME Server vÃ©rifie :
   DNS query: _acme-challenge.example.com TXT
   VÃ©rifie valeur = digest calculÃ©

5. Si OK â†’ Authorization valid

Avantages :
+ Supporte wildcards (*.example.com)
+ Pas besoin serveur web accessible
+ Fonctionne derriÃ¨re firewall

InconvÃ©nients :
- NÃ©cessite accÃ¨s API DNS (ou manuel)
- Propagation DNS peut prendre du temps
- Plus complexe Ã  automatiser

Exemple wildcard :
Certificat pour *.example.com :
â†’ DNS-01 challenge obligatoire
â†’ http-01 ne supporte pas wildcards
```

#### TLS-ALPN-01 Challenge

```
Principe : Extension TLS spÃ©ciale sur port 443.

1. ACME Server gÃ©nÃ¨re token

2. Client configure serveur TLS :
   - Ã‰coute sur port 443
   - ALPN extension "acme-tls/1"
   - Certificat auto-signÃ© avec :
     Subject: CN=example.com
     Extension acmeIdentifier: digest

3. ACME Server se connecte :
   TLS handshake avec ALPN "acme-tls/1"
   VÃ©rifie certificat contient bon digest

4. Si OK â†’ Authorization valid

Avantages :
+ Pas besoin port 80
+ Fonctionne si port 80 filtrÃ©
+ Rapide (pas de DNS)

InconvÃ©nients :
- NÃ©cessite control port 443
- Plus complexe Ã  implÃ©menter
- Moins utilisÃ© (http-01 prÃ©fÃ©rÃ©)
```

### Certbot : le client ACME de rÃ©fÃ©rence

**Installation** :

```bash
# Ubuntu/Debian
apt-get install certbot python3-certbot-nginx

# CentOS/RHEL
yum install certbot python3-certbot-nginx

# macOS
brew install certbot
```

**Utilisation basique** :

```bash
# Obtenir certificat et configurer Nginx automatiquement
certbot --nginx -d www.example.com -d example.com

# Processus :
# 1. DÃ©tecte configuration Nginx
# 2. Demande certificat via ACME
# 3. ComplÃ¨te challenge http-01
# 4. Obtient certificat
# 5. Modifie configuration Nginx
# 6. Recharge Nginx
# 7. Configure renouvellement automatique

# RÃ©sultat :
# Successfully deployed certificate for www.example.com to /etc/nginx/sites-enabled/default
# Congratulations! Your certificate and chain have been saved at:
#    /etc/letsencrypt/live/www.example.com/fullchain.pem
#    /etc/letsencrypt/live/www.example.com/privkey.pem
```

**Mode standalone** :

```bash
# Sans serveur web existant
# Certbot lance son propre serveur temporaire
certbot certonly --standalone -d example.com

# ArrÃªte serveur web temporairement
systemctl stop nginx
certbot certonly --standalone -d example.com
systemctl start nginx
```

**Mode webroot** :

```bash
# Serveur web dÃ©jÃ  actif
# Place fichiers dans webroot
certbot certonly --webroot -w /var/www/html -d example.com

# Configuration manuelle Nginx aprÃ¨s :
server {
    listen 443 ssl;
    server_name example.com;

    ssl_certificate /etc/letsencrypt/live/example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/example.com/privkey.pem;

    # ...
}
```

**DNS challenge avec plugins** :

```bash
# Cloudflare
pip install certbot-dns-cloudflare

# Configuration /root/.secrets/cloudflare.ini :
dns_cloudflare_api_token = your_api_token

chmod 600 /root/.secrets/cloudflare.ini

# Obtenir wildcard
certbot certonly \
    --dns-cloudflare \
    --dns-cloudflare-credentials /root/.secrets/cloudflare.ini \
    -d example.com \
    -d *.example.com

# Route53 (AWS)
pip install certbot-dns-route53
certbot certonly --dns-route53 -d example.com -d *.example.com
```

**Renouvellement automatique** :

```bash
# Test de renouvellement (dry-run)
certbot renew --dry-run

# Renouvellement rÃ©el
certbot renew

# Cron automatique (installÃ© par dÃ©faut)
cat /etc/cron.d/certbot
# 0 */12 * * * root certbot renew --quiet

# Systemd timer (alternative)
systemctl list-timers | grep certbot
# certbot.timer : Runs twice daily
```

**Structure des fichiers** :

```
/etc/letsencrypt/
â”œâ”€â”€ live/
â”‚   â””â”€â”€ example.com/
â”‚       â”œâ”€â”€ cert.pem       â†’ ../../archive/example.com/cert1.pem
â”‚       â”œâ”€â”€ chain.pem      â†’ ../../archive/example.com/chain1.pem
â”‚       â”œâ”€â”€ fullchain.pem  â†’ ../../archive/example.com/fullchain1.pem
â”‚       â””â”€â”€ privkey.pem    â†’ ../../archive/example.com/privkey1.pem
â”œâ”€â”€ archive/
â”‚   â””â”€â”€ example.com/
â”‚       â”œâ”€â”€ cert1.pem     (certificat serveur)
â”‚       â”œâ”€â”€ cert2.pem     (aprÃ¨s renouvellement)
â”‚       â”œâ”€â”€ chain1.pem    (chaÃ®ne intermÃ©diaire)
â”‚       â”œâ”€â”€ fullchain1.pem (cert + chain)
â”‚       â””â”€â”€ privkey1.pem  (clÃ© privÃ©e)
â””â”€â”€ renewal/
    â””â”€â”€ example.com.conf  (config renouvellement)

Explications :
- live/ : Symlinks vers derniÃ¨res versions
- archive/ : Historique de tous certificats
- fullchain.pem : Certificat + chaÃ®ne complÃ¨te (Ã  utiliser dans serveur)
- privkey.pem : ClÃ© privÃ©e (PROTÃ‰GER !)
```

### Limites de taux Let's Encrypt

```
Certificates per Registered Domain :
- 50 par domaine par semaine
- example.com, www.example.com, api.example.com = mÃªme domaine
- Compteur : semaine glissante

Duplicate Certificate limit :
- 5 duplicatas exacts par semaine
- MÃªme domaines dans mÃªme ordre = duplicata

Names per Certificate :
- 100 domaines (SANs) par certificat

New Orders :
- 300 nouveaux orders par compte par 3 heures

Failed Validations :
- 5 Ã©checs par compte, par hostname, par heure

Accounts per IP :
- 10 comptes par IP par 3 heures
- 500 comptes par plage IPv6 /48 par 3 heures

Contournement :
- Pour projets massifs : contactersupport Let's Encrypt
- Utiliser domaines diffÃ©rents si besoin
- Rate limits gÃ©nÃ©reux pour usage normal
```

## Gestion du cycle de vie des certificats

### GÃ©nÃ©ration de CSR (Certificate Signing Request)

**CSR** = Demande de signature de certificat contenant clÃ© publique et informations.

```bash
# GÃ©nÃ©rer clÃ© privÃ©e RSA 2048 bits
openssl genrsa -out example.com.key 2048

# GÃ©nÃ©rer CSR
openssl req -new -key example.com.key -out example.com.csr

# Prompts :
Country Name (2 letter code) []:FR
State or Province Name []:Ile-de-France
Locality Name []:Paris
Organization Name []:Example SAS
Organizational Unit Name []:IT
Common Name []:www.example.com
Email Address []:admin@example.com
A challenge password []:  (laisser vide)

# CSR en une commande (sans prompts)
openssl req -new -key example.com.key -out example.com.csr \
    -subj "/C=FR/ST=Ile-de-France/L=Paris/O=Example SAS/CN=www.example.com"
```

**CSR avec SANs** :

```bash
# Configuration OpenSSL
cat > san.cnf << EOF
[req]
default_bits = 2048
prompt = no
default_md = sha256
distinguished_name = dn
req_extensions = req_ext

[dn]
C = FR
ST = Ile-de-France
L = Paris
O = Example SAS
CN = www.example.com

[req_ext]
subjectAltName = @alt_names

[alt_names]
DNS.1 = www.example.com
DNS.2 = example.com
DNS.3 = api.example.com
DNS.4 = cdn.example.com
EOF

# GÃ©nÃ©rer CSR avec SANs
openssl req -new -key example.com.key -out example.com.csr -config san.cnf
```

**VÃ©rifier CSR** :

```bash
# Afficher contenu CSR
openssl req -in example.com.csr -noout -text

# VÃ©rifier Subject
openssl req -in example.com.csr -noout -subject
# subject=C = FR, ST = Ile-de-France, L = Paris, O = Example SAS, CN = www.example.com

# VÃ©rifier SANs
openssl req -in example.com.csr -noout -text | grep -A 1 "Subject Alternative Name"
```

### Installation du certificat

```bash
# AprÃ¨s rÃ©ception du certificat de la CA

# Structure fichiers :
# example.com.crt         : Certificat serveur
# intermediate.crt        : Certificat(s) intermÃ©diaire(s)
# root.crt                : Certificat racine (optionnel)

# CrÃ©er fullchain (certificat + chaÃ®ne)
cat example.com.crt intermediate.crt > fullchain.pem

# Configuration Nginx
server {
    listen 443 ssl;
    server_name www.example.com;

    ssl_certificate /etc/nginx/ssl/fullchain.pem;
    ssl_certificate_key /etc/nginx/ssl/example.com.key;

    # ...
}

# Configuration Apache
<VirtualHost *:443>
    ServerName www.example.com

    SSLEngine on
    SSLCertificateFile /etc/apache2/ssl/example.com.crt
    SSLCertificateKeyFile /etc/apache2/ssl/example.com.key
    SSLCertificateChainFile /etc/apache2/ssl/intermediate.crt

    # ...
</VirtualHost>
```

### Renouvellement

```
StratÃ©gie de renouvellement :

Timeline pour certificat 90 jours :

Jour 0 : Ã‰mission certificat
Jour 60 : PremiÃ¨re tentative renouvellement (30 jours avant expiration)
Jour 67 : DeuxiÃ¨me tentative si Ã©chec
Jour 74 : TroisiÃ¨me tentative
Jour 81 : QuatriÃ¨me tentative
Jour 88 : CinquiÃ¨me tentative (URGENT - 2 jours avant expiration)
Jour 90 : EXPIRATION

Recommandations :
âœ“ Automatiser renouvellement
âœ“ Commencer 30 jours avant expiration
âœ“ Monitoring/alertes
âœ“ Tester rÃ©guliÃ¨rement (--dry-run)
```

**Script de renouvellement** :

```bash
#!/bin/bash
# /etc/cron.daily/renew-certificates

# Renouveler certificats Certbot
certbot renew --quiet --deploy-hook "systemctl reload nginx"

# Si renouvellement rÃ©ussi pour au moins un certificat,
# --deploy-hook est exÃ©cutÃ©

# Logging
if [ $? -eq 0 ]; then
    echo "$(date): Certificate renewal successful" >> /var/log/cert-renewal.log
else
    echo "$(date): Certificate renewal failed" >> /var/log/cert-renewal.log
    # Alerter admin
    mail -s "Certificate renewal failed" admin@example.com < /dev/null
fi
```

### RÃ©vocation

```bash
# RÃ©voquer certificat avec Certbot
certbot revoke --cert-path /etc/letsencrypt/live/example.com/cert.pem

# Avec raison spÃ©cifique
certbot revoke --cert-path /etc/letsencrypt/live/example.com/cert.pem \
    --reason keycompromise

# Raisons possibles :
# unspecified, keycompromise, affiliationchanged,
# superseded, cessationofoperation

# RÃ©voquer avec OpenSSL (CA privÃ©e)
openssl ca -revoke /path/to/certificate.pem \
    -config /etc/ssl/openssl.cnf

# GÃ©nÃ©rer nouvelle CRL aprÃ¨s rÃ©vocation
openssl ca -gencrl -out /var/www/crl/example-ca.crl \
    -config /etc/ssl/openssl.cnf
```

### Monitoring et alertes

**VÃ©rifier expiration** :

```bash
# Script de vÃ©rification
#!/bin/bash

DOMAIN="www.example.com"
WARN_DAYS=30

# Obtenir date d'expiration
EXPIRY=$(echo | openssl s_client -servername $DOMAIN -connect $DOMAIN:443 2>/dev/null | \
         openssl x509 -noout -enddate | cut -d= -f2)

# Convertir en timestamp
EXPIRY_TS=$(date -d "$EXPIRY" +%s)
CURRENT_TS=$(date +%s)

# Calculer jours restants
DAYS_LEFT=$(( ($EXPIRY_TS - $CURRENT_TS) / 86400 ))

echo "$DOMAIN expire dans $DAYS_LEFT jours"

if [ $DAYS_LEFT -lt $WARN_DAYS ]; then
    echo "ALERTE : Certificat expire bientÃ´t !"
    # Envoyer alerte
    mail -s "SSL Certificate expiring soon: $DOMAIN" admin@example.com <<EOF
Le certificat pour $DOMAIN expire dans $DAYS_LEFT jours.
Date d'expiration : $EXPIRY

Action requise.
EOF
fi
```

**Services de monitoring** :

```
SSL Labs Monitoring :
- https://www.ssllabs.com/ssltest/
- Grade A-F
- Alertes automatiques

Uptime Robot :
- VÃ©rification HTTPS
- Alerte si certificat expire

Nagios/Icinga plugin :
check_http -H www.example.com -S -C 30
â†’ Avertit si certificat expire dans moins de 30 jours

Prometheus + Blackbox Exporter :
- MÃ©trique ssl_expiry_seconds
- Alertes Grafana
```

## ProblÃ¨mes courants et solutions

### ChaÃ®ne de certification incomplÃ¨te

```
ProblÃ¨me :
Serveur envoie seulement certificat end-entity
Manque certificats intermÃ©diaires

SymptÃ´me navigateur :
- "Unable to verify certificate"
- "NET::ERR_CERT_AUTHORITY_INVALID"

Diagnostic :
openssl s_client -connect example.com:443 -showcerts

# Sortie problÃ©matique :
Certificate chain
 0 s:CN=www.example.com
   i:CN=Intermediate CA

â†’ Un seul certificat !
â†’ ChaÃ®ne incomplÃ¨te

# Sortie correcte :
Certificate chain
 0 s:CN=www.example.com
   i:CN=Intermediate CA
 1 s:CN=Intermediate CA
   i:CN=Root CA

â†’ ChaÃ®ne complÃ¨te

Solution :
# Nginx - utiliser fullchain.pem (pas cert.pem)
ssl_certificate /path/to/fullchain.pem;

# Apache - spÃ©cifier chain explicitement
SSLCertificateChainFile /path/to/chain.pem

# CrÃ©er fullchain manuellement
cat cert.pem intermediate.pem > fullchain.pem
```

### Mismatch de nom de domaine

```
Erreur :
NET::ERR_CERT_COMMON_NAME_INVALID

Causes :

1. Certificat pour www.example.com, accÃ¨s via example.com
2. Certificat pour example.com, accÃ¨s via www.example.com
3. Wildcard mal configurÃ©

Diagnostic :
openssl s_client -connect example.com:443 | openssl x509 -noout -text

# VÃ©rifier SANs :
X509v3 Subject Alternative Name:
    DNS:www.example.com

# Si connectÃ© Ã  example.com â†’ ERREUR

Solutions :
a) Certificat avec SANs multiples :
   DNS:example.com, DNS:www.example.com

b) Redirection :
   example.com â†’ redirige vers www.example.com

c) Wildcard :
   *.example.com + example.com dans SANs
```

### Certificat expirÃ©

```
Erreur :
NET::ERR_CERT_DATE_INVALID

VÃ©rification :
openssl x509 -in cert.pem -noout -dates
# notBefore=Oct  1 00:00:00 2024 GMT
# notAfter=Dec 30 23:59:59 2024 GMT

Si expirÃ© :
1. Renouveler certificat immÃ©diatement
2. VÃ©rifier processus automatique (pourquoi Ã©chec ?)
3. Mettre en place monitoring

Fausse alerte (horloge systÃ¨me) :
# VÃ©rifier date systÃ¨me
date
timedatectl status

# Si incorrecte :
timedatectl set-ntp true
```

### RÃ©vocation non propagÃ©e

```
ProblÃ¨me :
Certificat rÃ©voquÃ© mais encore acceptÃ©

Causes :
1. Cache OCSP client
2. CRL pas Ã  jour
3. Soft-fail OCSP

VÃ©rification rÃ©vocation :
# OCSP
openssl ocsp -issuer issuer.pem -cert cert.pem \
    -url http://ocsp.example.com -CAfile root.pem

# CRL
openssl verify -crl_check -CRLfile ca.crl cert.pem

Force refresh :
- Vider cache navigateur
- RedÃ©marrer navigateur
- Attendre Next Update OCSP/CRL
```

## Bonnes pratiques

### SÃ©curitÃ© des clÃ©s privÃ©es

```
Protection clÃ© privÃ©e :

1. Permissions fichier :
chmod 600 privkey.pem
chown root:root privkey.pem

2. Chiffrement au repos :
# GÃ©nÃ©rer clÃ© chiffrÃ©e
openssl genrsa -aes256 -out encrypted.key 2048
# Demande passphrase

# DÃ©chiffrer pour usage
openssl rsa -in encrypted.key -out decrypted.key

3. HSM (Hardware Security Module) :
- ClÃ© JAMAIS exportable
- Signatures dans hardware
- Protectionphysique
- Pour CAs et sites critiques

4. SÃ©paration :
- ClÃ©s diffÃ©rentes par service
- ClÃ©s diffÃ©rentes par environnement (prod/staging)
- Rotation rÃ©guliÃ¨re

5. Backup sÃ©curisÃ© :
- Chiffrement
- Stockage offline
- AccÃ¨s restreint
```

### Taille de clÃ© recommandÃ©e

```
RSA (2024) :
âœ“ 2048 bits : Standard, acceptable
âœ“ 3072 bits : RecommandÃ© pour haute sÃ©curitÃ©
âœ“ 4096 bits : Maximum (peu de gain de sÃ©curitÃ©, impact perf)
âœ— 1024 bits : OBSOLÃˆTE, cassable

ECDSA (2024) :
âœ“ P-256 : Standard, Ã©quivalent RSA 3072
âœ“ P-384 : Haute sÃ©curitÃ©, Ã©quivalent RSA 7680
âœ“ P-521 : TrÃ¨s haute sÃ©curitÃ© (overkill gÃ©nÃ©ralement)

EdDSA :
âœ“ Ed25519 : RecommandÃ© (rapide, sÃ»r, compact)
âœ“ Ed448 : TrÃ¨s haute sÃ©curitÃ©

Tendance :
- Migration vers ECDSA/EdDSA
- Plus rapide, clÃ©s plus petites
- MÃªme niveau sÃ©curitÃ©
```

### Renouvellement automatique

```
Checklist :

â˜‘ Automatiser avec Certbot ou autre client ACME
â˜‘ Commencer 30 jours avant expiration
â˜‘ Multiple tentatives en cas d'Ã©chec
â˜‘ Rechargement automatique serveur web
â˜‘ Monitoring expiration
â˜‘ Alertes email si Ã©chec
â˜‘ Logs centralisÃ©s
â˜‘ Test rÃ©gulier (--dry-run)
â˜‘ Plan de repli manuel documentÃ©

Exemple cron complet :
# /etc/cron.d/certbot
0 */12 * * * root certbot renew --quiet --deploy-hook "systemctl reload nginx" || \
    echo "Renewal failed" | mail -s "Certbot failure" admin@example.com
```

### Validation multi-perspective

```
AmÃ©lioration sÃ©curitÃ© Let's Encrypt (2020) :

Validation depuis plusieurs vantage points :
- DiffÃ©rentes rÃ©gions gÃ©ographiques
- DiffÃ©rents rÃ©seaux
- DÃ©tecte attaques BGP hijacking/DNS poisoning

Exemple :
Attaquant dÃ©tourne BGP pour 203.0.113.50
â†’ Validation depuis une rÃ©gion rÃ©ussit (attaque)
â†’ Validation depuis autres rÃ©gions Ã©choue
â†’ Ã‰mission refusÃ©e

DÃ©fense contre :
- BGP hijacking
- DNS cache poisoning localisÃ©
- Attaques rÃ©seau ciblÃ©es
```

## Conclusion

Les certificats et la PKI sont les fondations de la confiance sur Internet. Comprendre leur fonctionnement en profondeur est essentiel pour :

**DÃ©ployer correctement HTTPS** :
- Choix du type de certificat (DV/OV/EV)
- Configuration serveur
- ChaÃ®ne de certification complÃ¨te

**GÃ©rer le cycle de vie** :
- GÃ©nÃ©ration CSR
- Installation
- Renouvellement automatique
- RÃ©vocation si nÃ©cessaire

**SÃ©curiser l'infrastructure** :
- Protection clÃ©s privÃ©es
- Monitoring expiration
- Validation rÃ©vocation (OCSP Stapling)
- Certificate Transparency

**Automatiser avec ACME** :
- Let's Encrypt gratuit
- Renouvellement sans intervention
- Wildcards avec DNS-01

**Points clÃ©s Ã  retenir** :

```
Certificat X.509 :
âœ“ Lie clÃ© publique Ã  identitÃ©
âœ“ SignÃ© par CA de confiance
âœ“ Extensions v3 cruciales (SAN, Key Usage)

PKI :
âœ“ HiÃ©rarchie Root â†’ Intermediate â†’ End-entity
âœ“ ChaÃ®ne de confiance vÃ©rifiable
âœ“ RÃ©vocation via CRL/OCSP

Types :
âœ“ DV : Gratuit, rapide, domaine uniquement
âœ“ OV : Payant, vÃ©rifie organisation
âœ“ EV : Cher, validation approfondie (dÃ©clin)

Let's Encrypt :
âœ“ RÃ©volution HTTPS gratuit
âœ“ ACME automatisation
âœ“ 90 jours â†’ force automatisation
âœ“ 95%+ adoption moderne

RÃ©vocation :
âœ“ CRL : Liste complÃ¨te (lourd)
âœ“ OCSP : RequÃªte temps rÃ©el (privacy)
âœ“ OCSP Stapling : Meilleur compromis

Bonnes pratiques 2024 :
âœ“ Automatisation renouvellement
âœ“ OCSP Stapling activÃ©
âœ“ ClÃ©s ECDSA 256+ ou RSA 2048+
âœ“ Monitoring expiration
âœ“ Certificate Transparency
```

Dans la prochaine section, nous Ã©tudierons IPsec, un protocole qui sÃ©curise les communications au niveau de la couche rÃ©seau (IP) plutÃ´t qu'au niveau application comme TLS.

â­ï¸ [IPsec : sÃ©curitÃ© au niveau rÃ©seau](/06-securite/05-ipsec.md)
